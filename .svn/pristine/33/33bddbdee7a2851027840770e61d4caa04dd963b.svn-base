"use strict";(self.webpackChunkelstar=self.webpackChunkelstar||[]).push([[6003],{25579:(e,t,a)=>{a.d(t,{Ei:()=>f,I6:()=>p,Qj:()=>i,U$:()=>u,Uy:()=>x,Z_:()=>s,_K:()=>y,b6:()=>c,d:()=>r,db:()=>b,fh:()=>h,gg:()=>g,hu:()=>l,iD:()=>d,rd:()=>m,w_:()=>C});a(54048);var n=a(46152),o=a(54748);a(74569);async function l(e){return n.Z.fetchData({url:"/dealmaster/".concat(e),method:"get"})}async function s(e){return n.Z.fetchData({url:"/dealattachment/".concat(e),method:"get"})}async function c(e,t,a){return n.Z.fetchData({url:"/dealmaster/dealforapproval/?DealNumber=".concat(e,"&IsApproved=").concat(t,"&RejectRemark=").concat(a),method:"get"})}async function r(e,t){return n.Z.fetchData({url:"/dealmaster/?LocationCode=".concat(e.LocationCode,"&ChannelCode=").concat(e.ChannelCode,"&StartDate=").concat((0,o.Tk)(t[0]),"&EndDate=").concat((0,o.Tk)(t[1])),method:"get"})}async function i(e){return n.Z.fetchData({url:"/sponsortypemaster/drop/",method:"get",data:e})}async function d(e){return n.Z.fetchData({url:"/spottypemaster/drop/",method:"get",data:e})}async function u(e){return n.Z.fetchData({url:"/dealdetail/".concat(e),method:"get"})}async function m(e){return n.Z.fetchData({url:"/dealmaster/USP_Sch_DealConsumptionCheck/?DealNumber=".concat(e),method:"get"})}async function h(e,t,a,o,l,s){return n.Z.fetchData({url:"/dealmaster/bindstartnendtime/?LocationCode=".concat(l,"&ChannelCode=").concat(s,"&DealPeriodToDate=").concat(e,"&DealPeriodFromDate=").concat(t,"&ContentCode=").concat(a,"&OriginalRepeatCode=").concat(o),method:"get"})}async function y(e,t,a){return n.Z.fetchData({url:"/bookingdetails/bookingchange/?flag=".concat(e,"&IsNtc=").concat(a),method:"put",data:t})}async function g(e,t){var a={params:t};return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:a,method:"post"})}async function f(e){return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:{params:{}},method:"post"})}async function p(e,t,a){var o={params:{Bookingcode:t,IsNTC:a}};return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:o,method:"post"})}async function b(e){var t={params:{CheckMonth:e}};return n.Z.fetchData({url:"/callstoreprocedure/USP_DealDashboardDoughnut",data:t,method:"post"})}async function x(e,t){var a={params:{BookingNumber:t,deallineitemno:0}};return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:a,method:"post"})}async function C(e){return n.Z.fetchData({url:"currencyexchangerate/?basecurrency=".concat(e),method:"post"})}},28416:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});var n=a(1413),o=a(72791),l=a(2803),s=a(87537),c=a(60488),r=a(60364),i=a(54748),d=a(9494),u=a(72299),m=a(63821),h=a(34927),y=a(58617),g=a(84373),f=a(42264),p=a(81320),b=a(25579),x=a(82600),C=a(74569),N=a(45682),w=a(24933),S=a(27353),T=a(6884),j=a(92687),Z=a(66435),D=a.n(Z),v=a(45834),k=a(7847),A=a(23333);const z=e=>{try{return{columns:[{width:15*A.JN/100,text:""},{width:"*",alignment:"center",margin:[0,15,0,0],text:[{text:"".concat(e.companyName,"\n"),style:"header"},(0,n.Z)({},A.Fb),{text:e.address,style:"secondaryTextBold"}]},{width:15*A.JN/100,text:""}]}}catch(t){throw t}};D().vfs=v.I.vfs;const B="A4",F={header:{fontSize:12,bold:!0},primaryText:{fontSize:10},primaryTextBold:{fontSize:10,bold:!0},secondaryText:{fontSize:8},secondaryTextBold:{fontSize:8,bold:!0},row1:{margin:[0,5,0,0],fontSize:10},row2:{margin:[0,5,0,0],fontSize:10},row3:{margin:[0,5,0,0],fontSize:10},tableKey:{fontSize:9,bold:!0},tableValue:{fontSize:9},tableKeyLarge:{fontSize:14,bold:!0}},V=e=>{try{return{table:{widths:[23.8112,59.52799999999999,20239.52/100,148.82,47.6224,35.7168],body:[[{text:"S.No.",style:"tableKey"},{text:"Telecast Period",style:"tableKey"},{text:"Caption",style:"tableKey"},{text:"Programme",style:"tableKey"},{text:"Spot Type",style:"tableKey"},{text:"Rate",style:"tableKey"}],...(0,p.getTableWithTotal)(e,["DurInSec","BillSpotAmount"]).map(((t,a)=>a!==e.length?[{text:a+1,style:"tableValue"},{text:(0,p.getDateFromDateTime)(t.TelecastDate),style:"tableValue"},{text:t.CommercialCaption,style:"tableValue"},{text:t.ContentName,style:"tableValue"},{text:t.SpotType,style:"tableValue"},{text:(0,p.numberToINRFormat)(t.BookingSpotRate),style:"tableValue"}]:[{text:"",style:"tableValue"},{text:t.TelecastDate,style:"tableValue"},{text:t.ContentName,style:"tableValue"},{text:t.SpotType,style:"tableValue"},{text:"Total",style:"tableKey"},{text:t.BookingSpotRate,style:"tableValue"}]))]}}}catch(t){throw t}},R=async(e,t)=>{const a={pageSize:B,pageMargins:10,content:[z(t),{columns:[{width:"*",text:[{text:"\n\n\nAgency : ",style:"tableKey"},{text:t.agencyName,style:"tableValue"},{text:"\nAddress : ",style:"tableKey"},{text:t.agencyAddress,style:"tableValue"}]},{width:"*",alignment:"center",text:[{text:"TELECAST REPORT",style:"header"}],margin:[0,10,0,0]},{width:"*",text:[{text:"\n\n\nPeriod : ",style:"tableKey"},{text:"".concat((0,k.N)(t.fromDate,t.toDate)),style:"tableValue"},{text:"\nClient : ",style:"tableKey"},{text:t.clientName,style:"tableValue"}],alignment:"right"}],margin:[0,5,0,15]},V(e)],styles:F};return D().createPdf(a)};var K=a(95587),E=a.n(K),L=a(64802),P=a(80184);D().vfs=v.I.vfs;const I=function(){const e=(0,r.useSelector)((e=>e.locale.selectedChannel)),t=(0,r.useSelector)((e=>e.auth.session.LoginId)),a=(0,r.useSelector)((e=>e.auth.session.token)),Z=(0,r.useSelector)((e=>e.base.common.currentRouteTitle)),[D,v]=(0,o.useState)([null,null]),[k,A]=(0,o.useState)(null),[z,B]=(0,o.useState)(""),[F,V]=(0,o.useState)([]),[K,I]=(0,o.useState)(null),[_,O]=(0,o.useState)(null),[G,J]=(0,o.useState)(null),[U,M]=(0,o.useState)(!1),[Q,H]=(0,o.useState)("agency");(0,o.useEffect)((()=>{try{(async e=>{const t=(await(0,b.iD)(void 0)).data.map((e=>({value:e.SpotTypeCode,label:e.SpotTypeName})));O(t)})()}catch(e){console.error(e)}}),[]),(0,o.useEffect)((()=>{try{(async()=>{D&&D[0]&&D[1]&&((0,c.Dh)(),M(!0),A({agencyTable:await Y("agency"),clientTable:await Y("client"),bookingTable:await Y("booking")}),M(!1))})()}catch(e){console.error(e)}}),[D]),(0,o.useEffect)((()=>{try{q()}catch(e){console.error(e)}}),[e]);const W=async()=>{try{(0,p.showCursorLoader)();let o={loginCode:t,locationCode:e.LocationCode,fromDate:(0,i.Tk)(D[0]),uptoDate:(0,i.Tk)(D[1]),channelCode:e.ChannelCode,SpotTypeCode:G.map((e=>e.value)).join(",")};"BookingCode"in F[0]?(o.filter=F.map((e=>e.BookingNumber)).join(","),o.id=3):"AgencyCode"in F[0]?(o.filter=F.map((e=>e.AgencyCode)).join(","),o.id=1):"ClientCode"in F[0]&&(o.filter=F.map((e=>e.ClientCode)).join(","),o.id=2);let l=null;if(Z===S.J_?l=await(0,f.Yd)(o,a):S.op,l){let e=[];200===l.status&&l.data.length>0?e=l.data:204!==l.status&&(0,p.openNotification)("danger","Something went wrong. Server responded with status code ".concat(l.status,".")),e.length>0?await $(e.map((e=>(0,n.Z)((0,n.Z)({},e),{},{TelecastDate:e.ScheduleDate,DurInSec:e.CommercialDuration,BookingSpotRate:0,BillSpotAmount:0})))):(0,p.openNotification)("info","No telecast certificates found for selected ".concat("agency"===Q?"agencies":"client"===Q?"clients":"bookings"))}else(0,p.openNotification)("danger","Something went wrong while downloading telecast certificates")}catch(o){console.error(o),(0,p.openNotification)("danger","Something went wrong while downloading telecast certificates")}finally{(0,p.hideCursorLoader)()}},Y=async t=>{try{let a={location:e.LocationCode,channel:e.ChannelCode,fromDate:(0,i.Tk)(D[0]),todate:(0,i.Tk)(D[1]),Flag:null,IsNTC:0,SpotTypeCode:G.map((e=>e.value)).join(",")};console.log(a),"agency"===t?a.Flag=1:"client"===t?a.Flag=2:"booking"===t&&(a.Flag=3);let n=await(0,d.apiCallstoreprocedure)("usp_BookingTC_List",a);if(200===n.status)return n.data;if(204===n.status)return[];throw(0,p.openNotification)("danger","Something went wrong. Server responded with status code ".concat(n.status,".")),new Error("Response status code: ".concat(n.status,". Response: ").concat(n))}catch(a){throw console.error(a),a instanceof C.AxiosError&&(0,p.openNotification)("danger","Something went wrong. Server responded with status code ".concat(a.response.status)),a}},$=async e=>{const t=(0,p.getGroupedDataFromJSONArray)(e,"agency"===Q?"AgencyName":"client"===Q?"ClientName":"BookingNumber"),a=Object.keys(t);let o={fromDate:D[0],toDate:D[1]};if("booking"===Q){o=(0,n.Z)((0,n.Z)({},o),{},{companyName:e[0].EntityName,address:e[0].CorpAddress,agencyName:e[0].AgencyName,agencyAddress:e[0].BillingAddress1,clientName:e[0].ClientName,spotType:e[0].SpotType});(await R(e,o)).download("Bookings-Telecast-Certificate.pdf")}else if(1===a.length){o=(0,n.Z)((0,n.Z)({},o),{},{companyName:e[0].EntityName,address:e[0].CorpAddress,agencyName:e[0].AgencyName,agencyAddress:e[0].BillingAddress1,clientName:e[0].ClientName,spotType:e[0].SpotType});(await R(e,o)).download("".concat(a[0],"-Telecast-Certificate.pdf"))}else if(a.length>1){const e=new(E());for(let s of a){o=(0,n.Z)((0,n.Z)({},o),{},{companyName:t[s][0].EntityName,address:t[s][0].CorpAddress,agencyName:t[s][0].AgencyName,agencyAddress:t[s][0].BillingAddress1,clientName:t[s][0].ClientName,contentName:t[s][0].ContentName,spotType:t[s][0].SpotType});const a=await R(t[s],o),l=await new Promise((e=>a.getBlob(e)));e.file("".concat(s,"-Telecast-Certificate.pdf"),l)}const l=await e.generateAsync({type:"blob"});(0,L.saveAs)(l,"Telecast-Certificates.zip")}},q=()=>{try{v([null,null]),A(null),B(""),V([]),I(null),M(!1),H("agency")}catch(e){console.error(e)}};return(0,P.jsxs)(l.Zb,{className:"h-full",bodyClass:"h-full py-3 px-0 flex flex-col",bordered:!1,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between gap-6 border-b border-gray-700 pb-3 px-4 mb-2",children:[(0,P.jsx)("h4",{children:"Telecast Certificate"}),(0,P.jsxs)("div",{className:"grow flex justify-end items-center gap-3",children:[(0,P.jsx)(T.Z,{isMulti:!0,size:"sm",placeholder:"Select Spot Type",className:"min-w-[50%]",options:_,onChange:e=>J(e)}),(0,P.jsx)(s.Z,{placement:"bottom-end",className:"w-max",size:"sm",placeholder:"Select dates range",onChange:e=>v(e),value:D,disabled:!(0,p.isChannelSelected)(e)})]})]}),(0,P.jsx)("div",{className:"grow h-0 px-4",children:(0,p.isChannelSelected)(e)?(0,P.jsx)(P.Fragment,{children:D&&D[0]&&D[1]?(0,P.jsx)(P.Fragment,{children:k&&!K&&(0,P.jsx)("div",{className:"h-full",children:(0,P.jsxs)(l.mQ,{variant:"pill",defaultValue:"agency",onChange:e=>{H(e),B(""),V([])},className:"h-full flex flex-col",children:[(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsxs)(m.Z,{children:[(0,P.jsx)(h.Z,{value:"agency",children:"Agency"}),(0,P.jsx)(h.Z,{value:"client",children:"Client"}),(0,P.jsx)(h.Z,{value:"booking",children:"Booking"})]}),(0,P.jsx)(x.Z,{value:null!==z&&void 0!==z?z:"",className:"w-60",size:"sm",prefix:(0,P.jsx)(y.O6C,{className:"text-md"}),placeholder:"Search",onChange:e=>B(String(e)),showSearchLabel:!1,marginBottom:"mb-0"})]}),(0,P.jsx)("hr",{className:"mt-2"}),(0,P.jsxs)("div",{className:"mt-3 grow",children:["agency"===Q&&(0,P.jsx)(u.Z,{value:"agency",className:"h-full",children:k.agencyTable.length>0?(0,P.jsx)(j.Z,{tableColumns:[{header:"Agency Name",accessorKey:"AgencyName"}],data:k.agencyTable,globalFilter:z,setGlobalFilter:B,setSelectedRows:V,footerAction:(0,P.jsx)(l.zx,{variant:"solid",icon:(0,P.jsx)(g.VFe,{}),size:"sm",disabled:0===F.length,onClick:W,children:"Download Telecast Certificate"}),type:"home"}):(0,P.jsx)("div",{className:"h-full flex justify-center items-center",children:"No agencies found"})}),"client"===Q&&(0,P.jsx)(u.Z,{value:"client",className:"h-full",children:k.clientTable.length>0?(0,P.jsx)(j.Z,{tableColumns:[{header:"Client Name",accessorKey:"ClientName"}],data:k.clientTable,globalFilter:z,setGlobalFilter:B,selectedRows:F,setSelectedRows:V,footerAction:(0,P.jsx)(l.zx,{variant:"solid",icon:(0,P.jsx)(g.VFe,{}),size:"sm",disabled:0===F.length,onClick:W,children:"Download Telecast Certificate"}),type:"home"}):(0,P.jsx)("div",{className:"h-full flex justify-center items-center",children:"No clients found"})}),"booking"===Q&&(0,P.jsx)(u.Z,{value:"booking",className:"h-full",children:k.bookingTable.length>0?(0,P.jsx)(j.Z,{tableColumns:[{header:"Booking Number",accessorKey:"BookingCode"}],data:k.bookingTable,globalFilter:z,setGlobalFilter:B,selectedRows:F,setSelectedRows:V,footerAction:(0,P.jsx)(l.zx,{variant:"solid",icon:(0,P.jsx)(g.VFe,{}),size:"sm",disabled:0===F.length,onClick:W,children:"Download Telecast Certificate"}),type:"home"}):(0,P.jsx)("div",{className:"h-full flex justify-center items-center",children:"No bookings found"})})]})]})})}):(0,P.jsx)("div",{className:"h-full flex justify-center items-center",children:"Please select date range to view telecast certificates"})}):(0,P.jsx)("div",{className:"h-full flex justify-center items-center",children:"Please select a channel to view telecast certificates"})}),(0,P.jsx)(w.Z,{}),(0,P.jsx)(N.default,{showLoader:U})]})}},6884:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(1413),o=a(45987),l=a(2803),s=a(72791),c=a(80184);const r=["styles","size","placeholder"],i=s.memo(s.forwardRef(((e,t)=>{const{styles:a,size:s,placeholder:i}=e,d=(0,o.Z)(e,r);return(0,c.jsx)(l.Ph,(0,n.Z)((0,n.Z)({size:"sm"},d),{},{styles:(0,n.Z)({valueContainer:e=>(0,n.Z)((0,n.Z)({},e),{},{padding:"2px 5px"}),input:e=>(0,n.Z)((0,n.Z)({},e),{},{color:"white"}),control:e=>(0,n.Z)((0,n.Z)({},e),{},{minHeight:"30px"})},a),ref:t,placeholder:i||"Select"}))})))}}]);
//# sourceMappingURL=6003.4401fb37.chunk.js.map