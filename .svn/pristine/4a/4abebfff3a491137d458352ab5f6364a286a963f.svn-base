import { Container } from 'components/shared';
import Logo from 'components/template/Logo';
import { Button, Card, Tooltip } from 'components/ui';
import React, { useEffect, useState } from 'react';
import { HiOutlineCalendar } from 'react-icons/hi';
import { useSelector } from 'react-redux';
import {
  apiGetdealdetailId,
  apidealmasterDealforapprovalBYID,
} from 'services/DealServices';
import useThemeClass from 'utils/hooks/useThemeClass';

import './App.css';
import ContentTable from 'views/Controls/ContentTable';
import { openNotification } from 'views/Controls/GLOBALFUNACTION';

const DealMasterEditBYAPI = ({ Deal, setIsOpenApproval }) => {
  const [DealDataDetails, setDealDataDetails] = useState([]);

  useEffect(() => {
    (async (values) => {
      const respd = await apiGetdealdetailId(Deal.DealNumber);
      setDealDataDetails(respd.data);
    })();
  }, []);

  const mode = useSelector((state) => state.theme.mode);
  const { textTheme } = useThemeClass();
  const options = {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  };

  const DealApproveFunation = async (DealNumber, IsApproved) => {
    try {
      const resp = await apidealmasterDealforapprovalBYID(
        DealNumber,
        IsApproved,
      );
      if (resp.status == 204) {
        openNotification('warning', 'Deal Not Found');
        setIsOpenApproval(false);
        return;
      }
      if (resp.status == 200) {
        if (IsApproved == 1) {
          openNotification('success', 'Deal Approved Successfully');
          setIsOpenApproval(false);
        } else {
          openNotification('success', 'Deal Rejected Successfully');
          setIsOpenApproval(false);
        }
        return;
      }
    } catch (error) {
      if (error.response.status == 500) {
        openNotification('danger', 'Server Error');
        setIsOpenApproval(false);
        return;
      }
    }
  };
  return (
    <Container className="h-full">
      <Card className="h-full" bodyClass="h-full">
        <div className="flex flex-col md:flex-row justify-between gap-4 mb-10">
          <div>
            <Logo className="mb-3" mode={mode} />
            <address className="not-italic">
              <div>
                <h5 className="mb-3 capitalize ">
                  {Deal?.DealTypeName}, {Deal?.Emp_FirstName}.
                </h5>

                <span className="IN">
                  Client & City : {Deal?.ClientName} & {Deal?.ClientPlaceName}
                </span>

                <span className="IN">
                  Agency & City : {Deal?.AgencyName} & {Deal?.AgencyPlaceName}
                </span>

                <span className="IN">Pay Route : {Deal?.PayRouteName}</span>
              </div>
            </address>
          </div>
          <div className="my-4">
            <div className="mb-2">
              <h4>Deal #{Deal?.DealCode}</h4>
              <span>
                Date:{' '}
                {new Date(Deal?.DealCreatedDate).toLocaleDateString(
                  'en-US',
                  options,
                )}
              </span>
            </div>
            <div className="mt-4 flex items-center">
              <HiOutlineCalendar size={30} className={`${textTheme}`} />
              <div className="ltr:ml-3 rtl:mr-3 ">
                <Tooltip title="Start Date / End Date">
                  <div className="mb-1 ">
                    {new Date(Deal?.DealPeriodFromDate).toLocaleDateString(
                      'en-US',
                      options,
                    )}{' '}
                    <br />{' '}
                    {new Date(Deal?.DealPeriodToDate).toLocaleDateString(
                      'en-US',
                      options,
                    )}
                  </div>
                </Tooltip>
              </div>
            </div>
          </div>
        </div>
        <ContentTable
          DealDataDetails={DealDataDetails}
          DealData={Deal}
        ></ContentTable>

        <div className="flex justify-between mt-5">
          <Button className="mr-2" onClick={() => setIsOpenApproval(false)}>
            Back
          </Button>
          <div className="flex justify-end ">
            <Button
              className="mr-2"
              onClick={() => DealApproveFunation(Deal?.DealNumber, 2)}
            >
              Reject
            </Button>
            <Button
              variant="solid"
              onClick={() => DealApproveFunation(Deal?.DealNumber, 1)}
            >
              Approve
            </Button>
          </div>
        </div>
      </Card>
    </Container>
  );
};

export default DealMasterEditBYAPI;
