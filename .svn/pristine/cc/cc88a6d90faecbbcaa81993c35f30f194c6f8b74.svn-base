import { Card } from 'components/ui';
import React, { useContext, useEffect, useRef } from 'react';
import { IoIosMusicalNotes } from 'react-icons/io';
import { RiAdvertisementLine } from 'react-icons/ri';
import { openNotification } from 'views/Controls/GLOBALFUNACTION';
import {
  featuresEnum,
  pagesEnum,
  ruleCheckTypesEnum,
} from 'views/Scheduling/Scheduler/enum';
import Rule from './Rule';
import { IoTimerOutline } from 'react-icons/io5';
import SchedulerContext from 'views/Scheduling/SchedulerOld/context/SchedulerContext';
// import SchedulerContext from 'views/Scheduling/Scheduler/context/SchedulerContext';

function RuleCheckDropdown() {
  /* CONTEXT */
  const { page, setActiveFeatures } = useContext(SchedulerContext);

  /* HOOKS */
  const dropdownRef = useRef(null);

  /* USE EFFECTS */
  useEffect(() => {
    document.addEventListener('mousedown', closeDropDowns);
    return () => {
      document.removeEventListener('mousedown', closeDropDowns);
    };
  }, [dropdownRef]);

  /* EVENT HANDLERS */
  const handleClick = (ruleCheckType) => {
    try {
      setActiveFeatures((prevState) => ({
        ...prevState,
        [featuresEnum.RULE_CHECK]: {
          ...prevState[featuresEnum.RULE_CHECK],
          isDropdownVisible: false,
          isActive: true,
          ruleCheckType,
        },
      }));
    } catch (error) {
      openNotification('danger', 'Something went wrong');
      console.error(error);
    }
  };

  const closeDropDowns = (event) => {
    try {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setActiveFeatures((prevState) => ({
          ...prevState,
          [featuresEnum.RULE_CHECK]: {
            ...prevState[featuresEnum.RULE_CHECK],
            isDropdownVisible: false,
          },
        }));
      }
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <Card
      className="!bg-gray-700 text-white mt-2 absolute left-1/2 top-full z-[100]"
      bodyClass="px-0 pt-1.5"
      style={{ boxShadow: '#000000cc 0px 0px 10px', minWidth: '14rem' }}
      ref={dropdownRef}
    >
      <p className="text-base mb-1.5 px-3">Rules</p>
      <div className="h-[30vh] overflow-scroll no-scrollbar flex flex-col">
        {page === pagesEnum.PROMO && (
          <Rule
            handleClick={() =>
              handleClick(ruleCheckTypesEnum.BACK_TO_BACK_PROMOS)
            }
            icon={<RiAdvertisementLine className="text-base" />}
            title="Back to Back Promos"
          />
        )}
        {page === pagesEnum.SONG && (
          <Rule
            handleClick={() =>
              handleClick(ruleCheckTypesEnum.BACK_TO_BACK_SONGS)
            }
            icon={<IoIosMusicalNotes className="text-base" />}
            title="Back to Back Songs"
          />
        )}
        {page === pagesEnum.COMMERCIAL && (
          <Rule
            handleClick={() =>
              handleClick(ruleCheckTypesEnum.BACK_TO_BACK_COMMERCIALS)
            }
            icon={<RiAdvertisementLine className="text-base" />}
            title="Back to Back Commecials"
          />
        )}
        {page === pagesEnum.COMMERCIAL && (
          <Rule
            handleClick={() => handleClick(ruleCheckTypesEnum.MULTI_SPOTS)}
            icon={<RiAdvertisementLine className="text-base" />}
            title="Multi Spots"
          />
        )}
        {page === pagesEnum.FINAL_LOG && (
          <>
            <Rule
              handleClick={() =>
                handleClick(ruleCheckTypesEnum.BACK_TO_BACK_PROMOS)
              }
              icon={<RiAdvertisementLine className="text-base" />}
              title="Back to Back Promos"
            />
            <Rule
              handleClick={() =>
                handleClick(ruleCheckTypesEnum.BACK_TO_BACK_SONGS)
              }
              icon={<IoIosMusicalNotes className="text-base" />}
              title="Back to Back Songs"
            />
            <Rule
              handleClick={() =>
                handleClick(ruleCheckTypesEnum.BACK_TO_BACK_COMMERCIALS)
              }
              icon={<RiAdvertisementLine className="text-base" />}
              title="Back to Back Commecials"
            />
            <Rule
              handleClick={() => handleClick(ruleCheckTypesEnum.MULTI_SPOTS)}
              icon={<RiAdvertisementLine className="text-base" />}
              title="Multi Spots"
            />
            <Rule
              handleClick={() =>
                handleClick(ruleCheckTypesEnum.OUT_OF_TIMEBAND)
              }
              icon={<IoTimerOutline className="text-base" />}
              title="Out of RODP/TimeBand"
            />
          </>
        )}
      </div>
    </Card>
  );
}

export default RuleCheckDropdown;
