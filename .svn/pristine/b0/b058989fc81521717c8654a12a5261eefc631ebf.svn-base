import React, { useEffect, useState } from 'react';
import { useSelector } from 'react-redux';
import { useLocation } from 'react-router-dom';
import { getPlaylistSummaryData } from './utils';
import StatisticCardwithfigure from 'components/common/StatisticCardwithfigure';
import {
  convertDateFormatyyyyMMdd,
  formatDateToDDMMMYYYY,
  openNotification,
} from 'views/Controls/GLOBALFUNACTION';
import ExtraTeleastedSpotsTable from './ExtraTeleastedSpotsTable';
import { hideStackedSideNav } from '../general';
import { LuListEnd } from 'react-icons/lu';
import { DROPPED_SPOTS, EXTRA_TELECASTED_SPOTS } from './constant';
import Loader from 'views/Controls/Loader';
import { CgPlayListRemove } from 'react-icons/cg';
import { Card } from 'components/ui';
import DroppedSpotsTable from './DroppedSpotsTable';
import { hideStackedSideNav_secondary } from 'views/Scheduling/general';
function CloudPlayout() {
  /* REDUX */
  const channel = useSelector((state) => state.locale.selectedChannel);

  /* STATES */
  const [date, setDate] = useState(null);
  const [playlistSummary, setPlaylistSummary] = useState([]);
  const [showLoader, setShowLoader] = useState(false);
  const [curTable, setCurTable] = useState('extraSpots');

  /* HOOKS */
  const location = useLocation();
  hideStackedSideNav_secondary();
  /* USE EFFECTS */
  useEffect(() => {
    (async () => {
      try {
        if (location && location.state && location.state.date) {
          setShowLoader(true);
          // hideStackedSideNav();
          setDate(location.state.date);
          setPlaylistSummary(
            await getPlaylistSummaryData(
              channel,
              convertDateFormatyyyyMMdd(location.state.date),
            ),
          );
          setShowLoader(false);
        }
      } catch (error) {
        openNotification(
          'danger',
          'Something went wrong while retrieving Playlist Summary',
        );
        setShowLoader(false);
        console.log(error);
      }
    })();
  }, [location]);

  return (
    <>
      <div className="flex justify-between items-center">
        <h3 className="mb-4">Cloud Playout</h3>
        <h4>{formatDateToDDMMMYYYY(date)}</h4>
      </div>
      <div className={`flex gap-2 mb-4`}>
        <Card bodyClass="p-2 grid grid-cols-4 gap-2" bordered={false}>
          {playlistSummary.map((summary, index) => (
            <StatisticCardwithfigure
              key={index}
              CardHeight={200}
              AnimateColorClass={summary.iconBorderColor}
              Icon={summary.icon}
              CardName={summary.title}
              CardNote={summary.description}
              CardFigure={summary.count}
              COLOR={summary.color} cursor={true}
            />
          ))}
        </Card>
        <Card bodyClass="p-2 grid grid-cols-2 gap-2" bordered={false}>
          <div onClick={() => setCurTable('droppedSpots')}>
            <StatisticCardwithfigure
              key="droppedSpots"
              CardHeight={200}
              AnimateColorClass={'order1'}
              Icon={
                <CgPlayListRemove style={{ fontSize: 35, color: '#F55C52' }} />
              }
              CardName={'Dropped Spots'}
              CardNote={
                'Dropped Spots are advertisement slots that were removed or Not Telecasted from the Playlist.'
              }
              CardFigure={
                convertDateFormatyyyyMMdd(date) <
                  convertDateFormatyyyyMMdd(new Date())
                  ? DROPPED_SPOTS.length
                  : 0
              }
              COLOR={'#F55C52'}
              BackgroundColor="rgb(127 29 29 / 33%)" cursor={true}
            />
          </div>
          <div onClick={() => setCurTable('extraSpots')}>
            <StatisticCardwithfigure
              CardHeight={200}
              AnimateColorClass="order3"
              Icon={<LuListEnd style={{ fontSize: 35, color: '#6ee7b7' }} />}
              CardName="Extra spots on Aired"
              CardNote="Extra Telecasted Spots are additional advertisement slots aired beyond the originally scheduled spots."
              CardFigure={
                convertDateFormatyyyyMMdd(date) <
                  convertDateFormatyyyyMMdd(new Date())
                  ? EXTRA_TELECASTED_SPOTS.length
                  : 0
              }
              COLOR="#6ee7b7"
              BackgroundColor="rgb(6 78 59 / 47%)" cursor={true}
            />
          </div>
        </Card>
      </div>
      {curTable === 'extraSpots' ? (
        <ExtraTeleastedSpotsTable date={date} />
      ) : (
        <DroppedSpotsTable date={date} />
      )}
      <Loader showLoader={showLoader} />
    </>
  );
}

export default CloudPlayout;
