import {
  Alert,
  Button,
  Card,
  Checkbox,
  DatePicker,
  FormContainer,
  FormItem,
  Input,
  Select,
} from 'components/ui';
import React, { forwardRef, useEffect, useState, useRef } from 'react';
import ChannelSelecttion from 'views/Controls/ChannelSelecttion';
import { StickyFooter } from 'components/shared';
import {
  ProductwiseDrop,
  apiGetBrandasperclient,
  apiGetCommercialtypedropdown,
  apiGetSubproductmasterDrop,
  apiGetagencymasterDrop,
  apiGetbrandwiseproductDrop,
  apiGetclientasperagency,
  apiGetproductmasterDrop,
} from 'services/CreditcontrolService';
import {
  apiGetChannelmasterdrop,
  apiGetLanguagemaster,
  apiUSP_GenerateVideoID,
} from 'services/MasterService';
import { Postcommercial, Putcommercial } from 'services/SalesAdminService';
import {
  formatOnHHMMSSFFBlur,
  handleChangeWithFrameNew,
  openNotification,
  parseDuration,
} from 'views/Controls/GLOBALFUNACTION';
import { useDispatch, useSelector } from 'react-redux';
import { Toast } from 'primereact/toast';
import { useNavigate } from 'react-router-dom';
import useTimeOutMessage from 'utils/hooks/useTimeOutMessage';
import CommercialTypeDropNew from 'views/Controls/CommercialTypeDropNew';
import { HiCake } from 'react-icons/hi';
import { convertDateToYMD, validate } from 'components/validators';
import { apiGetNTCtypedropdown } from 'services/NTCService';
import { setQueryParams } from 'store/base/commonSlice';
import { apisendnotification } from 'services/ProgrammingService';

/* CONSTANTS */

const ContentDemo = [{ value: '1', label: 'Data Not Found' }];
const { DateTimepicker } = DatePicker;
const Layer = [
  { label: 'FRONT LAYER', value: 'FRONT LAYER' },
  { label: 'MID LAYER', value: 'MID LAYER' },
  { label: 'BACK LAYER', value: 'BACK LAYER' },
  ,
];

const CommercialMasterEdit = forwardRef((props, ref) => {
  /* REDUX */
  const currentRouteTitle = useSelector(
    (state) => state.base.common.currentRouteTitle,
  );
  const Path = useSelector((state) => state.base.common.Path);
  console.log("Path", Path)
  const DEFAULT_COMMERCIAL_TYPE_CODE = 1;
  const { Content } = useSelector((state) => state.base.common);
  const LoginId = useSelector((state) => state.auth.session.LoginId);
  const token = useSelector((state) => state.auth.session.token);
  const Username = useSelector((state) => state.auth.session.Username);
  const ChannelSetting = useSelector(
    (state) => state.auth.session.ChannelSetting,
  );
  const Channel = useSelector((state) => state.locale.selectedChannel);
  const isCopyModeActive = useSelector((state) => state.base.common).queryParams
    ?.copy;
  const dispatch = useDispatch();

  /* STATES */
  const IsNTCPage = Path == '/NTCCommercialMaster' ? true : false;
  const [log, setlog] = useState('');
  const [requiredFields, setRequiredFields] = useState({
    CommercialType: false,
    NTCTypeCode: false,
    Caption: false,
    Duration: false,
    Language: false,
    TCIN: false,
    TCOUT: false,
    Agency: false,
    Client: false,
    Brand: false,
    Product: false,
    SubProduct: false,
    TapeID: false,
    SourceRefNo: false,
  });
  const [formState, setFormState] = useState({
    Caption:
      Content.CommercialCaption && !isCopyModeActive
        ? Content.CommercialCaption
        : '',
    CommercialType: Content.CommercialTypeCode
      ? Content.CommercialTypeCode
      : DEFAULT_COMMERCIAL_TYPE_CODE,
    NTCTypeCode: Content.NTCTypeCode
      ? Content.NTCTypeCode
      : DEFAULT_COMMERCIAL_TYPE_CODE,

    TCIN: Content.TCIN ? Content.TCIN : '00:00:00:00',
    TCOUT: Content.TCOUT && !isCopyModeActive ? Content.TCOUT : '00:00:',
    Duration:
      Content.CommercialDuration && !isCopyModeActive
        ? Content.CommercialDuration
        : '',
    DurInSec: Content.DurInSec ? Content.DurInSec : '',
    VideoId: Content.VideoID ? Content.VideoID : '',
    HouseId: Content.HouseID ? Content.HouseID : '',
    TapeID: Content.TapeID && !isCopyModeActive ? Content.TapeID : null,
    SourceRefNo:
      Content.SourceRefNo && !isCopyModeActive ? Content.SourceRefNo : '',
    Agency: Content.AgencyCode ? Content.AgencyCode : null,
    Client: Content.ClientCode ? Content.ClientCode : null,
    Brand: Content.BrandCode ? Content.BrandCode : null,
    Product: Content.ProductCode ? Content.ProductCode : null,
    SubProduct: Content.SubProductCode ? Content.SubProductCode : null,
    Language: Content.LanguageCode ? Content.LanguageCode : null,
    StartDate: Content.StartDate ? Content.StartDate : null,
    RecievedOn: Content.RecievedOn ? Content.RecievedOn : null,
    Dated: Content.Dated ? Content.Dated : null,
    KillDate: Content.KillDate ? Content.KillDate : null,
    KillStartTime: Content.KillStartTime ? Content.KillStartTime : '',
    KillEndTime: Content.KillEndTime ? Content.KillEndTime : '',
    IsNTC: Content.IsNTC ? Content.IsNTC : null,
    NTCType: Content.NTCTypeCode ? Content.NTCTypeCode : null,
    Remarks: Content.Remarks ? Content.Remarks : null,
    Content: Content.ContentCode ? Content.ContentCode : null,
    Layer: Content.Layer ? Content.Layer : null,
    SceneName: Content.SceneName ? Content.SceneName : '',
    DelProvider: Content.DelProvider ? Content.DelProvider : '',
  });

  const [CommercialType, setCommercialType] = useState([]);
  const [Agency, setAgency] = useState([]);
  const [Client, setClient] = useState([]);
  const [Brand, setBrand] = useState([]);
  const [Product, setProduct] = useState([]);
  const [SubProduct, setSubProduct] = useState([]);
  const [Language, setLanguage] = useState([]);
  const [channelList, setChannelList] = useState([]);
  const [selectedchannel, setSelectedchannel] = useState(
    Content?.CommercialLocChnlMap
      ? Content.CommercialLocChnlMap.map((item, index) => ({
        Id: index,
        LocationCode: item.LocationCode,
        ChannelCode: item.ChannelCode,
      }))
      : [Channel].map((item, i) => ({
        Id: i,
        LocationCode: item.LocationCode,
        ChannelName: item.label,
        ChannelCode: item.ChannelCode,
      })),
  );

  const [Checkboxcon, setCheckboxcon] = useState(false);

  /* HOOKS */
  const toast = useRef(null);
  const navigate = useNavigate();
  const [message, setMessage] = useTimeOutMessage();
  const [NTCType, setNTCType] = useState([]);

  /* USE EFFECTS */
  useEffect(() => {
    byagecy(Content.AgencyCode);
    bycliet(Content.ClientCode);
    (async (values) => {
      const CommercialType = await apiGetCommercialtypedropdown(values);

      const formattedOptions = CommercialType.data.map((option) => ({
        value: option.CommercialTypeCode,
        label: option.CommercialTypeName,
      }));
      setCommercialType(formattedOptions);
    })();
    (async (values) => {
      const NTCType = await apiGetNTCtypedropdown(values);

      const formattedOptions = NTCType.data.map((option) => ({
        value: option.NTCTypeCode,
        label: option.NTCTypeName,
      }));
      setNTCType(formattedOptions);
    })();
    (async (values) => {
      const Language = await apiGetLanguagemaster(values);
      const formattedOptions = Language.data.map((option) => ({
        value: option.LanguageCode,
        label: option.LanguageName,
      }));
      setLanguage(formattedOptions);
    })();
    (async (values) => {
      const Agency = await apiGetagencymasterDrop(values);
      const formattedOptions = Agency.data.map((option) => ({
        value: option.AgencyCode,
        label: option.AgencyName,
      }));
      setAgency(formattedOptions);
    })();
    // ; (async (values) => {
    //     const Brand = await apiGetbrandmasterDrop(values)
    //     const formattedOptions = Brand.data.map((option) => ({
    //         value: option.BrandCode,
    //         label: option.BrandName,
    //     }))
    //     setBrand(formattedOptions)
    // })()
    (async (values) => {
      const Product = await apiGetproductmasterDrop(values);
      const formattedOptions = Product.data.map((option) => ({
        value: option.ProductCode,
        label: option.ProductName,
      }));
      setProduct(formattedOptions);
    })();
    (async (values) => {
      const SubProduct = await apiGetSubproductmasterDrop(values);
      const formattedOptions = SubProduct.data.map((option) => ({
        value: option.SubProductCode,
        label: option.SubProductName,
      }));
      setSubProduct(formattedOptions);
    })();
    (async (values) => {
      const resp = await apiGetChannelmasterdrop(LoginId);
      const channelsBYID = resp.data.map((channel, index) => ({
        Id: index,
        ChannelName: channel.ChannelName,
        ChannelCode: channel.ChannelCode,
        // ColorClass: colorClasses[index % colorClasses.length],
        LocationCode: channel.LocationCode,
        LocationName: channel.LocationName,
      }));
      setChannelList(channelsBYID);
    })();
    if ((!Content.VideoID && !Content.HouseID) || isCopyModeActive) {
      updateVideoIdAndHouseId(DEFAULT_COMMERCIAL_TYPE_CODE);
    }
    console.log('Content', Content);
    return () => dispatch(setQueryParams(null));
  }, []);

  useEffect(() => {
    if (formState.Brand) {
      (async (values) => {
        try {
          const api = await apiGetbrandwiseproductDrop(formState.Brand);
          if (api.status == 204) {
            openNotification('warning', 'Brand Not Found For This Client');
            setFormState((prevFormState) => ({
              ...prevFormState,
              Product: '',
            }));
            setFormState((prevFormState) => ({
              ...prevFormState,
              SubProduct: '',
            }));
          }
          if (api.status == 200) {
            setFormState((prevFormState) => ({
              ...prevFormState,
              Product: api.data.ProductCode,
            }));
            setFormState((prevFormState) => ({
              ...prevFormState,
              SubProduct: api.data.SubProductCode,
            }));
          }
        } catch (error) {
          if (error.response.status == 500) {
            openNotification('danger', 'Server Error.');
            setFormState((prevFormState) => ({
              ...prevFormState,
              Product: '',
            }));
            setFormState((prevFormState) => ({
              ...prevFormState,
              SubProduct: '',
            }));
          }
        }
      })();
    }
  }, [formState.Brand]);

  useEffect(() => {
    // Convert input time to Date object

    const timeParts = formState.TCOUT.split(':');
    const dateObj = new Date();
    dateObj.setHours(parseInt(timeParts[0], 10));
    dateObj.setMinutes(parseInt(timeParts[1], 10));
    dateObj.setSeconds(parseInt(timeParts[2], 10));
    dateObj.setMilliseconds(parseInt(timeParts[3], 10));

    // Convert duration to milliseconds
    const durationParts = formState.TCIN.split(':');
    const durationMilliseconds =
      parseInt(durationParts[0], 10) * 3600000 +
      parseInt(durationParts[1], 10) * 60000 +
      parseInt(durationParts[2], 10) * 1000 +
      parseInt(durationParts[3], 10);

    // Subtract duration from input time
    dateObj.setMilliseconds(dateObj.getMilliseconds() - durationMilliseconds);

    // Format the result
    const result = `${dateObj.getHours().toString().padStart(2, '0')}:${dateObj
      .getMinutes()
      .toString()
      .padStart(2, '0')}:${dateObj
        .getSeconds()
        .toString()
        .padStart(2, '0')}:${dateObj
          .getMilliseconds()
          .toString()
          .slice(0, 2)
          .padStart(2, '0')}`;

    if (formState.TCOUT.length > 6) {
      setFormState((prevFormState) => ({
        ...prevFormState,
        Duration: result,
        DurInSec: parseDuration(result),
      }));
    }
  }, [formState.TCIN, formState.TCOUT]);

  /* EVENT HANDLERS */
  const handleBlur = (event) => {
    const { name, value } = event.target;
    const formattedValue = formatOnHHMMSSFFBlur(value, Number(ChannelSetting[0]?.FramePerSec || 24));
    setFormState((prevFormState) => ({
      ...prevFormState,
      [name]: formattedValue,
    }));
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormState((prevFormState) => ({
      ...prevFormState,
      [name]: value,
    }));
  };

  const byagecy = async (val) => {
    try {
      const resp = await apiGetclientasperagency(val);
      // console.log(resp);
      if (resp.status == 204) {
        openNotification('warning', 'Client Not Found For This Agency');
        setClient([]);
      }
      if (resp.status == 200) {
        const formattedOptions = resp.data.map((option) => ({
          value: option.ClientCode,
          label: option.ClientName,
        }));
        setClient(formattedOptions);
      }
    } catch (error) {
      console.log(error);
      if (error.response.status == 500) {
        openNotification('danger', 'Server Error.');
        setClient([]);
      }
    }
  };
  const bycliet = async (val) => {
    try {
      const resp = await apiGetBrandasperclient(val);
      // console.log(resp);
      if (resp.status == 204) {
        openNotification('warning', 'Brand Not Found For This Client');
        setBrand([]);
      }
      if (resp.status == 200) {
        const brandOptions =
          resp.data != ''
            ? resp.data.map((option) => ({
              value: option.BrandMaster.BrandCode,
              label: option.BrandMaster.BrandName,
            }))
            : [];
        setBrand(brandOptions);
      }
    } catch (error) {
      console.log(error);
      if (error.response.status == 500) {
        openNotification('danger', 'Server Error.');
        setBrand([]);
      }
    }
  };

  const handleInputChange2 = (value, name) => {
    setFormState((prevFormState) => ({
      ...prevFormState,
      [name]: value,
    }));
  };

  const onCheck = (e) => {
    setCheckboxcon(!Checkboxcon);
  };

  const handleCommercialTypeChange = (e) => {
    try {
      updateVideoIdAndHouseId(e);
    } catch (error) {
      console.error(error);
    }
  };

  /* CORE FUNCTIONS */
  const dropsubproduct = async (values) => {
    try {
      const Content = await ProductwiseDrop(values);

      const formattedOptions2 = Content.data.map((option) => ({
        value: option.SubProductCode,
        label: option.SubProductName,
      }));
      setSubProduct(formattedOptions2);
    } catch (error) {
      setSubProduct([]);
    }
  };

  const apiUpdate = async () => {
    const emptyFields = checkFieldsNotEmpty(
      formState,
      Object.keys(requiredFields),
    );
    if (formState.Duration == '00:00:00:00') {
      setMessage('Duration cannot be zero.');
      return;
    }
    if (emptyFields.length === 0) {
      const mergedData = {
        commercialmaster: {
          CommercialCaption: formState.Caption,
          CommercialTypeCode:
            Path == '/NTCCommercialMaster' ? 1 : formState.CommercialType,
          NTCTypeCode:
            Path != '/NTCCommercialMaster' ? 0 : formState.NTCTypeCode,
          TCIN: formState.TCIN,
          TCOUT: formState.TCOUT,
          CommercialDuration: formState.Duration,
          DurInSec: formState.DurInSec,
          HouseID: formState.HouseId,
          VideoID: formState.VideoId,
          TapeID: formState.TapeID,
          SourceRefNo: formState.SourceRefNo,
          AgencyCode: formState.Agency,
          ClientCode: formState.Client,
          BrandCode: formState.Brand,
          ProductCode: formState.Product,
          SubProductCode: formState.SubProduct,

          LanguageCode: formState.Language,
          StartDate: formState.StartDate,
          RecievedOn: formState.RecievedOn,
          Dated: Checkboxcon ? 1 : 0,
          KillDate: formState.KillDate,
          KillStartTime: formState.KillStartTime,
          KillEndTime: formState.KillEndTime,
          IsNTC: Path == '/NTCCommercialMaster' ? 1 : 0,

          Remarks: formState.Remarks,
          ContentCode: 0,
          Layer: formState.Layer,
          SceneName: formState.SceneName,
          DelProvider: formState.DelProvider,
          IsActive: 1,
        },
        locchnlmap: selectedchannel.map((item) => ({
          LocationCode: item.LocationCode,
          ChannelCode: item.ChannelCode,
        })),
      };

      try {
        const resp = await Putcommercial(
          mergedData,
          token,
          Content.CommercialCode,
        );
        if (resp.status === 200) {
          openNotification('success', 'Data Updated Successfully');
          await apisendnotification({
            NotificationId: (Math.random() + 1).toString(36).substring(7),
            user_ids: [4],
            message: formState.Caption + ' Commercial Modified.',
            image: '',
            type: '1',
            location: 'Commercial Modified.',
            locationLabel: Username,
            Status: '1',
            isGroup: 1,
            Ispriority: 1,
            readed: 0,
          });
          navigate(
            Path == '/NTCCommercialMaster'
              ? '/NTCCommercialMaster'
              : '/commercialmaster',
          );

          return;
        }
        if (resp.status === 204) {
          openNotification('danger', 'Data Already Exists.');
          return;
        }
      } catch (errors) {
        if (errors.response.status == 500) {
          openNotification('danger', 'Server Error.');
        }

        return;
      }
    } else {
      emptyFields.forEach((field) => {
        setRequiredFields((prevRequiredFields) => ({
          ...prevRequiredFields,
          [field]: true,
        }));
      });
    }
  };

  const checkFieldsNotEmpty = (formState, requiredFields) => {
    const emptyFields = [];

    for (const field of requiredFields) {
      if (!formState[field]) {
        emptyFields.push(field);
      }
    }

    return emptyFields;
  };

  const apiadd = async () => {
    // handleCommercialTypeChange(Number(formState.CommercialType))
    if (selectedchannel.length > 0) {
      const emptyFields = checkFieldsNotEmpty(
        formState,
        Object.keys(requiredFields),
      );
      if (formState.Duration == '00:00:00:00') {
        setMessage('Duration cannot be zero.');
        return;
      }
      if (emptyFields.length === 0) {
        const mergedData = {
          commercialmaster: {
            CommercialCaption: formState.Caption,
            CommercialTypeCode:
              Path == '/NTCCommercialMaster' ? 1 : formState.CommercialType,
            NTCTypeCode:
              Path != '/NTCCommercialMaster' ? 0 : formState.NTCTypeCode,
            TCIN: formState.TCIN,
            TCOUT: formState.TCOUT,
            CommercialDuration: formState.Duration,
            DurInSec: formState.DurInSec,
            HouseID: formState.HouseId,
            VideoID: formState.VideoId,
            TapeID: formState.TapeID,
            SourceRefNo: formState.SourceRefNo,
            AgencyCode: formState.Agency,
            ClientCode: formState.Client,
            BrandCode: formState.Brand,
            ProductCode: formState.Product,
            SubProductCode: formState.SubProduct,
            LanguageCode: formState.Language,
            StartDate: formState.StartDate,
            RecievedOn: formState.RecievedOn,
            Dated: Checkboxcon ? 1 : 0,
            KillDate: formState.KillDate,
            KillStartTime: formState.KillStartTime,
            KillEndTime: formState.KillEndTime,
            IsNTC: Path == '/NTCCommercialMaster' ? 1 : 0,

            Remarks: formState.Remarks,
            ContentCode: 0,
            Layer: formState.Layer,
            SceneName: formState.SceneName,
            DelProvider: formState.DelProvider,
            IsActive: 1,
          },
          locchnlmap: selectedchannel.map((item) => ({
            LocationCode: item.LocationCode,
            ChannelCode: item.ChannelCode,
          })),
          genvideoId: {
            LocationCode: Channel.LocationCode,
            ChannelCode: Channel.ChannelCode,
            FormName: IsNTCPage ? 'NTC Master' : 'Commercial master',
            EventTypeCode: IsNTCPage
              ? Number(formState.NTCTypeCode)
              : Number(formState.CommercialType),
            Mode: 1,
          },
        };
        try {
          const resp = await Postcommercial(mergedData, token);
          if (resp.status === 200) {
            openNotification('success', 'Data Inserted Successfully.');
            await apisendnotification({
              NotificationId: (Math.random() + 1).toString(36).substring(7),
              user_ids: [4],
              message: formState.Caption + ' Commercial Added.',
              image: '',
              type: '1',
              location: 'Commercial Added.',
              locationLabel: Username,
              Status: '1',
              isGroup: 1,
              Ispriority: 1,
              readed: 0,
            });
            navigate(
              Path == '/NTCCommercialMaster'
                ? '/NTCCommercialMaster'
                : '/commercialmaster',
            );

            return;
          }
          if (resp.status === 204) {
            openNotification('danger', 'Data Already Exists.');
            return;
          }
        } catch (errors) {
          if (errors.response.status == 500) {
            openNotification('danger', 'Server Error.');
          }

          return;
        }
      } else {
        // Display popups for each empty field
        emptyFields.forEach((field) => {
          setRequiredFields((prevRequiredFields) => ({
            ...prevRequiredFields,
            [field]: true,
          }));
        });
      }
    } else {
      setlog('danger');
      setMessage('Kindly Select Channel ');
    }
  };

  const updateVideoIdAndHouseId = async (commercialTypeCode) => {
    console.log(';commercialTypeCode', commercialTypeCode);
    console.log(';Channel', Channel);
    console.log(';ChannelSetting', ChannelSetting);
    try {
      if (Object.keys(Channel).length > 0) {
        if (ChannelSetting[0]?.IsTapeCounterFlag === 1) {
          (async (values) => {
            try {
              const resp = await apiUSP_GenerateVideoID(
                Channel.LocationCode,
                Channel.ChannelCode,
                IsNTCPage ? 'NTC Master' : 'Commercial master',
                commercialTypeCode,
                0,
              );
              console.log('resp', resp);
              if (formState.HouseId != resp.data[0].CommVideoID) {
                setMessage('HouseId Updated');
              }
              setFormState((prevFormState) => ({
                ...prevFormState,
                HouseId: resp.data[0].CommVideoID,
              }));
              setFormState((prevFormState) => ({
                ...prevFormState,
                VideoId: resp.data[0].CommVideoID,
              }));
            } catch (error) {
              if (error) {
                setMessage(
                  'HouseId Is Not Configured With This Commercial Type',
                );
                setFormState((prevFormState) => ({
                  ...prevFormState,
                  HouseId: '',
                }));

                setFormState((prevFormState) => ({
                  ...prevFormState,
                  VideoId: '',
                }));
              }
              if (error.response.status == 500) {
                setFormState((prevFormState) => ({
                  ...prevFormState,
                  HouseId: '',
                }));
                setFormState((prevFormState) => ({
                  ...prevFormState,
                  VideoId: '',
                }));
              }
            }
          })();
        } else {
          setMessage(
            'IsTapeCounterFlag Is Not Configured With This Commercial Type',
          );
        }
      } else {
        setMessage('Please Select Global Channal');
      }
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <Card>
      {message && (
        <Alert className="mb-4" type={log} showIcon>
          {message}
        </Alert>
      )}

      <div className="border-b-2 border-inherit mb-2">
        <h1 className="text-xl font-semibold">{currentRouteTitle}</h1>
      </div>

      <Toast ref={toast} />
      <FormContainer>
        <div className="grid grid-cols-3 gap-4">
          <div className="col-span-2 ">
            <div className="grid grid-cols-9 gap-2 mb-5">
              <div className="col-span-3">
                {Path == '/NTCCommercialMasterEdit' ? (
                  <FormItem
                    label="NTC Type"
                    asterisk
                    errorMessage={
                      requiredFields.NTCTypeCode ? 'NTC Type  Required' : null
                    }
                    invalid={
                      requiredFields.NTCTypeCode && requiredFields.NTCTypeCode
                    }
                  >
                    <CommercialTypeDropNew
                      selected={formState.NTCTypeCode}
                      setSelected={setFormState}
                      List={NTCType}
                      name={'NTCTypeCode'}
                      handleCommercialTypeChange={handleCommercialTypeChange}
                    />
                  </FormItem>
                ) : (
                  <FormItem
                    label="Commercial Type"
                    asterisk
                    errorMessage={
                      requiredFields.CommercialType
                        ? 'Commercial Type  Required'
                        : null
                    }
                    invalid={
                      requiredFields.CommercialType &&
                      requiredFields.CommercialType
                    }
                  >
                    <CommercialTypeDropNew
                      selected={formState.CommercialType}
                      setSelected={setFormState}
                      List={CommercialType}
                      name={'CommercialType'}
                      handleCommercialTypeChange={handleCommercialTypeChange}
                    />
                  </FormItem>
                )}
              </div>
              <div className="col-span-6">
                <FormItem
                  label="Caption"
                  asterisk
                  errorMessage={
                    requiredFields.Caption ? 'Caption Is Required' : null
                  }
                  invalid={requiredFields.Caption && requiredFields.Caption}
                >
                  <Input
                    size="sm"
                    name="Caption"
                    placeholder="Caption"
                    value={formState.Caption}
                    maxLength="250"
                    onChange={handleInputChange}
                  />
                </FormItem>
              </div>
              <div className="col-span-3">
                <FormItem
                  label="Agency Tape Id"
                  asterisk
                  errorMessage={
                    requiredFields.TapeID ? 'TapeID Is Required' : null
                  }
                  invalid={requiredFields.TapeID && requiredFields.TapeID}
                >
                  <Input
                    size="sm"
                    name="TapeID"
                    placeholder="Agency Tape Id"
                    value={formState.TapeID}
                    maxLength="10"
                    onChange={(e) => {
                      const { name, value } = e.target;
                      if (/^[0-9a-zA-Z\s]*$/.test(value)) {
                        setFormState((prevFormState) => ({
                          ...prevFormState,
                          [name]: value,
                        }));
                      }
                    }}
                  />
                </FormItem>
              </div>
              <div className="col-span-3">
                <FormItem label="Video Id">
                  <Input
                    size="sm"
                    disabled={
                      ChannelSetting[0]?.IsTapeCounterFlag === 1 ? true : false
                    }
                    name="VideoId"
                    maxLength="10"
                    placeholder="VideoId"
                    value={formState.VideoId}
                    onChange={handleInputChange}
                  />
                </FormItem>
              </div>
              <div className="col-span-3">
                <FormItem label="House Id">
                  <Input
                    size="sm"
                    disabled={
                      ChannelSetting[0]?.IsTapeCounterFlag === 1 ? true : false
                    }
                    name="HouseId"
                    maxLength="10"
                    placeholder="HouseId"
                    value={formState.HouseId}
                    onChange={handleInputChange}
                  />
                </FormItem>
              </div>
              <div className="col-span-3">
                <FormItem
                  label="Language"
                  asterisk
                  errorMessage={
                    requiredFields.Language ? 'Language Is Required' : null
                  }
                  invalid={requiredFields.Language && requiredFields.Language}
                >
                  <CommercialTypeDropNew
                    selected={formState.Language}
                    setSelected={setFormState}
                    List={Language}
                    name={'Language'}
                  />
                </FormItem>
              </div>
              <div className="col-span-3">
                <FormItem
                  label="Source Ref No."
                  asterisk
                  errorMessage={
                    requiredFields.SourceRefNo
                      ? 'SourceRefNo Is Required'
                      : null
                  }
                  invalid={
                    requiredFields.SourceRefNo && requiredFields.SourceRefNo
                  }
                >
                  <Input
                    size="sm"
                    name="SourceRefNo"
                    placeholder="SourceRefNo"
                    value={formState.SourceRefNo}
                    maxLength="10"
                    onChange={handleInputChange}
                  />
                </FormItem>
              </div>
              <div className="col-span-3">
                <FormItem label="Layer">
                  <CommercialTypeDropNew
                    selected={formState.Layer}
                    setSelected={setFormState}
                    List={Layer}
                    name={'Layer'}
                  />
                </FormItem>
              </div>
            </div>
            <Card>
              <div className="grid grid-cols-4 gap-2">
                <div className="col-span-1">
                  <FormItem
                    label="TC IN"
                    asterisk
                    errorMessage={
                      requiredFields.TCIN ? 'Kindly Enter TC IN' : null
                    }
                    invalid={requiredFields.TCIN && requiredFields.TCIN}
                  >
                    <Input
                      size="sm"
                      placeholder="TC IN"
                      maxLength="12"
                      name="TCIN"
                      disabled
                      value={formState.TCIN}
                      onChange={(e) =>
                        handleChangeWithFrameNew(e, setFormState, Number(ChannelSetting[0]?.FramePerSec || 24))
                      }
                      onBlur={handleBlur}
                    />
                  </FormItem>
                </div>
                <div className="col-span-1">
                  <FormItem
                    label="TC OUT"
                    asterisk
                    errorMessage={
                      requiredFields.TCOUT ? 'Kindly Enter TC OUT' : null
                    }
                    invalid={requiredFields.TCOUT && requiredFields.TCOUT}
                  >
                    <Input
                      size="sm"
                      placeholder="TC OUT"
                      name="TCOUT"
                      maxLength="12"
                      value={formState.TCOUT}
                      onChange={(e) =>
                        handleChangeWithFrameNew(e, setFormState, Number(ChannelSetting[0]?.FramePerSec || 24))
                      }
                      onBlur={handleBlur}
                    />
                  </FormItem>
                </div>
                <div className="col-span-1">
                  <FormItem
                    label="Duration"
                    asterisk
                    errorMessage={
                      requiredFields.Duration ? 'Duration Is Required' : null
                    }
                    invalid={requiredFields.Duration && requiredFields.Duration}
                  >
                    <Input
                      disabled
                      size="sm"
                      placeholder="HH:MM:SS:FF"
                      name="Duration"
                      value={formState.Duration}
                      onChange={(e) =>
                        handleChangeWithFrameNew(e, setFormState, Number(ChannelSetting[0]?.FramePerSec || 24))
                      }
                    />
                  </FormItem>
                </div>
                <div className="col-span-1">
                  <FormItem
                    label="Dur In Sec"
                    asterisk
                    errorMessage={
                      requiredFields.DurInSec ? 'DurInSec Required' : null
                    }
                    invalid={requiredFields.DurInSec && requiredFields.DurInSec}
                  >
                    <Input
                      size="sm"
                      name="DurInSec"
                      disabled
                      placeholder="DurInSec"
                      value={formState.DurInSec}
                      onChange={handleInputChange}
                    />
                  </FormItem>
                </div>
              </div>
            </Card>
            <br></br>
            <Card>
              <div className="grid grid-cols-4 gap-2">
                <div className="col-span-2">
                  <FormItem
                    label="Agency"
                    asterisk
                    errorMessage={
                      requiredFields.Agency ? 'Agency Required' : null
                    }
                    invalid={requiredFields.Agency && requiredFields.Agency}
                  >
                    <CommercialTypeDropNew
                      selected={formState.Agency}
                      setSelected={setFormState}
                      List={Agency}
                      name={'Agency'}
                      byagecy={byagecy}
                    />
                  </FormItem>
                </div>
                <div className="col-span-2">
                  <FormItem
                    label="Client"
                    asterisk
                    errorMessage={
                      requiredFields.Client ? 'Client Required' : null
                    }
                    invalid={requiredFields.Client && requiredFields.Client}
                  >
                    <CommercialTypeDropNew
                      selected={formState.Client}
                      setSelected={setFormState}
                      List={Client}
                      name={'Client'}
                      byagecy={bycliet}
                    />
                  </FormItem>
                </div>
                <div className="col-span-1">
                  <FormItem
                    label="Brand"
                    asterisk
                    errorMessage={
                      requiredFields.Brand ? 'Brand Required' : null
                    }
                    invalid={requiredFields.Brand && requiredFields.Brand}
                  >
                    <CommercialTypeDropNew
                      selected={formState.Brand}
                      setSelected={setFormState}
                      List={Brand}
                      name={'Brand'}
                    />
                  </FormItem>
                </div>

                <div className="col-span-1">
                  <FormItem
                    asterisk
                    label="Product"
                    errorMessage={
                      requiredFields.Product ? 'Product Required' : null
                    }
                    invalid={requiredFields.Product && requiredFields.Product}
                  >
                    <Select
                      style={{
                        width: '250px',
                      }}
                      options={Product}
                      value={
                        Product.length > 0
                          ? Product.filter(
                            (option) => option.value == formState.Product,
                          )
                          : ContentDemo.filter(
                            (option) => option.value == formState.Product,
                          )
                      }
                      isDisabled
                    />
                  </FormItem>
                </div>
                <div className="col-span-1">
                  <FormItem
                    label="SubProduct"
                    asterisk
                    errorMessage={
                      requiredFields.SubProduct ? 'SubProduct Required' : null
                    }
                    invalid={
                      requiredFields.SubProduct && requiredFields.SubProduct
                    }
                  >
                    <Select
                      style={{
                        width: '250px',
                      }}
                      options={SubProduct}
                      value={
                        SubProduct.length > 0
                          ? SubProduct.filter(
                            (option) => option.value == formState.SubProduct,
                          )
                          : ContentDemo.filter(
                            (option) => option.value == formState.SubProduct,
                          )
                      }
                      isDisabled
                    />
                  </FormItem>
                </div>
              </div>
            </Card>
            <br></br>
            <Checkbox onChange={(e) => onCheck(e)}>Is Dated</Checkbox>
          </div>
          <div className="col-span-1">
            <Card>
              <ChannelSelecttion
                List={channelList}
                selectedList={selectedchannel}
                setSelectedList={setSelectedchannel}
              />
            </Card>
          </div>
        </div>
        {Checkboxcon ? (
          <Card>
            <div className="grid grid-cols-10 gap-4">
              <div className="col-span-2 ">
                <FormItem label="Start Date">
                  <DateTimepicker
                    size="sm"
                    name="StartDate"
                    prefix={<HiCake className="text-xl" />}
                    defaultValue={
                      validate(formState.StartDate)
                        ? new Date(formState.StartDate)
                        : ''
                    } // Set defaultValue to current date
                    onChange={(date) => {
                      handleInputChange2(convertDateToYMD(date), 'StartDate');
                    }}
                  />
                </FormItem>
              </div>
              <div className="col-span-2 ">
                <FormItem label="Recieved on">
                  <DatePicker
                    size="sm"
                    name="Recieved on"
                    prefix={<HiCake className="text-xl" />}
                    defaultValue={
                      validate(formState.RecievedOn)
                        ? new Date(formState.RecievedOn)
                        : ''
                    } // Set defaultValue to current date
                    onChange={(date) => {
                      handleInputChange2(convertDateToYMD(date), 'RecievedOn');
                    }}
                  />
                </FormItem>
              </div>

              <div className="col-span-2 ">
                <FormItem label="Kill Date">
                  <DateTimepicker
                    size="sm"
                    name="KillDate"
                    prefix={<HiCake className="text-xl" />}
                    onChange={(date) => {
                      handleInputChange2(convertDateToYMD(date), 'KillDate');
                    }}
                  />
                </FormItem>
              </div>
            </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="col-span-2 ">
                <FormItem label="Remarks">
                  <Input
                    Textarea
                    size="lg"
                    name="Remarks"
                    maxLength="50"
                    placeholder="Remarks"
                    value={formState.Remarks}
                    onChange={handleInputChange}
                  />
                </FormItem>
              </div>
            </div>
          </Card>
        ) : null}
      </FormContainer>
      <StickyFooter
        className="-mx-8 px-8 flex items-center justify-between py-4"
        stickyClass="border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"
      >
        <div className="md:flex items-center">
          {Content.CommercialCode && !isCopyModeActive ? (
            <Button variant="solid" type="submit" onClick={() => apiUpdate()}>
              Update
            </Button>
          ) : (
            <Button variant="solid" type="button" onClick={() => apiadd()}>
              Submit
            </Button>
          )}
          &nbsp;
          <Button
            type="button"
            onClick={() =>
              navigate(
                Path == '/NTCCommercialMaster'
                  ? '/NTCCommercialMaster'
                  : '/commercialmaster',
              )
            }
          >
            Discard
          </Button>
        </div>
      </StickyFooter>
    </Card>
  );
});

export default CommercialMasterEdit;
