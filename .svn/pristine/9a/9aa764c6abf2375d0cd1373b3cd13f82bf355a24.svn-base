(self.webpackChunkelstar=self.webpackChunkelstar||[]).push([[1360],{25579:(e,t,a)=>{"use strict";a.d(t,{Ei:()=>x,I6:()=>y,Qj:()=>d,U$:()=>u,Uy:()=>D,Z_:()=>r,_K:()=>g,b6:()=>c,d:()=>l,db:()=>f,fh:()=>h,gg:()=>p,hu:()=>o,iD:()=>i,rd:()=>m,w_:()=>C});a(54048);var s=a(46152),n=a(54748);a(74569);async function o(e){return s.Z.fetchData({url:"/dealmaster/".concat(e),method:"get"})}async function r(e){return s.Z.fetchData({url:"/dealattachment/".concat(e),method:"get"})}async function c(e,t,a){return s.Z.fetchData({url:"/dealmaster/dealforapproval/?DealNumber=".concat(e,"&IsApproved=").concat(t,"&RejectRemark=").concat(a),method:"get"})}async function l(e,t){return s.Z.fetchData({url:"/dealmaster/?LocationCode=".concat(e.LocationCode,"&ChannelCode=").concat(e.ChannelCode,"&StartDate=").concat((0,n.Tk)(t[0]),"&EndDate=").concat((0,n.Tk)(t[1])),method:"get"})}async function d(e){return s.Z.fetchData({url:"/sponsortypemaster/drop/",method:"get",data:e})}async function i(e){return s.Z.fetchData({url:"/spottypemaster/drop/",method:"get",data:e})}async function u(e){return s.Z.fetchData({url:"/dealdetail/".concat(e),method:"get"})}async function m(e){return s.Z.fetchData({url:"/dealmaster/USP_Sch_DealConsumptionCheck/?DealNumber=".concat(e),method:"get"})}async function h(e,t,a,n,o,r){return s.Z.fetchData({url:"/dealmaster/bindstartnendtime/?LocationCode=".concat(o,"&ChannelCode=").concat(r,"&DealPeriodToDate=").concat(e,"&DealPeriodFromDate=").concat(t,"&ContentCode=").concat(a,"&OriginalRepeatCode=").concat(n),method:"get"})}async function g(e,t,a){return s.Z.fetchData({url:"/bookingdetails/bookingchange/?flag=".concat(e,"&IsNtc=").concat(a),method:"put",data:t})}async function p(e,t){var a={params:t};return s.Z.fetchData({url:"/callstoreprocedure/"+e,data:a,method:"post"})}async function x(e){return s.Z.fetchData({url:"/callstoreprocedure/"+e,data:{params:{}},method:"post"})}async function y(e,t,a){var n={params:{Bookingcode:t,IsNTC:a}};return s.Z.fetchData({url:"/callstoreprocedure/"+e,data:n,method:"post"})}async function f(e){var t={params:{CheckMonth:e}};return s.Z.fetchData({url:"/callstoreprocedure/USP_DealDashboardDoughnut",data:t,method:"post"})}async function D(e,t){var a={params:{BookingNumber:t,deallineitemno:0}};return s.Z.fetchData({url:"/callstoreprocedure/"+e,data:a,method:"post"})}async function C(e){return s.Z.fetchData({url:"currencyexchangerate/?basecurrency=".concat(e),method:"post"})}},47176:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var s=a(1413),n=a(72791),o=a(34786),r=a(2803),c=a(96361),l=a(87537),d=a(54652),i=a(81721),u=a(81320),m=a(60488),h=a(58617),g=a(81694),p=a.n(g),x=a(31362),y=a(25579),f=a(60364),D=a(93673),C=a(47475),S=a(80184);const b=[{header:"Agency",accessorKey:"AgencyName"},{header:"Client",accessorKey:"ClientName"},{header:"Brand",accessorKey:"BrandName"},{header:"Commercial",accessorKey:"CommercialCaption"},{header:"Duration",accessorKey:"CommercialDuration"},{header:"Content",accessorKey:"ContentName"},{header:"Schedule Date",accessorKey:"BookingScheduleDate"},{header:"Re-Schedule Date",accessorKey:"BookingRescheduleDate"},{header:"Schedule Time",accessorKey:"ScheduleTime"},{header:"Spot Rate",accessorKey:"SpotRate"},{header:"Spot Amount",accessorKey:"SpotAmount"},{header:"Line Item From Date",accessorKey:"LineItemFromDate"},{header:"Line Item End Date",accessorKey:"LineItemEndDate"},{header:"BookingCode",accessorKey:"BookingCode"}],j=()=>{var e;const t=window.location.href.split("#")[1],a=t?t.split("/")[1]:"";let g="SpotRescheduling"==a||"DropSpotReschedule"==a?0:1,j=a.toLowerCase().includes("drop")?1:0;const v=(0,f.useSelector)((e=>e.locale.selectedChannel)),[N,k]=(0,n.useState)(""),[R,w]=(0,n.useState)([]),[Z,I]=(0,n.useState)([""]),[A,E]=(0,n.useState)({}),[T,B]=(0,n.useState)([]),[K,F]=(0,n.useState)([]),[L,z]=(0,n.useState)([]),[M,O]=(0,n.useState)([]),[P,_]=(0,n.useState)([]),[V,U]=(0,n.useState)(!1),[H,J]=(0,n.useState)([]),[Q,$]=(0,n.useState)({pageIndex:0,pageSize:10}),[q,Y]=(0,n.useState)({}),[G,W]=(0,n.useState)(!0);(0,n.useEffect)((()=>{try{G&&((0,m.Dh)(),(async e=>{const t=(await(0,o.Q8)(void 0)).data.map((e=>({label:e.ClientName,value:e.ClientCode})));I(t)})(),W(!1))}catch(e){console.error(e)}}),[G]),(0,n.useEffect)((()=>{se()}),[a]),(0,n.useEffect)((()=>{(async()=>{var e;if(2===(null===A||void 0===A||null===(e=A.datesrange)||void 0===e?void 0:e.length)&&A.datesrange[0]&&A.datesrange[1]){var t;let e="B R";console.log("Channel",v),1==j&&(e="E");const a=await(0,o.Z_)(A,R,0,e,g,v.LocationCode,v.ChannelCode);if((null===a||void 0===a||null===(t=a.data)||void 0===t?void 0:t.length)>0){const e=a.data.map((e=>(0,s.Z)((0,s.Z)({},e),{},{RescheduleDate:"-",BookingRescheduleDate:"-"})));B(e)}else B([])}})()}),[A.datesrange,v]),(0,n.useEffect)((()=>{try{A.rescheduleDate&&X(A.rescheduleDate)}catch(e){console.error(e)}}),[A.rescheduleDate]),(0,n.useEffect)((()=>{try{O(ee(L)),te(L),ae()}catch(e){console.error(e)}}),[L]);const X=e=>{try{const t=new Date(e);t.setHours(0,0,0,0),B((e=>{const a=Object.assign([],e);return a.forEach((e=>{const a=new Date(e.LineItemFromDate);a.setHours(0,0,0,0);const s=new Date(e.LineItemEndDate);s.setHours(0,0,0,0),e.disableSelection=!(t>=a&&t<=s)})),a}))}catch(t){console.error(t)}},ee=e=>{try{if(!Array.isArray(e))return[];const t=e.reduce(((e,t)=>{if(t){const a="".concat(t.CommercialCaption,"-").concat(t.CommercialDuration);return e[a]||(e[a]={CommercialCaption:t.CommercialCaption,CommercialDuration:t.CommercialDuration,CurrencySymbol:t.CurrencySymbol,SpotAmountSum:0,TotalDuration:0,TotalCount:0}),e[a].SpotAmountSum+=t.SpotAmount,e[a].TotalDuration+=(0,u.parseDuration)(t.CommercialDuration),e[a].TotalCount++,e}}),{});return Object.values(t||0)}catch(t){throw t}},te=e=>{try{const t=e.reduce(((e,t)=>(t&&(e.spotAmountSum+=t.SpotAmount,e.spotRateSum+=t.SpotRate,e.Duration+=(0,u.parseDuration)(t.CommercialDuration)),e)),{spotAmountSum:0,spotRateSum:0,Duration:0});_(t)}catch(t){throw t}},ae=()=>{try{let e=Object.assign([],T);if(K.length<L.length)L.forEach((t=>{"-"===t.RescheduleDate&&!1===t.disableSelection&&(e[t.rowIndex].RescheduleDate=A.rescheduleDate,e[t.rowIndex].BookingRescheduleDate=A.bookingRescheduleDate)}));else{(0,u.getMissingObjectsInSubJSONArray)(K,L,"rowIndex").forEach((t=>{e[t.rowIndex].RescheduleDate="-",e[t.rowIndex].BookingRescheduleDate="-"}))}F(L),B(e)}catch(e){throw e}},se=()=>{k(""),w([]),E({}),B([]),F([]),z([]),O([]),_([]),U(!1),J([]),$({pageIndex:0,pageSize:10}),Y({}),W(!0)};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(r.Zb,{header:(0,S.jsx)(c.Z,{}),children:[(0,S.jsx)("div",{className:"mb-5",children:(0,S.jsxs)("div",{className:"grid grid-cols-4 gap-x-5",children:[(0,S.jsxs)("div",{className:"col-span-4",children:[(0,S.jsx)("p",{className:"lbale",children:"Search Client"}),Z&&(0,S.jsx)(d.Z,{className:"block",SelectedItem:R,setSelectedItem:w,data:Z,placeholder:"Search Client...",setInputValue:k,InputValue:N,ResetData:se})]}),(0,S.jsx)("div",{className:"col-span-1",children:0!=(null===R||void 0===R?void 0:R.length)&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("p",{className:"lbale",children:"Select Date Range"}),(0,S.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,S.jsx)(l.Z,{placeholder:"Select date range",minDate:new Date,style:{fontSize:"15px",marginRight:"10px"},onChange:e=>{E((t=>(0,s.Z)((0,s.Z)({},t),{},{datesrange:e})))}})})]})}),(0,S.jsx)("div",{className:"col-span-1",children:0!=(null===R||void 0===R?void 0:R.length)&&2===(null===A||void 0===A||null===(e=A.datesrange)||void 0===e?void 0:e.length)&&(null===A||void 0===A?void 0:A.datesrange[0])&&(null===A||void 0===A?void 0:A.datesrange[1])&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("p",{className:"lbale",children:"Reschedule To"}),(0,S.jsx)(x.ZP,{minDate:new Date,placeholder:"Pick a date",onChange:e=>{(e=>{try{const t=e.getFullYear(),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),r="".concat(t,"-").concat(n,"-").concat(o,"T00:00:00"),c="".concat(e.getDate(),"-").concat(a,"-").concat(t);E((e=>(0,s.Z)((0,s.Z)({},e),{},{rescheduleDate:r,bookingRescheduleDate:c})))}catch(t){console.error(t)}})(e)},clearable:!1})]})})]})}),T.length>0&&(0,S.jsx)(S.Fragment,{children:A.rescheduleDate?(0,S.jsx)(D.Z,{tableData:T,tableName:"spotRescheduling",originalColumns:b,managedColumns:H,setManagedColumns:J,exportFile:!1,columnsToFormatInINR:[],tableType:C.$.tableTypes.SELECTABLE,setSelectedRows:z,paginationState:Q,setPaginationState:$,rowSelection:q,setRowSelection:Y}):(0,S.jsx)(D.Z,{tableData:T,tableName:"spotRescheduling",originalColumns:b,managedColumns:H,setManagedColumns:J,exportFile:!1,columnsToFormatInINR:[]})})]}),L.length>0&&(0,S.jsxs)(i.gi,{className:"-mx-8 px-8 flex items-center justify-between py-4 pt-2 pb-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[(0,S.jsxs)("div",{className:"md:flex items-center",children:[(0,S.jsx)(r.zx,{onClick:()=>U(!0),variant:"solid",type:"submit",size:"sm",children:"Proceed to Reschedule"}),"\xa0",(0,S.jsx)(r.zx,{onClick:()=>se(),type:"button",size:"sm",children:"Discard"})]}),(0,S.jsxs)("div",{id:"myblock",className:"grid grid-cols-4 md:grid-cols-4 lg:grid-cols-4 gap-6 p-4 pt-0 pb-1 bg-gray-100 dark:bg-gray-800",children:[(0,S.jsxs)("div",{className:"flex flex-col lbl",children:[(0,S.jsx)("span",{className:"font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Total Spots"}),(0,S.jsx)("span",{className:"font-medium text-lg text-teal-500",children:T.length})]}),(0,S.jsxs)("div",{className:"flex flex-col lbl",children:[(0,S.jsx)("span",{className:"font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Selected Spots"}),(0,S.jsx)("span",{className:"font-medium text-lg text-teal-500",children:L.length})]}),(0,S.jsxs)("div",{className:"flex flex-col lbl",children:[(0,S.jsx)("span",{className:"font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Duration"}),(0,S.jsx)("span",{className:"font-medium text-lg text-teal-500",children:null===P||void 0===P?void 0:P.Duration})]}),(0,S.jsxs)("div",{className:"flex flex-col lbl",children:[(0,S.jsx)("span",{className:"font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Spot Amount"}),(0,S.jsx)("span",{className:"font-medium text-lg text-teal-500",children:null===P||void 0===P?void 0:P.spotAmountSum})]})]})]}),(0,S.jsxs)(r.Vq,{isOpen:V,onClose:()=>U(!1),onRequestClose:()=>U(!1),children:[(0,S.jsx)(r.Zb,{children:M.map(((e,t)=>(0,S.jsx)("div",{children:(0,S.jsx)("div",{children:(0,S.jsxs)("div",{className:p()("flex items-center justify-between rounded-lg p-2 cursor-pointer user-select","bg-gray-50 dark:bg-gray-700/60 hover:bg-gray-100 dark:hover:bg-gray-700/90","mb-3"),children:[(0,S.jsxs)("div",{className:"flex items-center rounded-full font-semibold text-xs",children:[(0,S.jsxs)("div",{className:"flex items-center px-2 py-1 border border-gray-300 rounded-full  mr-2",children:[(0,S.jsx)(h.$Af,{className:"text-base"}),(0,S.jsx)("span",{className:"ml-1 rtl:mr-1 whitespace-nowrap",children:e.TotalCount})]}),"  ",(0,S.jsx)("div",{className:"flex items-center",children:(0,S.jsxs)("div",{className:"text-gray-900 dark:text-gray-300 text-xs",children:[e.CommercialCaption," [",e.CommercialDuration,"]"]})})]}),(0,S.jsx)("div",{className:"text-gray-900 dark:text-gray-300 text-lg",children:(0,S.jsx)(r.Vp,{showCloseButton:!1,children:(0,S.jsxs)("div",{className:"flex items-center text-sm",children:[(0,S.jsx)("span",{className:"mr-1",children:(0,S.jsx)(h.QCV,{})})," ",e.TotalDuration," sec"]})})}),(0,S.jsx)("div",{className:"text-gray-900 dark:text-gray-300 text-lg",children:(0,S.jsx)(r.Vp,{showCloseButton:!1,children:(0,S.jsxs)("span",{className:"text-lg",children:[e.CurrencySymbol," ",e.SpotAmountSum]})})})]})})},t)))}),(0,S.jsxs)("div",{className:"text-right mt-6 ",children:[(0,S.jsx)(r.zx,{variant:"solid",className:"mr-2",onClick:()=>(async()=>{const e=T.filter((e=>"-"!==e.RescheduleDate)).map((e=>({Id:e.Id,RescheduleDate:(0,u.getDateFromDateTime)(e.RescheduleDate),CommercialCode:e.CommercialCode,BookingStatus:e.BookingStatus})));try{if(200===(await(0,y._K)("RESCHEDULE",e,g)).status)return U(!1),se(),void(0,u.openNotification)("success","Spot Rescheduled successfully")}catch(t){if(500===t.response.status)return void(0,u.openNotification)("danger","Server Error.")}})(),children:"Confirm"}),(0,S.jsx)(r.zx,{onClick:()=>U(!1),children:"Close"})]})]})]})}},72950:()=>{},22868:()=>{},14777:()=>{},99830:()=>{},70209:()=>{},87414:()=>{}}]);
//# sourceMappingURL=1360.0c5f9582.chunk.js.map