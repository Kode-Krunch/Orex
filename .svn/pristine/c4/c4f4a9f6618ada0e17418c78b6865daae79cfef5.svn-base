"use strict";(self.webpackChunkelstar=self.webpackChunkelstar||[]).push([[210],{38505:(e,l,t)=>{t.r(l),t.d(l,{default:()=>H});var a=t(72791),s=t(2803),n=t(87537),o=t(60488),i=t(60364),c=t(54748),r=t(9494),d=t(76053),m=t(72299),u=t(63821),b=t(34927),h=t(58617),x=t(84373),g=t(42264),f=t(92687),j=t(1413),p=t(81545),y=t(96907),v=t(16856),N=t(41578),w=t(68014),C=t(81320),S=t(80184);function T(e){let{label:l,value:t,icon:a,className:n,isMoney:o,currencySymbol:i}=e;return(0,S.jsxs)(s.Zb,{className:"border-none ".concat(n),bodyClass:"p-3 flex justify-between items-start gap-2",children:[(0,S.jsxs)("div",{className:"flex flex-col items-start justify-between gap-1 w-full",children:[l,(0,S.jsx)("h4",{children:o?(0,S.jsxs)(S.Fragment,{children:[i?"".concat(i," "):"",(0,C.numberToINRFormat)(t)]}):(0,S.jsx)(S.Fragment,{children:t})})]}),a]})}const A=function(e){let{bills:l,currencySymbol:t}=e;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(T,{label:"Bills",value:l.tmpbilldata.length,icon:(0,S.jsx)(p.Ypf,{size:30,className:"text-indigo-700"})}),(0,S.jsx)(T,{label:"Agency",value:(0,C.getUniqueObjects)(l.tmpbilldata,"AgencyName").length,icon:(0,S.jsx)(y.Ee5,{size:28,className:"text-amber-700"})}),(0,S.jsx)(T,{label:"Clients",value:(0,C.getUniqueObjects)(l.tmpbilldata,"ClientName").length,icon:(0,S.jsx)(v.VJS,{size:40,className:"text-emerald-700 -mt-2"})}),(0,S.jsx)(T,{label:"Brands",value:(0,C.getUniqueObjects)(l.tmpbilldata,"BrandName").length,icon:(0,S.jsx)(N.EL1,{size:30,className:"text-violet-700"})}),(0,S.jsx)(T,{label:"Spots",value:l.tmpbilldatasubreport.length,icon:(0,S.jsx)(N.$tM,{size:30,className:"text-rose-700"})}),(0,S.jsx)(T,{label:"Net Billed Amount",value:(0,C.getFieldTotal)(l.tmpbilldata,"PayableAmount"),isMoney:!0,className:"col-span-2",icon:(0,S.jsx)("span",{size:26,className:"text-sky-500 text-2xl font-normal",children:t}),currencySymbol:t}),(0,S.jsx)(T,{label:"Tax",value:(0,C.getFieldTotal)(l.tmpbilldata,"TotalTaxAmount"),isMoney:!0,className:"col-span-2",icon:(0,S.jsx)(w.CtB,{size:28,className:"text-red-700"}),currencySymbol:t})]})},F=e=>{let{label:l,value:t,isLast:a,currencySymbol:s}=e;return(0,S.jsxs)("li",{className:"flex items-center justify-between".concat(a?"":" mb-3"),children:[(0,S.jsx)("span",{children:l}),(0,S.jsxs)("span",{className:"font-semibold",children:[s,"\xa0",(0,C.numberToINRFormat)(t)]})]})};const B=function(e){let{selectedBills:l,currencySymbol:t}=e;const a=(0,C.getFieldTotal)(l,"GrossAmount"),n=(0,C.getFieldTotal)(l,"AgencyShare"),o=(0,C.getFieldTotal)(l,"TotalTaxAmount"),i=(0,C.getFieldTotal)(l,"PayableAmount");return(0,S.jsx)("div",{children:(0,S.jsxs)(s.Zb,{className:"border-none",bodyClass:"p-3",children:[(0,S.jsx)("h6",{className:"mb-4",children:"Selected Bills Summary"}),(0,S.jsxs)("ul",{children:[(0,S.jsx)(F,{label:"Bill Total",value:a,currencySymbol:t}),(0,S.jsx)(F,{label:"Discount",value:n,currencySymbol:t}),(0,S.jsx)(F,{label:"Tax",value:o,currencySymbol:t}),(0,S.jsx)("hr",{className:"mb-3"}),(0,S.jsx)(F,{label:"Payable",value:i,isLast:!0,currencySymbol:t})]})]})})};var k=t(19129),D=t(82600),Z=t(95587),z=t.n(Z),P=t(64802),I=t(44575),O=t(66435),R=t.n(O),E=t(45834),L=t(40071);const V=function(e){let{isOpen:l,setIsOpen:t,tableData:n,columns:o,setShowLoader:i,currencySymbol:c,bills:r}=e;const[d,m]=(0,a.useState)(""),u=()=>t(!1);return(0,S.jsxs)(s.Vq,{isOpen:l,onClose:u,onRequestClose:u,width:"85vw",height:"90vh",className:"-mt-8 max-w-[85vw]",contentClassName:"pt-3 h-full flex flex-col",children:[(0,S.jsx)("h5",{className:"mb-4",children:"E-Invoice"}),(0,S.jsx)("div",{className:"grow",children:(0,S.jsx)(f.Z,{tableColumns:o,data:n,globalFilter:d,setGlobalFilter:m,type:"eInvoice",setShowLoader:i,additionalData:{bills:r},currencySymbol:c})}),(0,S.jsx)("div",{className:"text-right mt-6",children:(0,S.jsx)(s.zx,{variant:"solid",icon:(0,S.jsx)(L.OrR,{}),children:"Generate"})})]})};var G=t(54048);R().vfs=E.I.vfs;const{apiPrefixMailSend:M}=G.Z,K=async(e,l,t,a,s)=>{if(l){if(!(e instanceof Blob))return void console.error("\u274c Error: Provided file is not a Blob.");const n=await Y(e);U(n,l,t,a,s)}else U(e,l,t,a,s)},U=(e,l,t,a,s)=>{fetch("".concat(M,"/send-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:a[0].Address2,subject:"".concat(s.label," - Ads Sales Invoices - ").concat((0,C.formatDateToDDMMMYYYY)(new Date)),pdfName:t,isList:l,pdf:e,channel:s})}).then((e=>e.text())).then((e=>(0,C.openNotification)("success",e))).catch((e=>(0,C.openNotification)("danger",e)))},Y=e=>new Promise(((l,t)=>{if(!(e instanceof Blob))return void t("Provided data is not a Blob.");const a=new FileReader;a.readAsDataURL(e),a.onloadend=()=>l(a.result.split(",")[1]),a.onerror=t}));R().vfs=E.I.vfs;const q=[{header:"Invoice No",accessorKey:"INVOICENO",cell:e=>{const l=e.row.original;return(0,S.jsx)("div",{className:"flex justify-center ",style:{padding:"5px",borderRadius:"100px",backgroundColor:"#5B92E633",color:"#fff",letterSpacing:"0.2px",fontWeight:900},children:l.INVOICENO})},options:{cell:{style:{paddingBlock:"0px"}}}},{header:"Invoice Date",accessorKey:"InvoiceDate"},{header:"Client",accessorKey:"ClientName"},{header:"Agency",accessorKey:"AgencyName"},{header:"Payable",accessorKey:"PayableAmount"}];const W=function(e){let{bills:l,setShowLoader:t}=e;const n=(0,i.useSelector)((e=>e.locale.selectedChannel)),[o,c]=(0,a.useState)(""),[r,m]=(0,a.useState)([]),[u]=(0,a.useState)(l.tmpbilldata.length>0?l.tmpbilldata[0].CurrencySymbol:""),[b,x]=(0,a.useState)(!1),g=async(e,l,t,a)=>{try{if(0===e.length)return void(0,C.openNotification)("warning","Please select an invoice to download.");const s=new(z());for(let o of e){const i=l.tmpbilldata.find((e=>e.INVOICENO===o.INVOICENO));let c;if("bill"===t)c=await(0,I.f9)(i,l.tmpbilltaxdata,t);else if("billWithTC"===t){const e=l.tmpbilldatasubreport.filter((e=>i.BillNumber===e.BillNumber)).reduce(((e,l)=>{const t=e.find((e=>e.BookingSpotRate===l.BookingSpotRate&&e.timebandname===l.timebandname&&e.SpotType===l.SpotType&&e.CommercialCaption===l.CommercialCaption));return t?t.count+=1:e.push((0,j.Z)((0,j.Z)({},l),{},{count:1})),e}),[]);c=await(0,I.um)(i,l.tmpbilltaxdata,l.tmpbilldatasubreport.filter((e=>i.BillNumber===e.BillNumber)),e,n)}else"telecastReport"===t&&(c=await(0,I.AY)(i,l.tmpbilldatasubreport.filter((e=>i.BillNumber===e.BillNumber)),n));const r="".concat(i.INVOICENO.replaceAll("/","-"),".pdf");if(1===e.length)return void(a?K(c,!1,r,e,n):c.download(r));const d=await new Promise((e=>c.getBlob(e)));if(s.file(r,d),e.length>1){const l=await s.generateAsync({type:"blob"});a?K(l,!0,"invoices.zip",e,n):(0,P.saveAs)(l,"invoices.zip")}}}catch(s){throw s}};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"grid grid-cols-9 gap-4",children:(0,S.jsx)(A,{bills:l,currencySymbol:u})}),(0,S.jsxs)("div",{className:"grid grid-cols-9 gap-4 h-full mt-4",bodyClass:"h-full",children:[(0,S.jsxs)(s.Zb,{className:"col-span-7 border-none",bodyClass:"p-3 h-[65vh] flex flex-col",children:[(0,S.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,S.jsx)("h4",{children:"Bills"}),(0,S.jsxs)("div",{className:"flex gap-2",children:[(0,S.jsx)(s.zx,{icon:(0,S.jsx)(p.Ypf,{}),size:"sm",variant:"solid",onClick:()=>x(!0),disabled:0===r.length,children:"E-Invoice"}),(0,S.jsx)(s.zx,{icon:(0,S.jsx)(v.sRP,{}),size:"sm",variant:"solid",onClick:()=>{(async e=>{try{t(!0),await g(e,l,"billWithTC",!0),t(!1)}catch(a){(0,C.openNotification)("danger","Something went wrong. Unable to generate PDFs."),t(!1),console.error(a)}})(r)},disabled:0===r.length,children:"Send Email"}),(0,S.jsx)(s.zx,{icon:(0,S.jsx)(d.cdp,{}),size:"sm",variant:"solid",onClick:()=>{(async e=>{try{t(!0),await g(e,l,"bill",!1),t(!1)}catch(a){(0,C.openNotification)("danger","Something went wrong. Unable to generate PDFs."),t(!1),console.error(a)}})(r)},disabled:0===r.length,children:"PDF Bills"}),(0,S.jsx)(s.zx,{icon:(0,S.jsx)(p.w2G,{}),size:"sm",variant:"solid",onClick:()=>{(async e=>{try{t(!0),await g(e,l,"billWithTC",!1),t(!1)}catch(a){(0,C.openNotification)("danger","Something went wrong. Unable to generate PDFs."),t(!1),console.error(a)}})(r)},disabled:0===r.length,children:"Bills with TC"}),(0,S.jsx)(s.zx,{icon:(0,S.jsx)(d.be3,{}),size:"sm",variant:"solid",onClick:()=>{(async e=>{try{t(!0),await g(e,l,"telecastReport",!1),t(!1)}catch(a){(0,C.openNotification)("danger","Something went wrong. Unable to generate PDFs."),t(!1),console.error(a)}})(r)},disabled:0===r.length,children:"Telecast Report"}),(0,S.jsx)(s.zx,{icon:(0,S.jsx)(k.lJM,{}),size:"sm",variant:"solid",children:"Digital Sign Bills"}),(0,S.jsx)(D.Z,{value:null!==o&&void 0!==o?o:"",className:"lg:w-52",size:"sm",prefix:(0,S.jsx)(h.O6C,{className:"text-lg"}),placeholder:"Search",onChange:e=>c(String(e)),showSearchLabel:!1})]})]}),(0,S.jsx)("div",{className:"grow",children:l.tmpbilldata.length>0?(0,S.jsx)(f.Z,{tableColumns:q,data:(0,C.columnsToINRFormat)(l.tmpbilldata.map((e=>(0,j.Z)((0,j.Z)({},e),{},{InvoiceDate:(0,C.getDateFromDateTime)(e.InvoiceDate)}))),["PayableAmount"]).map((e=>(0,j.Z)((0,j.Z)({},e),{},{PayableAmount:"".concat(u," ").concat(e.PayableAmount)}))),globalFilter:o,setGlobalFilter:c,setSelectedRows:m,type:"dashboard",setShowLoader:t,additionalData:{bills:l},currencySymbol:u}):(0,S.jsx)("div",{className:"flex justify-center items-center h-full",children:"No bills to show"})})]}),(0,S.jsx)("div",{className:"col-span-2 flex flex-col gap-3",children:(0,S.jsx)(B,{selectedBills:null===r||void 0===r?void 0:r.map((e=>(0,j.Z)((0,j.Z)({},e),{},{PayableAmount:Number("string"===typeof(null===e||void 0===e?void 0:e.PayableAmount)?e.PayableAmount.replaceAll(",","").replaceAll(u,"").replaceAll(" ",""):null===e||void 0===e?void 0:e.PayableAmount),TotalTaxAmount:Number("string"===typeof(null===e||void 0===e?void 0:e.TotalTaxAmount)?e.TotalTaxAmount.replaceAll(",",""):null===e||void 0===e?void 0:e.TotalTaxAmount)}))),currencySymbol:u})})]}),b&&(0,S.jsx)(V,{isOpen:b,setIsOpen:x,tableData:r,columns:[...q],setShowLoader:t,currencySymbol:u,bills:l})]})};var J=t(74569),_=t(45682),Q=t(24933),$=t(27353);const H=function(){const e=(0,i.useSelector)((e=>e.locale.selectedChannel)),l=(0,i.useSelector)((e=>e.auth.session.LoginId)),t=(0,i.useSelector)((e=>e.auth.session.token)),j=(0,i.useSelector)((e=>e.base.common.currentRouteTitle)),[p,y]=(0,a.useState)(!0),[v,N]=(0,a.useState)([null,null]),[w,T]=(0,a.useState)(null),[A,F]=(0,a.useState)(""),[B,k]=(0,a.useState)([]),[Z,z]=(0,a.useState)(null),[P,I]=(0,a.useState)(!1),[O,R]=(0,a.useState)("tab1");(0,a.useEffect)((()=>{try{(async()=>{v&&v[0]&&v[1]&&((0,o.Dh)(),y(!1),I(!0),T({agencyTable:await L("agency"),clientTable:await L("client"),bookingTable:await L("booking")}),I(!1))})()}catch(e){console.error(e),G()}}),[v]),(0,a.useEffect)((()=>{try{G()}catch(e){console.error(e)}}),[e]);const E=()=>{try{y(!1)}catch(e){console.error(e)}},L=async l=>{try{let t={location:e.LocationCode,channel:e.ChannelCode,fromDate:(0,c.Tk)(v[0]),todate:(0,c.Tk)(v[1]),Flag:null,IsNTC:0};"agency"===l?t.Flag=1:"client"===l?t.Flag=2:"booking"===l&&(t.Flag=3);let a=await(0,r.apiCallstoreprocedure)("usp_BillingPrinting_List",t);if(200===a.status)return a.data;if(204===a.status)return[];throw(0,C.openNotification)("danger","Something went wrong. Server responded with status code ".concat(a.status,".")),new Error("Response status code: ".concat(a.status,". Response: ").concat(a))}catch(t){throw t instanceof J.AxiosError&&(0,C.openNotification)("danger","Something went wrong. Server responded with status code ".concat(t.response.status)),t}},V=async()=>{try{I(!0);let a={loginCode:l,locationCode:e.LocationCode,fromDate:(0,c.Tk)(v[0]),uptoDate:(0,c.Tk)(v[1]),channelCode:e.ChannelCode};"BookingCode"in B[0]?(a.filter=B.map((e=>e.BookingNumber)).join(","),a.id=2):"AgencyCode"in B[0]?(a.filter=B.map((e=>e.AgencyCode)).join(","),a.id=3):"ClientCode"in B[0]&&(a.filter=B.map((e=>e.ClientCode)).join(","),a.id=4);let s=null;j===$.oi?s=await(0,g.Vg)(a,t):j===$.Ab&&(s=await(0,g.Vm)(a,t)),s?200===s.status?z(s.data):204===s.status?z([]):(0,C.openNotification)("danger","Something went wrong. Server responded with status code ".concat(s.status,"."),"Error"):(0,C.openNotification)("danger","Something went wrong"),I(!1)}catch(a){"message"in a?(0,C.openNotification)("danger","".concat(a.message),"Error"):(0,C.openNotification)("danger","Something went wrong.","Error")}},G=()=>{try{y(!0),N([null,null]),T(null),F(""),k([]),z(null),I(!1),R("tab1")}catch(e){console.error(e)}};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,S.jsx)("h3",{children:"Bill Printing"}),(0,S.jsx)("div",{id:"bill-printing-dpr-container",children:(0,S.jsx)(n.Z,{placeholder:"Select dates range",size:"sm",onChange:e=>{null===e[0]&&null===e[1]?G():N(e)},value:v,clearable:!0,disabled:!(0,C.isChannelSelected)(e)||v[0]&&v[1],onDropdownOpen:()=>G()})})]}),(0,C.isChannelSelected)(e)?(0,S.jsx)(S.Fragment,{children:v&&v[0]&&v[1]?(0,S.jsxs)(S.Fragment,{children:[w&&!Z&&(0,S.jsx)(s.Zb,{className:"h-full",bodyClass:"h-full",bordered:!1,children:(0,S.jsxs)(s.mQ,{variant:"pill",defaultValue:"tab1",onChange:e=>{R(e),F(""),k([])},className:"h-full flex flex-col",children:[(0,S.jsxs)("div",{className:"flex justify-between",children:[(0,S.jsxs)(u.Z,{children:[(0,S.jsx)(b.Z,{value:"tab1",children:"Agency"}),(0,S.jsx)(b.Z,{value:"tab2",children:"Client"}),(0,S.jsx)(b.Z,{value:"tab3",children:"Booking"})]}),(0,S.jsx)(D.Z,{value:null!==A&&void 0!==A?A:"",className:"lg:w-52",size:"sm",prefix:(0,S.jsx)(h.O6C,{className:"text-lg"}),placeholder:"Search",onChange:e=>F(String(e)),showSearchLabel:!1})]}),(0,S.jsx)("hr",{className:"mt-2"}),(0,S.jsxs)("div",{className:"mt-3 grow",children:["tab1"===O&&(0,S.jsx)(m.Z,{value:"tab1",className:"h-full",children:w.agencyTable.length>0?(0,S.jsx)(f.Z,{tableColumns:[{header:"Agency Name",accessorKey:"AgencyName"}],data:w.agencyTable,globalFilter:A,setGlobalFilter:F,setSelectedRows:k,footerAction:(0,S.jsx)(s.zx,{variant:"solid",icon:(0,S.jsx)(x.VFe,{}),size:"sm",disabled:0===B.length,onClick:V,children:"Get Bills"}),type:"home"}):(0,S.jsx)("div",{className:"h-full flex justify-center items-center",children:"No agencies found"})}),"tab2"===O&&(0,S.jsx)(m.Z,{value:"tab2",className:"h-full",children:w.clientTable.length>0?(0,S.jsx)(f.Z,{tableColumns:[{header:"Client Name",accessorKey:"ClientName"}],data:w.clientTable,globalFilter:A,setGlobalFilter:F,selectedRows:B,setSelectedRows:k,footerAction:(0,S.jsx)(s.zx,{variant:"solid",icon:(0,S.jsx)(x.VFe,{}),size:"sm",disabled:0===B.length,onClick:V,children:"Get Bills"}),type:"home"}):(0,S.jsx)("div",{className:"h-full flex justify-center items-center",children:"No clients found"})}),"tab3"===O&&(0,S.jsx)(m.Z,{value:"tab3",className:"h-full",children:w.bookingTable.length>0?(0,S.jsx)(f.Z,{tableColumns:[{header:"Booking Number",accessorKey:"BookingCode"}],data:w.bookingTable,globalFilter:A,setGlobalFilter:F,selectedRows:B,setSelectedRows:k,footerAction:(0,S.jsx)(s.zx,{variant:"solid",icon:(0,S.jsx)(x.VFe,{}),size:"sm",disabled:0===B.length,onClick:V,children:"Get Bills"}),type:"home"}):(0,S.jsx)("div",{className:"h-full flex justify-center items-center",children:"No bookings found"})})]})]})}),w&&Z?(0,S.jsx)(W,{bills:Z,setShowLoader:I}):w&&Z&&0===Z.length?(0,S.jsx)(s.Zb,{className:"h-[80vh]",bodyClass:"h-full flex justify-center items-center",bordered:!1,children:"No bills to show"}):(0,S.jsx)(S.Fragment,{})]}):(0,S.jsx)(s.Zb,{className:"h-[80vh]",bodyClass:"h-full flex justify-center items-center",bordered:!1,children:"Please select date range to view bills."})}):(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(s.Zb,{className:"h-[80vh]",bodyClass:"h-full flex justify-center items-center",bordered:!1,children:"Please select a channel to view bills"})}),(0,S.jsxs)(s.Vq,{isOpen:(0,C.isChannelSelected)(e)&&p,bodyOpenClassName:"overflow-hidden",closable:!1,onClose:E,children:[(0,S.jsxs)("div",{className:"flex justify-between relative items-center border-b border-gray-200 dark:border-gray-600 pb-4 mb-4",children:[(0,S.jsx)("h5",{children:"Select Date Range"}),(0,S.jsx)(s.zx,{shape:"circle",variant:"plain",icon:(0,S.jsx)(d.nfZ,{className:"text-gray-600"}),onClick:E,className:"absolute -top-4 -right-4"})]}),(0,S.jsx)("div",{className:"mx-auto",children:(0,S.jsx)(s.Vv,{value:v,maxDate:new Date((new Date).setDate((new Date).getDate()+30)),onChange:e=>N(e)})})]}),(0,S.jsx)(Q.Z,{}),(0,S.jsx)(_.default,{showLoader:P})]})}}}]);
//# sourceMappingURL=210.9e9afa46.chunk.js.map