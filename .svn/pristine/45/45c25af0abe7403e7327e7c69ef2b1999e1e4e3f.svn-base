import React, { useContext, useState } from 'react';
import {
  ROTATION_INFO_COLUMNS,
  TABLE_ROW_HEIGHT,
} from 'views/Scheduling/SchedulerOld/constants';
import { getBgColor, getBorderColor, getFontColor } from './utils';
import SchedulerContext from 'views/Scheduling/SchedulerOld/context/SchedulerContext';
// import SchedulerContext from 'views/Scheduling/Scheduler/context/SchedulerContext';

function RotationInfoTable({ tableData }) {
  /* CONTEXT */
  const {
    schedulingTableRef,
    schedulingTableSelectedRows,
    setSchedulingTableSelectedRows,
    setLeftClickedSchTableRow,
    maintainScrolledOffsetOfTables,
  } = useContext(SchedulerContext);

  /* STATES */
  const [hoveredRow, setHoveredRow] = useState(false);

  /* EVENT HANDLERS */
  const handleCtrlClick = (clickedRow) => {
    try {
      if (
        schedulingTableSelectedRows.filter(
          (row) => row.rowIndex === clickedRow.rowIndex,
        ).length > 0
      ) {
        setSchedulingTableSelectedRows(
          schedulingTableSelectedRows.filter(
            (row) => row.rowIndex !== clickedRow.rowIndex,
          ),
        );
      } else {
        setSchedulingTableSelectedRows([
          ...schedulingTableSelectedRows,
          ...tableData.filter((row) => row.rowIndex === clickedRow.rowIndex),
        ]);
      }
      setLeftClickedSchTableRow(clickedRow);
      maintainScrolledOffsetOfTables();
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <>
      {/* Table Header */}
      <div className="flex bg-gray-700 font-semibold text-white text-[12px] sticky top-0">
        {ROTATION_INFO_COLUMNS.map((column, index) => (
          <div
            style={{
              width: column.style.width,
              height: `${TABLE_ROW_HEIGHT}px`,
            }}
            key={column.accessorKey}
            className={`flex items-center justify-${
              column.style.align
            } border-gray-400 border-y border-r ${index === 0 && 'border-l'}`}
          >
            {column.header}
          </div>
        ))}
      </div>
      {/* Table Body */}
      <div>
        {tableData.map((row) => (
          <div
            key={row.rowId}
            className="hover:cursor-pointer flex"
            onMouseEnter={() => setHoveredRow(row)}
            onMouseLeave={() => setHoveredRow(null)}
            onClick={(event) => {
              if (event.button === 0 && event.ctrlKey) handleCtrlClick(row);
              else
                schedulingTableRef.current?.scrollToItem(
                  row.rowIndex,
                  'center',
                );
            }}
          >
            {ROTATION_INFO_COLUMNS.map((column, index) => (
              <div
                key={index}
                style={{
                  height: `${TABLE_ROW_HEIGHT}px`,
                  width: column.style.width,
                  backgroundColor: getBgColor(
                    schedulingTableSelectedRows,
                    row,
                    hoveredRow,
                  ),
                  color: getFontColor(schedulingTableSelectedRows, row),
                  borderColor: getBorderColor(schedulingTableSelectedRows, row),
                }}
                className={`flex items-center justify-${
                  column.style.align
                } text-[12px] py-1 px-2.5 border-b border-r ${
                  index === 0 && 'border-l'
                }`}
              >
                <div className="text-ellipsis overflow-hidden whitespace-nowrap">
                  {row[column.accessorKey]}
                </div>
              </div>
            ))}
          </div>
        ))}
      </div>
    </>
  );
}

export default RotationInfoTable;
