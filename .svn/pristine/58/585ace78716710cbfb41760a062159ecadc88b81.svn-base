import {
  Alert,
  Button,
  Card,
  Checkbox,
  DatePicker,
  FormContainer,
  FormItem,
  Input,
  Radio,
  Table,
  Select,
  Tabs,
} from 'components/ui';
import React, { forwardRef, useEffect, useState, useRef } from 'react';
import ChannelSelecttion from 'views/Controls/ChannelSelecttion';
import PromoTypeDropNew from 'views/Controls/PromoTypeDropNew';
import { StickyFooter } from 'components/shared';
import './Rating.css';
import {
  apiGetChannelmasterdrop,
  apiGetLanguagemaster,
  apiGetSongcategoryDrop,
  apiGetSongtypeDrop,
  apiGetcepsmapping,
  apiUSP_GenerateVideoID,
} from 'services/MasterService';
import {
  formatOnHHMMSSFFBlur,
  handleChangeWithFrameNew,
  handleChangeWithOutFrameNew,
  millisecondsToTime,
  openNotification,
  parseDuration,
  timeToMilliseconds,
} from 'views/Controls/GLOBALFUNACTION';
import { useDispatch, useSelector } from 'react-redux';
import { Toast } from 'primereact/toast';
import {
  apiGetCensorshipDrop,
  apiGetStarCastTypemaster,
  apiGetStarCastmaster,
  apisendnotification,
} from 'services/ProgrammingService';
import {
  Postsong,
  Putsong,
  apiGetMoviealbumdropdown,
  apiGetMusicagencydropdown,
  apiGetSongGenredropdown,
  apiGetSongtempodropdown,
  apiGetTapetypedropdown,
} from 'services/SchedulingService';
import { TabView, TabPanel } from 'primereact/tabview';
import useTimeOutMessage from 'utils/hooks/useTimeOutMessage';
import { useNavigate } from 'react-router-dom';
import { FaRegStar } from 'react-icons/fa';
import MapStarcast from 'views/Controls/MapStarcast';
import { isChar, isCharAndComa, isCharSong } from 'components/validators';
import { HiOutlineHome, HiOutlineMusicNote } from 'react-icons/hi';
import HeaderExtra from 'views/Controls/HeaderExtra';
import { LuListMusic } from 'react-icons/lu';
import { MdFaceRetouchingNatural, MdHub } from 'react-icons/md';
import DatePickerRange from 'components/ui/DatePicker/DatePickerRange';
import AddStarCastTypeDialog from './AddStarCastTypeDialog';

const { TabNav, TabList, TabContent } = Tabs;
const SongMasterEdit = forwardRef((props, ref) => {
  const { Content } = useSelector((state) => state.base.common);
  const LoginId = useSelector((state) => state.auth.session.LoginId);
  const token = useSelector((state) => state.auth.session.token);
  const Username = useSelector((state) => state.auth.session.Username);
  const Channel = useSelector((state) => state.locale.selectedChannel);
  const ChannelSetting = useSelector(
    (state) => state.auth.session.ChannelSetting,
  );
  const [requiredFields, setRequiredFields] = useState({
    SongCaption: false,
    YrRelease: false,
    Epgcaption: false,
    HouseId: false,
    SOM: false,
    TCOUT: false,
    Duration: false,
    MusicAgencyCode: false,
    SongCategoryCode: false,
    MovieAlbumCode: false,
    SongGenreCode: false,
    Language: false,
    TapeType: false,
    Censorship: false,
    SongTypeCode: false,
    SongTempoCode: false,
    Grade: false,
  });

  const [sMapStarcast, setMapStarcast] = useState(
    Content.SongRelation ? Content.SongRelation : [],
  );
  console.log(sMapStarcast);
  const generateYears = () => {
    const currentYear = new Date().getFullYear();
    const years = [];
    for (let year = currentYear - 50; year <= currentYear + 0; year++) {
      years.push({ value: year, label: year.toString() });
    }
    return years;
  };

  const [years] = useState(generateYears());
  console.log(Content.FromDate);
  const [formState, setFormState] = useState({
    FromKillDate: Content.FromDate
      ? [new Date(Content.FromDate), new Date(Content.KillDate)]
      : [null, null],
    SongCaption: Content.SongCaption ? Content.SongCaption : '',
    Duration: Content.SongDuration ? Content.SongDuration : '',
    SongTypeCode: Content.SongTypeCode ? Content.SongTypeCode : '',
    Banner: Content.BannerCode ? Content.BannerCode : '',
    Language: Content.LanguageCode ? Content.LanguageCode : '',
    Censorship: Content.CensorshipCode ? Content.CensorshipCode : 1,
    TapeType: Content.TapeTypeCode ? Content.TapeTypeCode : 4,
    ExportTapeCode: Content.ExportTapeCode ? Content.ExportTapeCode : null,
    ExportTapeCaption: Content.ExportTapeCaption
      ? Content.ExportTapeCaption
      : null,
    RemixO: Content.RemixO ? Content.RemixO : 0,
    BlackWhite: Content.BlackWhite ? Content.BlackWhite : 0,
    InHouseOutHouse: Content.InHouseOutHouse ? Content.InHouseOutHouse : null,
    SegmentNumber: Content.SegmentNumber ? Content.SegmentNumber : null,
    //SOM: Content.SOM ? Content.SOM : '00:00:00:00',
    SOM: Content.SOM ? Content.SOM : '00:00:00:00',
    // FromDate: Content.FromDate ? Content.FromDate : null,
    // KillDate: Content.KillDate ? Content.KillDate : null,
    ActiveNonActive: Content.ActiveNonActive ? Content.ActiveNonActive : '',
    FillerSynopsis: Content.FillerSynopsis ? Content.FillerSynopsis : '',
    Dated: Content.Dated ? Content.Dated : 0,
    HouseId: Content.HouseId ? Content.HouseId : '',
    blanktapeid: Content.blanktapeid ? Content.blanktapeid : null,
    locationcode: Content.locationcode ? Content.locationcode : null,
    ChannelCode: Content.ChannelCode ? Content.ChannelCode : '',
    StartDate: Content.StartDate ? Content.StartDate : '',
    RecID: Content.RecID ? Content.RecID : '',
    TCOUT: Content.TCOUT ? Content.TCOUT : '',
    StartTime: Content.StartTime ? Content.StartTime : '',
    EndTime: Content.EndTime ? Content.EndTime : null,
    IndemLetter: Content.IndemLetter ? Content.IndemLetter : null,
    TapeStatus: Content.TapeStatus ? Content.TapeStatus : '',
    Replacement: Content.Replacement ? Content.Replacement : '',
    Producer: Content.Producer ? Content.Producer : '',
    Director: Content.Director ? Content.Director : '',
    MusicDirector: Content.MusicDirector ? Content.MusicDirector : '',
    Album: Content.Album ? Content.Album : null,
    Aston: Content.Aston ? Content.Aston : '',
    astondisplay: Content.astondisplay ? Content.astondisplay : '',
    astonstart: Content.astonstart ? Content.astonstart : '',
    astonend: Content.astonend ? Content.astonend : '',
    astonactive: Content.astonactive ? Content.astonactive : '',
    MusicAgencyCode: Content.MusicAgencyCode ? Content.MusicAgencyCode : null,
    AstonID: Content.AstonID ? Content.AstonID : null,
    YrRelease: Content.YrRelease ? Content.YrRelease : null,
    SongCategoryCode: Content.SongCategoryCode ? Content.SongCategoryCode : '',
    SongGenreCode: Content.SongGenreCode ? Content.SongGenreCode : '',
    MovieAlbumCode: Content.MovieAlbumCode ? Content.MovieAlbumCode : '',
    DurInSec: Content.DurInSec ? Content.DurInSec : '',
    Grade: Content.Grade ? Content.Grade : 1,
    Epgcaption: Content.Epgcaption ? Content.Epgcaption : null,
    Scode: Content.Scode ? Content.Scode : null,
    Era: Content.Era ? Content.Era : '',
    SongTempoCode: Content.SongTempoCode ? Content.SongTempoCode : 3,
    Mood: Content.Mood ? Content.Mood : '',
    RCS: Content.RCS ? Content.RCS : '',
    RCSDataType: Content.RCSDataType ? Content.RCSDataType : '',
    RCSCategory: Content.RCSCategory ? Content.RCSCategory : null,
    RCSYear: Content.RCSYear ? Content.RCSYear : null,
    PrimarySongFlag: Content.PrimarySongFlag ? Content.PrimarySongFlag : '',
    Actor: Content.Actor ? Content.Actor : '',
    Actress: Content.Actress ? Content.Actress : '',
    Lyrics: Content.Lyrics ? Content.Lyrics : '',
    Music: Content.Music ? Content.Music : '',
    Singer: Content.Singer ? Content.Singer : '',
    Artist: Content.Artist ? Content.Artist : null,
    RCSYear: Content.RCSYear ? Content.RCSYear : null,
    IsActive: Content.IsActive ? Content.IsActive : '',
  });
  const [rating, setRating] = useState(Content.Rating ? Content.Rating : 0);
  const [dateVdaid, setdateVdaid] = useState(true);
  // console.log(Content.FromDate);
  const [Checkboxcon, setCheckboxcon] = useState(
    Content.FromDate != undefined ? true : false,
  );
  const [renderCount, setRenderCount] = useState(0);
  const [Language, setLanguage] = useState([]);
  const [SongCategory, setSongCategory] = useState([]);
  const [SongGenre, setSongGenre] = useState([]);
  const [SongType, setSongType] = useState([]);
  const [TapeType, setTapeType] = useState([]);
  const [Censorship, setCensorship] = useState([]);
  const [SongTempo, setSongTempo] = useState([]);
  const [MusicAgency, setMusicagency] = useState([]);
  const [MovieAlbum, setMovieAlbum] = useState([]);
  const [StarCastType, setStarCastType] = useState([]);
  const [StarCast, setStarCast] = useState([]);
  const [message, setMessage] = useTimeOutMessage();
  const [log, setlog] = useState('');
  const [channelList, setChannelList] = useState([]);
  const [selectedchannel, setSelectedchannel] = useState(
    Content.SongLocChnlMap
      ? Content.SongLocChnlMap.map((item, index) => ({
        id: index,
        LocationCode: item.LocationCode,
        ChannelCode: item.ChannelCode,
        LocationName: item.LocationName,
      }))
      : [Channel].map((item, i) => ({
        id: i,
        LocationCode: item.LocationCode,
        ChannelName: item.label,
        ChannelCode: item.ChannelCode,
        LocationName: item.LocationName,
      })),
  );
  const [isAddStarCastTypeDialogOpen, setIsAddStarCastTypeDialogOpen] =
    useState(false);
  const [StarCastTypeList, setStarCastTypeList] = useState([]);

  const handleStarClick = (clickedRating) => {
    if (rating === clickedRating - 0.5) {
      setRating(0);
    } else if (rating === clickedRating) {
      setRating(clickedRating - 0.5);
    } else {
      setRating(clickedRating);
    }
  };
  useEffect(() => {
    setFormState((prevFormState) => {
      const resultMilliseconds =
        timeToMilliseconds(prevFormState.TCOUT) -
        timeToMilliseconds(prevFormState.SOM);
      const duration = millisecondsToTime(resultMilliseconds);

      const parsedTCOUT = parseDuration(prevFormState.TCOUT);
      const parsedSOM = parseDuration(prevFormState.SOM);

      // Determine newTCOUT
      let newTCOUT = prevFormState.TCOUT;
      if (parsedTCOUT != null && parsedTCOUT < parsedSOM) {
        openNotification('danger', 'TC IN is Less than TC OUT');
        return prevFormState;
      }

      // Determine newSOM
      let newSOM = prevFormState.SOM;
      if (parsedTCOUT != null && parsedTCOUT < parsedSOM) {
        openNotification('danger', 'TC IN is Less than TC OUT');
        return prevFormState;
      }

      return {
        ...prevFormState,
        Duration: duration,
        TCOUT: newTCOUT,
        SOM: newSOM,
      };
    });
  }, [formState.TCOUT]);

  const toast = useRef(null);
  const navigate = useNavigate();

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    if (isCharAndComa(value)) {
      setFormState((prevFormState) => ({
        ...prevFormState,
        [name]: value,
      }));
    }
  };
  const handleInputChange2 = (value, name) => {
    setFormState((prevFormState) => ({
      ...prevFormState,
      [name]: value,
    }));
  };

  useEffect(() => {
    if (renderCount < 2 && Content.SongRelation) {
      const extractedData = Content.SongRelation.map((item) => {
        const starcasttyname =
          StarCastType.find((label) => label.value === item.StarCastTypeCode)
            ?.label || 'Unknown StarCastType';
        const castname =
          StarCast.find((label) => label.value === item.StarCastCode)?.label ||
          'Unknown StarCastType';
        return {
          starcasttyname,
          castname,
          starcasttypecode: item.StarCastTypeCode || 0,
          castcode: item.StarCastCode || 0,
        };
      });

      setRenderCount(renderCount + 1);
    }
  }, [renderCount]);
  useEffect(() => {
    (async (values) => {
      const Language = await apiGetLanguagemaster(values);
      const formattedOptions = Language.data.map((option) => ({
        value: option.LanguageCode,
        label: option.LanguageName,
      }));
      setLanguage(formattedOptions);
    })();

    (async (values) => {
      const SongGenre = await apiGetSongGenredropdown(values);
      const formattedOptions = SongGenre.data.map((option) => ({
        value: option.SongGenreCode,
        label: option.SongGenreName,
      }));
      setSongGenre(formattedOptions);
    })();
    (async (values) => {
      const Songcategory = await apiGetSongcategoryDrop(values);
      const formattedOptions = Songcategory.data.map((option) => ({
        value: option.SongCategoryCode,
        label: option.SongCategoryName,
      }));
      setSongCategory(formattedOptions);
    })();
    (async (values) => {
      const Songtype = await apiGetSongtypeDrop(values);
      const formattedOptions = Songtype.data.map((option) => ({
        value: option.SongTypeCode,
        label: option.SongTypeName,
      }));
      setSongType(formattedOptions);
    })();
    (async (values) => {
      const Tapetype = await apiGetTapetypedropdown(values);
      const formattedOptions = Tapetype.data.map((option) => ({
        value: option.TapeTypeCode,
        label: option.TapeTypeName,
      }));
      setTapeType(formattedOptions);
    })();
    (async (values) => {
      const Censorship = await apiGetCensorshipDrop(values);
      const formattedOptions = Censorship.data.map((option) => ({
        value: option.CensorshipCode,
        label: option.CensorshipName,
      }));
      setCensorship(formattedOptions);
    })();
    (async (values) => {
      const SongTempo = await apiGetSongtempodropdown(values);
      const formattedOptions = SongTempo.data.map((option) => ({
        value: option.SongTempoCode,
        label: option.SongTempoName,
      }));
      setSongTempo(formattedOptions);
    })();
    (async (values) => {
      const MusicAgency = await apiGetMusicagencydropdown(values);
      const formattedOptions = MusicAgency.data.map((option) => ({
        value: option.MusicAgencyCode,
        label: option.MusicAgencyName,
      }));
      setMusicagency(formattedOptions);
    })();
    (async (values) => {
      const moviealbum = await apiGetMoviealbumdropdown(values);
      const formattedOptions = moviealbum.data.map((option) => ({
        value: option.MovieAlbumCode,
        label: option.MovieAlbumName,
      }));

      setMovieAlbum(formattedOptions);
    })();
    (async (values) => {
      const starcasttype = await apiGetStarCastTypemaster(values);
      const formattedOptions = starcasttype.data.map((option) => ({
        value: option.StarCastTypeCode,
        label: option.StarCastTypeName,
      }));
      setStarCastType(formattedOptions);
    })();
    (async (values) => {
      const starcast = await apiGetStarCastmaster(values);
      const formattedOptions = starcast.data.map((option) => ({
        value: option.StarCastCode,
        label: option.StarCastName,
      }));
      setStarCast(formattedOptions);
    })();
    (async (values) => {
      const resp = await apiGetChannelmasterdrop(LoginId);
      const channelsBYID = resp.data.map((channel, index) => ({
        id: index,
        ChannelName: channel.ChannelName,
        ChannelCode: channel.ChannelCode,
        LocationCode: channel.LocationCode,
        LocationName: channel.LocationName,
      }));
      setChannelList(channelsBYID);
    })();
  }, []);
  const Grade = [
    { label: 'A', value: 1 },
    { label: 'A+', value: 2 },
    { label: 'B', value: 3 },
    { label: 'B+', value: 4 },
    { label: 'C', value: 5 },
    ,
  ];

  const checkFieldsNotEmpty = (formState, requiredFields) => {
    const emptyFields = [];
    for (const field of requiredFields) {
      if (!formState[field]) {
        emptyFields.push(field);
      }
    }
    return emptyFields;
  };

  const apiUpdate = async () => {
    seti(2);
    if (formState.Duration == '00:00:00:00') {
      setMessage('Duration cannot be zero.');
      return;
    }
    const [hours, minutes, seconds, frames] =
      formState.Duration.split(':').map(Number);
    const totalSeconds = hours * 3600 + minutes * 60 + seconds + frames / 24; // Assuming 30 frames per second
    const mergedData = {
      SongMaster: {
        SongCaption: formState.SongCaption,
        SongDuration: formState.Duration,
        SongTypeCode: Number(formState.SongTypeCode),
        BannerCode: formState.Banner,
        LanguageCode: Number(formState.Language),
        CensorshipCode: Number(formState.Censorship),
        TapeTypeCode: Number(formState.TapeType),
        ExportTapeCode: '1',
        ExportTapeCaption: formState.SongCaption,
        RemixO: formState.RemixO,
        BlackWhite: formState.BlackWhite,
        InHouseOutHouse: 1,
        SegmentNumber: 1,
        SOM: '00:00:00:00',
        FromDate: formState.FromKillDate[0],
        KillDate: formState.FromKillDate[1],
        ActiveNonActive: Number(formState.ActiveNonActive),
        FillerSynopsis: 0,
        Dated: formState.Dated,
        HouseId: formState.HouseId,
        blanktapeid: formState.blanktapeid,
        StartDate: formState.FromKillDate[0],
        RecID: '1',
        TCOUT: formState.TCOUT,
        StartTime: '',
        EndTime: '',
        IndemLetter: formState.IndemLetter ? 1 : 0,
        TapeStatus: null,
        Replacement: formState.Replacement ? 1 : 0,
        Producer: '',
        Director: '',
        MusicDirector: '',
        Album: '',
        Rating: rating,
        Aston: formState.SongCaption,
        astondisplay: 0,
        astonstart: 0,
        astonend: 0,
        astonactive: 0,
        MusicAgencyCode: formState.MusicAgencyCode,
        AstonID: 1,
        YrRelease: formState.YrRelease,
        SongCategoryCode: Number(formState.SongCategoryCode),
        SongGenreCode: Number(formState.SongGenreCode),
        MovieAlbumCode: formState.MovieAlbumCode,
        DurInSec: totalSeconds,
        Grade: Number(formState.Grade),
        Epgcaption: formState.Epgcaption,
        Scode: '',
        Era: '',
        SongTempoCode: Number(formState.SongTempoCode),
        Mood: 0,
        RCS: '',
        RCSDataType: '',
        RCSCategory: '',
        RCSYear: '',
        PrimarySongFlag: 0,
        Actor: formState.Actor,
        Actress: formState.Actress,
        Lyrics: formState.Lyrics,
        Music: formState.Music,
        Singer: formState.Singer,
        Artist: formState.Artist,
        RCSYear: formState.RCSYear,
        IsActive: 1,
      },
      songlocchnlmap: selectedchannel.map((item) => ({
        LocationCode: item.LocationCode,
        ChannelCode: item.ChannelCode,
      })),
      songrelation: sMapStarcast.map((item) => ({
        StarCastTypeCode: item.StarCastTypeCode,
        StarCastCode: item.StarCastCode,
      })),
    };
    if (formState.FromKillDate[0] == null) {
      // If Rating is blank, remove it from the SongMaster object
      delete mergedData.SongMaster.FromDate;
      delete mergedData.SongMaster.StartDate;
      delete mergedData.SongMaster.KillDate;
    }
    try {
      const resp = await Putsong(mergedData, token, Content.SongCode);
      if (resp.status === 200) {
        setlog('success');
        setMessage('Data Updated Successfully');
        await apisendnotification({
          NotificationId: (Math.random() + 1).toString(36).substring(7),
          user_ids: [6],
          message: formState.SongCaption + ' Song Modified.',
          image: '',
          type: '1',
          location: 'Song Modified.',
          locationLabel: Username,
          Status: '1',
          isGroup: 1,
          Ispriority: 1,
          readed: 0,
        });
        setTimeout(() => navigate('/SongMaster'), 1000);
        return;
      }
      if (resp.status === 204) {
        openNotification('danger', 'Data Already Exists.');
        return;
      }
    } catch (errors) {
      if (errors.response.status == 500) {
        setlog('danger');
        setMessage('Server Error.');
        return;
      }
    }
  };

  const apiadd = async () => {
    seti(2);
    houseid(Number(formState.SongCategoryCode));
    const [hours, minutes, seconds, frames] =
      formState.Duration.split(':').map(Number);
    const totalSeconds = hours * 3600 + minutes * 60 + seconds + frames / 24; // Assuming 30 frames per second
    if (selectedchannel.length > 0) {
      const emptyFields = checkFieldsNotEmpty(
        formState,
        Object.keys(requiredFields),
      );
      if (formState.Duration == '00:00:00:00') {
        setMessage('Duration cannot be zero.');
        return;
      }
      if (emptyFields.length === 0) {
        const mergedData = {
          SongMaster: {
            SongCaption: formState.SongCaption,
            SongDuration: formState.Duration,
            SongTypeCode: Number(formState.SongTypeCode),
            BannerCode: formState.Banner,
            LanguageCode: Number(formState.Language),
            CensorshipCode: Number(formState.Censorship),
            TapeTypeCode: Number(formState.TapeType),
            ExportTapeCode: '1',
            ExportTapeCaption: formState.SongCaption,
            RemixO: formState.RemixO,
            BlackWhite: formState.BlackWhite,
            InHouseOutHouse: 1,
            SegmentNumber: 1,
            SOM: '00:00:00:00',
            FromDate: formState.FromKillDate[0],
            KillDate: formState.FromKillDate[1],
            ActiveNonActive: 0,
            FillerSynopsis: 0,
            Dated: formState.Dated,
            HouseId: formState.HouseId,
            blanktapeid: '',
            StartDate: formState.FromKillDate[0],
            RecID: '1',
            TCOUT: formState.TCOUT,
            StartTime: '',
            EndTime: '',
            IndemLetter: formState.IndemLetter ? 1 : 0,
            TapeStatus: null,
            Replacement: formState.Replacement ? 1 : 0,
            Producer: '',
            Director: '',
            MusicDirector: '',
            Album: '',
            Rating: rating,
            Aston: formState.SongCaption,
            astondisplay: 0,
            astonstart: 0,
            astonend: 0,
            astonactive: 0,
            MusicAgencyCode: formState.MusicAgencyCode,
            AstonID: 1,
            YrRelease: formState.YrRelease,
            SongCategoryCode: Number(formState.SongCategoryCode),
            SongGenreCode: Number(formState.SongGenreCode),
            MovieAlbumCode: formState.MovieAlbumCode,
            DurInSec: totalSeconds,
            Grade: Number(formState.Grade),
            Epgcaption: formState.Epgcaption,
            Scode: '',
            Era: '',
            SongTempoCode: Number(formState.SongTempoCode),
            Mood: 0,
            RCS: '',
            RCSDataType: '',
            RCSCategory: '',
            RCSYear: '',
            PrimarySongFlag: 0,
            Actor: formState.Actor,
            Actress: formState.Actress,
            Lyrics: formState.Lyrics,
            Music: formState.Music,
            Singer: formState.Singer,
            Artist: formState.Artist,
            RCSYear: formState.RCSYear,
            IsActive: 1,
          },
          songlocchnlmap: selectedchannel.map((item) => ({
            LocationCode: item.LocationCode,
            ChannelCode: item.ChannelCode,
          })),
          songrelation: sMapStarcast.map((item) => ({
            StarCastTypeCode: item.StarCastTypeCode,
            StarCastCode: item.StarCastCode,
          })),
          genvideoId: {
            LocationCode: Channel.LocationCode,
            ChannelCode: Channel.ChannelCode,
            FormName: 'Song Master',
            EventTypeCode: Number(formState.SongCategoryCode),
            Mode: 1,
          },
        };
        if (formState.FromKillDate[0] == null) {
          // If Rating is blank, remove it from the SongMaster object
          delete mergedData.SongMaster.FromDate;
          delete mergedData.SongMaster.KillDate;
          delete mergedData.SongMaster.StartDate;
        }
        try {
          const resp = await Postsong(mergedData, token);
          if (resp.status === 200) {
            setlog('success');
            setMessage('Data Inserted Successfully.');
            await apisendnotification({
              NotificationId: (Math.random() + 1).toString(36).substring(7),
              user_ids: [6],
              message: formState.SongCaption + ' Song Added.',
              image: '',
              type: '1',
              location: 'Song Added.',
              locationLabel: Username,
              Status: '1',
              isGroup: 1,
              Ispriority: 1,
              readed: 0,
            });
            setTimeout(() => navigate('/SongMaster'), 1000);
            return;
          }
          if (resp.status === 204) {
            openNotification('danger', 'Data Already Exists.');
            return;
          }
        } catch (errors) {
          if (errors.response.status == 500) {
            setlog('danger');
            setMessage('Server Error.');
            return;
          }
        }
      } else {
        emptyFields.forEach((field) => {
          setRequiredFields((prevRequiredFields) => ({
            ...prevRequiredFields,
            [field]: true,
          }));
        });
      }
    } else {
      setlog('danger');
      setMessage('Kindly Select Channel ');
    }
  };
  const [activeIndex, setActiveIndex] = useState('tab1');
  const onChange = (val, name) => {
    setFormState((prevFormState) => ({
      ...prevFormState,
      [name]: val,
    }));
  };

  const onCheck = (e) => {
    setCheckboxcon(!Checkboxcon);
  };
  console.log(Checkbox);
  const houseid = async (Id) => {
    if (Object.keys(Channel).length > 0) {
      if (ChannelSetting[0]?.IsTapeCounterFlag === 1) {
        (async (values) => {
          try {
            const resp = await apiUSP_GenerateVideoID(
              Channel.LocationCode,
              Channel.ChannelCode,
              'Song Master',
              Id,
              0,
            );
            if (formState.HouseId != resp.data[0].CommVideoID) {
              setMessage('HouseId Updated');
            }
            setFormState((prevFormState) => ({
              ...prevFormState,
              HouseId: resp.data[0].CommVideoID,
            }));
          } catch (error) {
            if (error.response.status == 500) {
              setFormState((prevFormState) => ({
                ...prevFormState,
                HouseId: '',
              }));
              setMessage('HouseId Is Not Configured With This Song Type ');
            }
          }
        })();
      }
    } else {
      setMessage('Kindly Select Global Channal');
    }
  };

  const handleBlur = (event) => {
    const { name, value } = event.target;
    const formattedValue = formatOnHHMMSSFFBlur(value);
    setFormState((prevFormState) => ({
      ...prevFormState,
      [name]: formattedValue,
    }));
  };

  const validateFields = () => {
    Object.keys(requiredFields).forEach((field) => {
      setRequiredFields((prevRequiredFields) => ({
        ...prevRequiredFields,
        [field]: !formState[field], // true if the field is empty, false otherwise
      }));
    });
  };

  const [i, seti] = useState(0);
  useEffect(() => {
    if (i > 1) {
      validateFields();
    }
  }, [formState]);
  return (
    <div>
      {message && (
        <Alert className="mb-4" type={log} showIcon>
          {message}
        </Alert>
      )}
      <Toast ref={toast} />
      <Card header={<HeaderExtra />}>
        <Tabs
          value={activeIndex}
          onChange={(e) => {
            console.log(e);
            seti(2);
            if (
              checkFieldsNotEmpty(formState, Object.keys(requiredFields))
                ?.length == 0
            ) {
              setActiveIndex(e);
            } else {
              validateFields();
            }
          }}
        >
          <TabList>
            <TabNav value="tab1" icon={<HiOutlineMusicNote />}>
              Song Details
            </TabNav>
            <TabNav value="tab2" icon={<LuListMusic />}>
              Attribute
            </TabNav>
            <TabNav value="tab3" icon={<MdFaceRetouchingNatural />}>
              Cast
            </TabNav>
            <TabNav value="tab4" icon={<MdHub />}>
              Channel Mapping
            </TabNav>
          </TabList>
          <div className="p-4">
            <TabContent value="tab1">
              <Card>
                <FormContainer>
                  <div className="grid grid-cols-4 gap-2">
                    <div className="col-span-3 ">
                      <div className="grid grid-cols-9 gap-2 mb-5">
                        <div className="col-span-3">
                          <FormItem
                            label="Song Name"
                            asterisk
                            errorMessage={
                              requiredFields.SongCaption ? 'Required' : null
                            }
                            invalid={
                              requiredFields.SongCaption &&
                              requiredFields.SongCaption
                            }
                          >
                            <Input
                              size="sm"
                              name="SongCaption"
                              maxLength="50"
                              placeholder="Enter Song Name"
                              value={formState.SongCaption}
                              onChange={(e) => {
                                const { name, value } = e.target;
                                if (isCharSong(value)) {
                                  setFormState((prevFormState) => ({
                                    ...prevFormState,
                                    [name]: value,
                                  }));
                                }
                              }}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-3">
                          <FormItem
                            label="AMA/Unicode"
                            errorMessage={
                              requiredFields.Epgcaption ? 'Required' : null
                            }
                            invalid={
                              requiredFields.Epgcaption &&
                              requiredFields.Epgcaption
                            }
                            asterisk
                          >
                            <Input
                              size="sm"
                              maxLength="50"
                              name="Epgcaption"
                              placeholder="Enter AMA/Unicode"
                              value={formState.Epgcaption}
                              onChange={handleInputChange}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-3">
                          <FormItem label="Tx Caption">
                            <Input
                              disabled
                              size="sm"
                              name="SongCaption"
                              placeholder="Enter Tx Caption"
                              value={formState.SongCaption}
                              onChange={handleInputChange}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Release"
                            asterisk
                            errorMessage={
                              requiredFields.YrRelease ? 'Required' : null
                            }
                            invalid={
                              requiredFields.YrRelease &&
                              requiredFields.YrRelease
                            }
                          >
                            <Select
                              options={years}
                              value={years.filter(
                                (option) =>
                                  option.value === formState.YrRelease,
                              )}
                              onChange={(event) => {
                                setFormState((prevFormState) => ({
                                  ...prevFormState,
                                  YrRelease: event.value,
                                }));
                              }}
                              name="YrRelease"
                            ></Select>
                          </FormItem>
                        </div>
                        <div className="col-span-3">
                          <FormItem
                            label="Music Agency"
                            asterisk
                            errorMessage={
                              requiredFields.MusicAgencyCode ? 'Required' : null
                            }
                            invalid={
                              requiredFields.MusicAgencyCode &&
                              requiredFields.MusicAgencyCode
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.MusicAgencyCode}
                              setSelected={setFormState}
                              List={MusicAgency}
                              name={'MusicAgencyCode'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            asterisk
                            label="Movie Album "
                            errorMessage={
                              requiredFields.MovieAlbumCode ? 'Required' : null
                            }
                            invalid={
                              requiredFields.MovieAlbumCode &&
                              requiredFields.MovieAlbumCode
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.MovieAlbumCode}
                              setSelected={setFormState}
                              List={MovieAlbum}
                              name={'MovieAlbumCode'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Song Category"
                            asterisk
                            errorMessage={
                              requiredFields.SongCategoryCode
                                ? 'Required'
                                : null
                            }
                            invalid={
                              requiredFields.SongCategoryCode &&
                              requiredFields.SongCategoryCode
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.SongCategoryCode}
                              setSelected={setFormState}
                              List={SongCategory}
                              name={'SongCategoryCode'}
                              handlePromoTypeChange={houseid}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-1">
                          <FormItem
                            label="Grade"
                            asterisk
                            errorMessage={
                              requiredFields.Grade ? 'Required' : null
                            }
                            invalid={
                              requiredFields.Grade && requiredFields.Grade
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.Grade}
                              setSelected={setFormState}
                              List={Grade}
                              name={'Grade'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Language"
                            asterisk
                            errorMessage={
                              requiredFields.Language ? 'Required' : null
                            }
                            invalid={
                              requiredFields.Language && requiredFields.Language
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.Language}
                              setSelected={setFormState}
                              List={Language}
                              name={'Language'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Paid/Free"
                            asterisk
                            errorMessage={
                              requiredFields.SongTypeCode ? 'Required' : null
                            }
                            invalid={
                              requiredFields.SongTypeCode &&
                              requiredFields.SongTypeCode
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.SongTypeCode}
                              setSelected={setFormState}
                              List={SongType}
                              name={'SongTypeCode'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Song Genre"
                            asterisk
                            errorMessage={
                              requiredFields.SongGenreCode ? 'Required' : null
                            }
                            invalid={
                              requiredFields.SongGenreCode &&
                              requiredFields.SongGenreCode
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.SongGenreCode}
                              setSelected={setFormState}
                              List={SongGenre}
                              name={'SongGenreCode'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Tape Type"
                            asterisk
                            errorMessage={
                              requiredFields.TapeType ? 'Required' : null
                            }
                            invalid={
                              requiredFields.TapeType && requiredFields.TapeType
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.TapeType}
                              setSelected={setFormState}
                              List={TapeType}
                              name={'TapeType'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Censorship"
                            asterisk
                            errorMessage={
                              requiredFields.Censorship ? 'Required' : null
                            }
                            invalid={
                              requiredFields.Censorship &&
                              requiredFields.Censorship
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.Censorship}
                              setSelected={setFormState}
                              List={Censorship}
                              name={'Censorship'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="Tempo"
                            asterisk
                            errorMessage={
                              requiredFields.SongTempoCode ? 'Required' : null
                            }
                            invalid={
                              requiredFields.SongTempoCode &&
                              requiredFields.SongTempoCode
                            }
                          >
                            <PromoTypeDropNew
                              selected={formState.SongTempoCode}
                              setSelected={setFormState}
                              List={SongTempo}
                              name={'SongTempoCode'}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-2">
                          <FormItem
                            label="House Id"
                            asterisk
                            errorMessage={
                              requiredFields.HouseId ? 'Required' : null
                            }
                            invalid={
                              requiredFields.HouseId && requiredFields.HouseId
                            }
                          >
                            <Input
                              size="sm"
                              disabled
                              name="HouseId"
                              maxLength="10"
                              placeholder="HouseId"
                              value={formState.HouseId}
                              onChange={handleInputChange}
                            />
                          </FormItem>
                        </div>
                        <div className="col-span-3">
                          <FormItem label="Song Rating ">
                            <div style={{ marginTop: '-10px' }}>
                              {[1, 2, 3, 4, 5].map((star, index) => (
                                <span
                                  key={index}
                                  className={`star ${rating >= star ? 'filled' : ''
                                    } ${rating === star - 0.5 ? 'half-filled' : ''
                                    }`}
                                  onClick={() => handleStarClick(star)}
                                >
                                  â˜…
                                </span>
                              ))}
                            </div>
                          </FormItem>
                        </div>
                        <div className="col-span-3 ">
                          {/* <p>{Checkbox}</p> */}
                          <Checkbox
                            checked={Checkboxcon}
                            onChange={(e) => onCheck(e)}
                          >
                            Is Dated
                          </Checkbox>
                        </div>
                        <div className="col-span-6"></div>
                        <div className="col-span-3">
                          {Checkboxcon ? (
                            <Card>
                              <div className="grid grid-cols-1 gap-1">
                                <FormItem label="From & Kill Date">
                                  <DatePickerRange
                                    placeholder="Select dates range"
                                    value={formState.FromKillDate}
                                    onChange={(e) => {
                                      handleInputChange2(e, 'FromKillDate');
                                    }}
                                  />
                                </FormItem>
                              </div>
                            </Card>
                          ) : null}
                        </div>
                      </div>
                    </div>
                    <div className="col-span-1 ">
                      <Card>
                        <div className="grid grid-cols-2 gap-1">
                          <div className="col-span-1">
                            <FormItem
                              label="TC IN"
                              asterisk
                              errorMessage={
                                requiredFields.SOM ? 'Required' : null
                              }
                              invalid={requiredFields.SOM && requiredFields.SOM}
                            >
                              <Input
                                size="sm"
                                placeholder="00:00:00:00"
                                maxLength="11"
                                name="SOM"
                                value={formState.SOM}
                                disabled
                                onChange={(e) =>
                                  handleChangeWithFrameNew(e, setFormState)
                                }
                                onBlur={handleBlur}
                              />
                            </FormItem>
                          </div>
                          <div className="col-span-1">
                            <FormItem
                              label="TC OUT"
                              asterisk
                              errorMessage={
                                requiredFields.TCOUT ? 'Required' : null
                              }
                              invalid={
                                requiredFields.TCOUT && requiredFields.TCOUT
                              }
                            >
                              <Input
                                size="sm"
                                placeholder="00:00:00:00"
                                name="TCOUT"
                                maxLength="11"
                                // disabled={parseDuration(formState.SOM) == null}
                                value={formState.TCOUT}
                                onChange={(e) =>
                                  handleChangeWithFrameNew(e, setFormState)
                                }
                                onBlur={handleBlur}
                              />
                            </FormItem>
                          </div>
                          <div className="col-span-2 ">
                            <FormItem
                              label="Duration"
                              asterisk
                              disabled
                              errorMessage={
                                requiredFields.Duration
                                  ? 'Kindly Enter Duration'
                                  : null
                              }
                              invalid={
                                requiredFields.Duration &&
                                requiredFields.Duration
                              }
                            >
                              <Input
                                size="sm"
                                placeholder="Duration"
                                maxLength="12"
                                name="Duration"
                                value={
                                  formState.Duration == 'NaN:NaN:NaN:NaN'
                                    ? '00:00:00:00'
                                    : formState.Duration
                                }
                                disabled
                                onChange={(e) =>
                                  handleChangeWithOutFrameNew(e, setFormState)
                                }
                              />
                            </FormItem>
                          </div>

                          <div className="col-span-2 ">
                            <FormItem>
                              <Radio.Group
                                value={formState.BlackWhite}
                                onChange={(e) => onChange(e, 'BlackWhite')}
                              >
                                <Radio value={0}>Colour</Radio>
                                <Radio value={1}>Black N White</Radio>
                              </Radio.Group>
                            </FormItem>
                          </div>
                          <div className="col-span-2 mb-5">
                            <FormItem>
                              <Radio.Group
                                value={formState.RemixO}
                                onChange={(e) => onChange(e, 'RemixO')}
                              >
                                <Radio value={0}>Original</Radio>
                                <Radio value={1}>Remix</Radio>
                              </Radio.Group>
                            </FormItem>
                          </div>
                          <div className="col-span-2 ">
                            <Checkbox
                              value={(formState.IndemLetter = 1 ? true : false)}
                              onChange={(e) => onChange(e, 'IndemLetter')}
                            >
                              Indemnity Letter
                            </Checkbox>
                            <Checkbox
                              value={formState.Replacement == 1 ? true : false}
                              onChange={(e) => onChange(e, 'Replacement')}
                            >
                              Replacement
                            </Checkbox>
                          </div>
                        </div>
                      </Card>
                    </div>
                  </div>
                </FormContainer>

                <div className="flex items-center ">
                  <Button size="sm" onClick={() => navigate('/SongMaster')}>
                    Discard
                  </Button>
                  <Button
                    className="ml-2"
                    size="sm"
                    onClick={() => {
                      seti(2);
                      console.log(
                        checkFieldsNotEmpty(
                          formState,
                          Object.keys(requiredFields),
                        ),
                      );
                      if (
                        checkFieldsNotEmpty(
                          formState,
                          Object.keys(requiredFields),
                        )?.length == 0
                      ) {
                        setActiveIndex('tab2');
                      } else {
                        validateFields();
                      }
                    }}
                    variant="solid"
                  >
                    Next
                  </Button>
                </div>
              </Card>
            </TabContent>

            <TabContent value="tab2">
              <Card>
                <FormContainer>
                  <div className="col-span-2">
                    <div className="flex items-center justify-between">
                      <h4 className="mb-3">Add StarCast </h4>
                      <div className="flex gap-2">
                        <Button
                          size="sm"
                          onClick={() => setIsAddStarCastTypeDialogOpen(true)}
                        >
                          Add Star Cast Type
                        </Button>
                        <Button size="sm">Add Star Cast</Button>
                      </div>
                    </div>
                    <MapStarcast
                      setMapStarcast={setMapStarcast}
                      sMapStarcast={sMapStarcast}
                      StarCastTypeList={StarCastTypeList}
                      setStarCastTypeList={setStarCastTypeList}
                    />
                  </div>
                </FormContainer>
                <br />

                <br />

                <div className="flex items-center ">
                  <Button size="sm" onClick={() => navigate('/SongMaster')}>
                    Discard
                  </Button>
                  <Button
                    className="ml-2"
                    size="sm"
                    onClick={() => {
                      seti(2);
                      console.log(
                        checkFieldsNotEmpty(
                          formState,
                          Object.keys(requiredFields),
                        ),
                      );
                      if (
                        checkFieldsNotEmpty(
                          formState,
                          Object.keys(requiredFields),
                        )?.length == 0
                      ) {
                        setActiveIndex('tab3');
                      } else {
                        validateFields();
                      }
                    }}
                    variant="solid"
                  >
                    Next
                  </Button>
                </div>
              </Card>
            </TabContent>

            <TabContent value="tab3">
              <Card>
                <FormContainer>
                  <div className="grid grid-cols-6 gap-2 mb-5">
                    <div className="col-span-2">
                      <FormItem label="Actor">
                        <Input
                          size="sm"
                          name="Actor"
                          maxLength="50"
                          placeholder="Enter Actor"
                          value={formState.Actor}
                          onChange={handleInputChange}
                        />
                      </FormItem>
                    </div>

                    <div className="col-span-2">
                      <FormItem label="Actress">
                        <Input
                          size="sm"
                          name="Actress"
                          maxLength="50"
                          placeholder="Enter Actress"
                          value={formState.Actress}
                          onChange={handleInputChange}
                        />
                      </FormItem>
                    </div>
                    <div className="col-span-2"></div>
                    <div className="col-span-2">
                      <FormItem label="Lyrics">
                        <Input
                          size="sm"
                          name="Lyrics"
                          maxLength="200"
                          placeholder="Enter Lyrics"
                          value={formState.Lyrics}
                          onChange={handleInputChange}
                        />
                      </FormItem>
                    </div>
                    <div className="col-span-2">
                      <FormItem label="Music">
                        <Input
                          size="sm"
                          name="Music"
                          maxLength="50"
                          placeholder="Enter Music"
                          value={formState.Music}
                          onChange={handleInputChange}
                        />
                      </FormItem>
                    </div>
                    <div className="col-span-2"></div>
                    <div className="col-span-2">
                      <FormItem label="Singer">
                        <Input
                          size="sm"
                          name="Singer"
                          placeholder="Enter Singer"
                          value={formState.Singer}
                          onChange={handleInputChange}
                        />
                      </FormItem>
                    </div>
                    <div className="col-span-2">
                      <FormItem label="Artist">
                        <Input
                          size="sm"
                          name="Artist"
                          placeholder="Enter Artist"
                          value={formState.Artist}
                          onChange={handleInputChange}
                        />
                      </FormItem>
                    </div>
                  </div>
                </FormContainer>
                <div className="flex items-center ">
                  <Button size="sm" onClick={() => navigate('/SongMaster')}>
                    Discard
                  </Button>
                  <Button
                    className="ml-2"
                    size="sm"
                    onClick={() => {
                      seti(2);
                      console.log(
                        checkFieldsNotEmpty(
                          formState,
                          Object.keys(requiredFields),
                        ),
                      );
                      if (
                        checkFieldsNotEmpty(
                          formState,
                          Object.keys(requiredFields),
                        )?.length == 0
                      ) {
                        setActiveIndex('tab4');
                      } else {
                        validateFields();
                      }
                    }}
                    variant="solid"
                  >
                    Next
                  </Button>
                </div>
              </Card>
            </TabContent>
            <TabContent value="tab4">
              <div className="col-span-1">
                <Card>
                  <ChannelSelecttion
                    List={channelList}
                    selectedList={selectedchannel}
                    setSelectedList={setSelectedchannel}
                  />
                </Card>
                <StickyFooter
                  className="-mx-8 px-8 flex items-center justify-between py-4"
                  stickyClass="border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"
                >
                  <div className="md:flex items-center flex">
                    {Content.SongCode ? (
                      <Button
                        variant="solid"
                        type="submit"
                        size="sm"
                        onClick={() => apiUpdate()}
                      >
                        Update
                      </Button>
                    ) : (
                      <Button
                        variant="solid"
                        size="sm"
                        type="submit"
                        onClick={() => apiadd()}
                      >
                        Submit
                      </Button>
                    )}
                  </div>
                </StickyFooter>
              </div>
            </TabContent>
          </div>
        </Tabs>
      </Card>
      {isAddStarCastTypeDialogOpen && (
        <AddStarCastTypeDialog
          isOpen={isAddStarCastTypeDialogOpen}
          setIsOpen={setIsAddStarCastTypeDialogOpen}
          setStarCastTypeList={setStarCastTypeList}
        />
      )}
    </div>
  );
});

export default SongMasterEdit;
