import React, { useContext, useState } from 'react';
import { TABLE_ROW_HEIGHT } from 'views/Scheduling/Scheduler/constants';
import { getHexColorWithOpacity } from 'views/Controls/GLOBALFUNACTION';
import SchedulerContext from 'views/Scheduling/SchedulerOld/context/SchedulerContext';
// import SchedulerContext from 'views/Scheduling/Scheduler/context/SchedulerContext';

function AutoScrollTable({ tableData, columns, scrollFunction }) {
  /* CONTEXT */
  const { schedulingTableRef } = useContext(SchedulerContext);

  /* STATES */
  const [hoveredRow, setHoveredRow] = useState(null);

  return (
    <>
      {/* Table Header */}
      <div className="flex bg-gray-700 font-semibold text-white text-[12px] sticky top-0">
        {columns.map((column, index) => (
          <div
            style={{
              width: column.style.width,
              height: `${TABLE_ROW_HEIGHT}px`,
            }}
            key={column.accessorKey}
            className={`flex items-center justify-${
              column.style.align
            } border-gray-400 border-y border-r ${index === 0 && 'border-l'}`}
          >
            {column.header}
          </div>
        ))}
      </div>
      {/* Table Body */}
      <div>
        {tableData.map((row) => (
          <div
            key={row.rowId}
            className="hover:cursor-pointer flex"
            onMouseEnter={() => setHoveredRow(row)}
            onMouseLeave={() => setHoveredRow(null)}
            onClick={
              typeof scrollFunction === 'function'
                ? () => scrollFunction(row)
                : () =>
                    schedulingTableRef.current?.scrollToItem(
                      row.rowIndex,
                      'center',
                    )
            }
          >
            {columns.map((column, index) => (
              <div
                key={index}
                style={{
                  height: `${TABLE_ROW_HEIGHT}px`,
                  width: column.style.width,
                  backgroundColor:
                    hoveredRow && hoveredRow.rowId === row.rowId
                      ? getHexColorWithOpacity(row.EventDefaultBackColor, 0.8)
                      : row.EventDefaultBackColor,
                  color: row.EventDefaultFrontColor,
                  borderColor: 'rgb(107, 114, 128)',
                }}
                className={`flex items-center justify-${
                  column.style.align
                } text-[12px] py-1 px-2.5 border-b border-r ${
                  index === 0 && 'border-l'
                }`}
              >
                <div className="text-ellipsis overflow-hidden whitespace-nowrap">
                  {row[column.accessorKey]}
                </div>
              </div>
            ))}
          </div>
        ))}
      </div>
    </>
  );
}

export default AutoScrollTable;
