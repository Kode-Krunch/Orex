{"version":3,"file":"static/js/9891.b796e388.chunk.js","mappings":"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","sources":["views/Scheduling/Scheduler/components/SchedulingArea/components/RotationInfo/RotationInfoWithManageColumns.js"],"sourcesContent":["import { Button, Card, Tooltip } from 'components/ui';\r\nimport React, { useContext, useEffect, useRef, useState } from 'react';\r\nimport { IoMdClose } from 'react-icons/io';\r\nimport {\r\n  getAllColumnsOfTable,\r\n  getColumnSettingsFromAPI,\r\n  handleFeatureClose,\r\n} from '../../utils/utils';\r\nimport {\r\n  featuresEnum,\r\n  pagesEnum,\r\n  rowDataTypesEnum,\r\n  tableTypesEnum,\r\n} from 'views/Scheduling/Scheduler/enum';\r\nimport SchedulerContext from 'views/Scheduling/Scheduler/context/SchedulerContext';\r\nimport { openNotification } from 'views/Controls/GLOBALFUNACTION';\r\nimport RotationInfoTable from './RotationInfoTable';\r\nimport BottomToolbar from './BottomToolbar';\r\nimport { TbGridDots } from 'react-icons/tb';\r\nimport classNames from 'classnames';\r\nimport ManageColumns from '../Dropdowns/ManageColumns/ManageColumns';\r\nimport { TABLE_NAMES } from 'views/Scheduling/Scheduler/constants';\r\nimport { useSelector } from 'react-redux';\r\nimport { closeDropDowns } from './utils';\r\nimport Loader from 'views/Controls/Loader';\r\n\r\nfunction RotationInfoWithManageColumns() {\r\n  /* REDUX */\r\n  const token = useSelector((state) => state.auth.session.token);\r\n\r\n  /* CONTEXT */\r\n  const {\r\n    schedulingTableData,\r\n    schedulingTableSelectedRows,\r\n    setLeftClickedSchTableRow,\r\n    setActiveFeatures,\r\n    isScheduleAllowedToEdit,\r\n    secondaryAreaZindexRef,\r\n    secondaryTableManagedColumns,\r\n    setSecondaryTableManagedColumns,\r\n    secTableToolbarState,\r\n    setSecTableToolbarState,\r\n    page,\r\n    setSecondaryTableName,\r\n  } = useContext(SchedulerContext);\r\n\r\n  /* STATES */\r\n  const [rotationInfoTableData, setRotationInfoTableData] = useState([]);\r\n  const [curSelectedEventRow, setCurSelectedEventRow] = useState(null);\r\n  const [showLoader, setShowLoader] = useState(true);\r\n\r\n  /* HOOKS */\r\n  const dropdownRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      let selectedRow = null;\r\n      if (schedulingTableSelectedRows.length === 1) {\r\n        setCurSelectedEventRow(schedulingTableSelectedRows[0]);\r\n        setLeftClickedSchTableRow(schedulingTableSelectedRows[0]);\r\n        selectedRow = schedulingTableSelectedRows[0];\r\n      } else {\r\n        selectedRow = curSelectedEventRow;\r\n      }\r\n      if (selectedRow) {\r\n        let rotationRows = [];\r\n        if (selectedRow.F_C_S_P !== rowDataTypesEnum.NTC) {\r\n          rotationRows = schedulingTableData.filter(\r\n            (row) =>\r\n              row.F_C_S_P === selectedRow.F_C_S_P &&\r\n              row.Event_Name === selectedRow.Event_Name,\r\n          );\r\n        } else {\r\n          if ('BookingDetailID' in selectedRow) {\r\n            rotationRows = schedulingTableData.filter(\r\n              (row) =>\r\n                row.F_C_S_P === rowDataTypesEnum.NTC &&\r\n                row.Event_Name === selectedRow.Event_Name &&\r\n                'BookingDetailID' in row,\r\n            );\r\n          } else {\r\n            rotationRows = schedulingTableData.filter(\r\n              (row) =>\r\n                row.F_C_S_P === rowDataTypesEnum.NTC &&\r\n                row.Event_Name === selectedRow.Event_Name &&\r\n                !('BookingDetailID' in row),\r\n            );\r\n          }\r\n        }\r\n        setRotationInfoTableData(rotationRows);\r\n      }\r\n    } catch (error) {\r\n      openNotification(\r\n        'danger',\r\n        'Something went wrong while loading rotation info',\r\n      );\r\n    }\r\n  }, [schedulingTableData, schedulingTableSelectedRows]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (\r\n          rotationInfoTableData.length > 0 &&\r\n          secondaryTableManagedColumns.originalColumns.length === 0\r\n        ) {\r\n          setShowLoader(true);\r\n          await setManagedColumns(rotationInfoTableData);\r\n        }\r\n      } catch (error) {\r\n        openNotification(\r\n          'danger',\r\n          'Something went wrong while setting columns',\r\n        );\r\n        console.error(error);\r\n      } finally {\r\n        setShowLoader(false);\r\n      }\r\n    })();\r\n  }, [rotationInfoTableData, secondaryTableManagedColumns]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('mousedown', (event) =>\r\n      closeDropDowns(event, dropdownRef, setSecTableToolbarState),\r\n    );\r\n    return () => {\r\n      document.removeEventListener('mousedown', (event) =>\r\n        closeDropDowns(event, dropdownRef, setSecTableToolbarState),\r\n      );\r\n    };\r\n  }, [dropdownRef]);\r\n\r\n  /* HELPER FUNCTIONS */\r\n  const setManagedColumns = async (tableData) => {\r\n    const tableName =\r\n      page === pagesEnum.PROMO\r\n        ? TABLE_NAMES.SECONDARY_TABLE_NAMES.PROMO_ROTATION_INFO\r\n        : page === pagesEnum.SONG\r\n        ? TABLE_NAMES.SECONDARY_TABLE_NAMES.SONG_ROTATION_INFO\r\n        : page === pagesEnum.COMMERCIAL\r\n        ? TABLE_NAMES.SECONDARY_TABLE_NAMES.COMMERCIAL_ROTATION_INFO\r\n        : page === pagesEnum.NTC\r\n        ? TABLE_NAMES.SECONDARY_TABLE_NAMES.NTC_ROTATION_INFO\r\n        : TABLE_NAMES.SECONDARY_TABLE_NAMES.FINAL_LOG_ROTATION_INFO;\r\n    setSecondaryTableName(tableName);\r\n    const ignoredColumns = ['actions', 'customCellColor', 'cellWarning'];\r\n    const { visibleColumns, removedColumns } = await getColumnSettingsFromAPI(\r\n      tableName,\r\n      tableData,\r\n      token,\r\n      undefined,\r\n      ignoredColumns,\r\n    );\r\n    setSecondaryTableManagedColumns({\r\n      originalColumns: getAllColumnsOfTable(\r\n        tableData,\r\n        undefined,\r\n        ignoredColumns,\r\n      ),\r\n      visibleColumns,\r\n      removedColumns,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"h-full w-full flex flex-col bg-gray-800 p-3 pt-2 rounded-lg absolute top-0 left-0 overflow-scroll no-scrollbar\"\r\n      style={{\r\n        zIndex:\r\n          secondaryAreaZindexRef.current[\r\n            featuresEnum.ROTATION_INFO_WITH_MANAGE_COLUMNS\r\n          ],\r\n      }}\r\n    >\r\n      <div className=\"flex justify-between items-center mb-2\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <h5>Rotation Info</h5>\r\n          {rotationInfoTableData.length > 0 && (\r\n            <h6 className=\"rounded-md px-1.5 py-0.5 bg-gray-600 flex items-center justify-center\">\r\n              {rotationInfoTableData.length}\r\n            </h6>\r\n          )}\r\n        </div>\r\n        <div className=\"flex gap-1.5\">\r\n          {rotationInfoTableData.length > 0 && (\r\n            <Tooltip title=\"Manage Columns\" wrapperClass=\"relative\">\r\n              <Button\r\n                size=\"xs\"\r\n                icon={<TbGridDots />}\r\n                className={classNames(\r\n                  secondaryTableManagedColumns.removedColumns.length > 0\r\n                    ? '!bg-teal-700 hover:!bg-teal-700'\r\n                    : 'hover:!bg-teal-800',\r\n                  'transition-all',\r\n                )}\r\n                onClick={() =>\r\n                  setSecTableToolbarState({\r\n                    ...secTableToolbarState,\r\n                    isManageColumnsDropdownVisible: true,\r\n                  })\r\n                }\r\n              />\r\n              {secTableToolbarState.isManageColumnsDropdownVisible && (\r\n                <ManageColumns\r\n                  tableType={tableTypesEnum.SECONDARY}\r\n                  dropdownRef={dropdownRef}\r\n                  position=\"right-1/2\"\r\n                />\r\n              )}\r\n            </Tooltip>\r\n          )}\r\n          <Tooltip title=\"Close\">\r\n            <Button\r\n              size=\"xs\"\r\n              icon={<IoMdClose />}\r\n              onClick={() => {\r\n                handleFeatureClose(\r\n                  setActiveFeatures,\r\n                  featuresEnum.ROTATION_INFO_WITH_MANAGE_COLUMNS,\r\n                );\r\n              }}\r\n            />\r\n          </Tooltip>\r\n        </div>\r\n      </div>\r\n      <div className=\"h-[92%] flex flex-col gap-3\">\r\n        {rotationInfoTableData.length > 0 ? (\r\n          <>\r\n            <div className=\"grow overflow-scroll\">\r\n              <RotationInfoTable\r\n                columns={secondaryTableManagedColumns.visibleColumns}\r\n                tableData={rotationInfoTableData}\r\n              />\r\n            </div>\r\n            {isScheduleAllowedToEdit && (\r\n              <BottomToolbar rotationInfoTableData={rotationInfoTableData} />\r\n            )}\r\n          </>\r\n        ) : (\r\n          <Card\r\n            className=\"h-full w-full\"\r\n            bodyClass=\"h-full w-full flex justify-center items-center p-2\"\r\n          >\r\n            Please select an event\r\n          </Card>\r\n        )}\r\n      </div>\r\n      <Loader showLoader={showLoader} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default RotationInfoWithManageColumns;\r\n"],"names":["token","useSelector","state","auth","session","schedulingTableData","schedulingTableSelectedRows","setLeftClickedSchTableRow","setActiveFeatures","isScheduleAllowedToEdit","secondaryAreaZindexRef","secondaryTableManagedColumns","setSecondaryTableManagedColumns","secTableToolbarState","setSecTableToolbarState","page","setSecondaryTableName","useContext","SchedulerContext","rotationInfoTableData","setRotationInfoTableData","useState","curSelectedEventRow","setCurSelectedEventRow","showLoader","setShowLoader","dropdownRef","useRef","useEffect","selectedRow","length","rotationRows","F_C_S_P","rowDataTypesEnum","filter","row","Event_Name","error","openNotification","originalColumns","setManagedColumns","console","document","addEventListener","event","closeDropDowns","removeEventListener","async","tableName","pagesEnum","TABLE_NAMES","ignoredColumns","visibleColumns","removedColumns","getColumnSettingsFromAPI","tableData","undefined","getAllColumnsOfTable","className","style","zIndex","current","featuresEnum","title","wrapperClass","size","icon","classNames","onClick","isManageColumnsDropdownVisible","tableType","tableTypesEnum","position","handleFeatureClose","columns","bodyClass"],"sourceRoot":""}