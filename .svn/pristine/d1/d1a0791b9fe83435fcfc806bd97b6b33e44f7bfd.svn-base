import { removeRowsFromTableData } from '../../utils';
import { getCorrectedDestIndex, validateNTCs } from './utils';

const executeNtcInsert = (
  destIndex,
  schTableData,
  secTableData,
  selectedRows,
  activeFeatures,
  channel,
  isAutoCalculateOffsetTime,
) => {
  try {
    let newSchTableData = [...schTableData];
    let newSecTableData = [...secTableData];
    let destinationIndex = getCorrectedDestIndex(
      destIndex,
      schTableData,
      activeFeatures,
    );
    const validNTCs = validateNTCs({
      destIndex: destinationIndex,
      tableData: schTableData,
      selectedRows,
      channel,
      isAutoCalculateOffsetTime,
    });
    if (!validNTCs) return false;
    newSchTableData.splice(destinationIndex, 0, ...validNTCs);
    if (validNTCs[0].BookingDetailID)
      newSecTableData = removeRowsFromTableData(selectedRows, newSecTableData);
    return { newSchTableData, newSecTableData };
  } catch (error) {
    throw error;
  }
};

export { executeNtcInsert };
