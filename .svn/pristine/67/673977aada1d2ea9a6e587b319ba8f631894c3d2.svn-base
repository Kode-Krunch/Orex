import { Button, Tooltip } from 'components/ui';
import React, { useContext } from 'react';
import { FiLayers } from 'react-icons/fi';
import { MdFilterListOff, MdOutlinePrintDisabled } from 'react-icons/md';
import DebouncedInput from './DebouncedInput';
import ManageColumnsDropDown from './DropDowns/ManageColumnsDropDown';
import ReportsTableContext from 'views/Controls/ReportsTable/context/ReportsTableContext';

function MainTableToolbar({
  globalFilter,
  setGlobalFilter,
  toolbarOptions,
  managedColumns,
  setManagedColumns,
}) {
  /* CONTEXTS */
  const {
    showGlobalToolbar,
    setShowGlobalToolbar,
    selectedFilters,
    setSelectedFilters,
    externalGlobalFilter,
  } = useContext(ReportsTableContext);

  /* EVENT HANDLERS */
  const toggleShowToolbar = () => {
    try {
      setShowGlobalToolbar((oldState) => (oldState ? false : true));
    } catch (error) {
      console.error(error);
    }
  };

  const handleClearFilter = () => {
    try {
      setSelectedFilters([]);
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <>
      <div className={`flex justify-between items-center`}>
        <div className="flex gap-2">
          {toolbarOptions.groupBy === true && (
            <>
              {typeof showGlobalToolbar === 'boolean' && showGlobalToolbar ? (
                <Tooltip title="Disable Group By">
                  <Button
                    size="sm"
                    className="w-max"
                    variant="twoTone"
                    icon={<MdOutlinePrintDisabled />}
                    onClick={toggleShowToolbar}
                  >
                    Group By
                  </Button>
                </Tooltip>
              ) : (
                <Tooltip title="Enable Group By">
                  <Button
                    size="sm"
                    className="w-max"
                    icon={<FiLayers />}
                    onClick={toggleShowToolbar}
                  >
                    Group By
                  </Button>
                </Tooltip>
              )}
            </>
          )}
          {typeof toolbarOptions.manageColumns === 'boolean' &&
            toolbarOptions.manageColumns && (
              <ManageColumnsDropDown
                managedColumns={managedColumns}
                setManagedColumns={setManagedColumns}
              />
            )}
          {selectedFilters.length > 0 && (
            <Tooltip title="Clear all filters">
              <Button
                icon={<MdFilterListOff />}
                size="sm"
                className="w-max"
                onClick={handleClearFilter}
              >
                Clear
              </Button>
            </Tooltip>
          )}
        </div>
        <div className="grow flex justify-end">
          {typeof externalGlobalFilter !== 'string' && (
            <DebouncedInput
              value={globalFilter ?? ''}
              className="p-2 shadow border border-block w-1/4 text-sm"
              placeholder="Search all columns"
              size="sm"
              onChange={(value) => setGlobalFilter(String(value))}
            />
          )}
        </div>
      </div>
    </>
  );
}

export default MainTableToolbar;
