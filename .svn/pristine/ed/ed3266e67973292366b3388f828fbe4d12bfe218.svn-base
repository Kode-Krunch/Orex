import { Button, Pagination, Select } from 'components/ui';
import React, { useContext } from 'react';
import { HiDownload } from 'react-icons/hi';
import { handleExportToExcel } from 'views/Controls/DisplayTable';
import ReportsTableContext from 'views/Controls/ReportsTable/context/ReportsTableContext';

/* CONSTANTS */
const PAGE_SIZE_OPTION = [
  { value: 10, label: '10 / page' },
  { value: 20, label: '20 / page' },
  { value: 30, label: '30 / page' },
  { value: 40, label: '40 / page' },
  { value: 50, label: '50 / page' },
];

function MainTablePagination({
  table,
  managedColumns,
  exportFileName,
  setPaginationState,
}) {
  /* CONTEXTS */
  const { exportFile, hideMaxPageSelector } = useContext(ReportsTableContext);

  /* EVENT HANDLERS */
  const onPaginationChange = (page) => {
    try {
      table.setPageIndex(page - 1);
      if (typeof setPaginationState === 'function') {
        setPaginationState({
          ...table.getState().pagination,
          pageIndex: page - 1,
        });
      }
    } catch (error) {
      console.error(error);
    }
  };

  const onSelectChange = (value = 0) => {
    try {
      table.setPageSize(Number(value));
      if (typeof setPaginationState === 'function') {
        setPaginationState({
          ...table.getState().pagination,
          pageSize: Number(value),
        });
      }
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <div className="flex items-center justify-between">
      <Pagination
        pageSize={table.getState().pagination.pageSize}
        currentPage={table.getState().pagination.pageIndex + 1}
        total={table.getCoreRowModel().rows.length}
        onChange={onPaginationChange}
      />
      <div className="flex">
        {exportFile && (
          <Button
            variant="solid"
            onClick={() => {
              handleExportToExcel(managedColumns, table, exportFileName);
            }}
            style={{ width: 130 }}
            block
            size="sm"
            icon={<HiDownload />}
          >
            Export
          </Button>
        )}
        {!hideMaxPageSelector && (
          <div style={{ minWidth: 130 }} className="ml-4">
            <Select
              size="sm"
              isSearchable={false}
              value={PAGE_SIZE_OPTION.filter(
                (option) =>
                  option.value === table.getState().pagination.pageSize,
              )}
              options={PAGE_SIZE_OPTION}
              onChange={(option) => onSelectChange(option?.value)}
            />
          </div>
        )}
      </div>
    </div>
  );
}

export default MainTablePagination;
