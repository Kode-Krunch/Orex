"use strict";(self.webpackChunkelstar=self.webpackChunkelstar||[]).push([[9861,5682],{22900:(e,t,a)=>{a.d(t,{ZA:()=>c,fp:()=>l,yS:()=>r});var n=a(54048),o=a(46152);const s=a(74569),c=async(e,t)=>{try{return o.Z.fetchData({method:"get",url:"/creditdebitmaster/?LocationCode=".concat(e.LocationCode,"&ChannelCode=").concat(e.ChannelCode),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}})}catch(a){throw a}},r=async(e,t)=>{try{return new Promise(((a,o)=>{let c={method:"post",maxBodyLength:1/0,url:n.Z.apiPrefix+"/creditdebitmaster/",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},data:e};s.request(c).then((e=>{a(e)})).catch((e=>{o(e)}))}))}catch(a){throw a}},l=(e,t)=>{try{return new Promise(((a,o)=>{let c={method:"put",maxBodyLength:1/0,url:n.Z.apiPrefix+"/invoice/invoicepaymentupdate/",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},data:e};s.request(c).then((e=>{a(e)})).catch((e=>{o(e)}))}))}catch(a){throw a}}},25579:(e,t,a)=>{a.d(t,{Ei:()=>y,I6:()=>x,Qj:()=>i,U$:()=>m,Uy:()=>v,Z_:()=>c,_K:()=>g,b6:()=>r,d:()=>l,db:()=>f,fh:()=>h,gg:()=>p,hu:()=>s,iD:()=>d,rd:()=>u,w_:()=>D});a(54048);var n=a(46152),o=a(54748);a(74569);async function s(e){return n.Z.fetchData({url:"/dealmaster/".concat(e),method:"get"})}async function c(e){return n.Z.fetchData({url:"/dealattachment/".concat(e),method:"get"})}async function r(e,t,a){return n.Z.fetchData({url:"/dealmaster/dealforapproval/?DealNumber=".concat(e,"&IsApproved=").concat(t,"&RejectRemark=").concat(a),method:"get"})}async function l(e,t){return n.Z.fetchData({url:"/dealmaster/?LocationCode=".concat(e.LocationCode,"&ChannelCode=").concat(e.ChannelCode,"&StartDate=").concat((0,o.Tk)(t[0]),"&EndDate=").concat((0,o.Tk)(t[1])),method:"get"})}async function i(e){return n.Z.fetchData({url:"/sponsortypemaster/drop/",method:"get",data:e})}async function d(e){return n.Z.fetchData({url:"/spottypemaster/drop/",method:"get",data:e})}async function m(e){return n.Z.fetchData({url:"/dealdetail/".concat(e),method:"get"})}async function u(e){return n.Z.fetchData({url:"/dealmaster/USP_Sch_DealConsumptionCheck/?DealNumber=".concat(e),method:"get"})}async function h(e,t,a,o,s,c){return n.Z.fetchData({url:"/dealmaster/bindstartnendtime/?LocationCode=".concat(s,"&ChannelCode=").concat(c,"&DealPeriodToDate=").concat(e,"&DealPeriodFromDate=").concat(t,"&ContentCode=").concat(a,"&OriginalRepeatCode=").concat(o),method:"get"})}async function g(e,t,a){return n.Z.fetchData({url:"/bookingdetails/bookingchange/?flag=".concat(e,"&IsNtc=").concat(a),method:"put",data:t})}async function p(e,t){var a={params:t};return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:a,method:"post"})}async function y(e){return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:{params:{}},method:"post"})}async function x(e,t,a){var o={params:{Bookingcode:t,IsNTC:a}};return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:o,method:"post"})}async function f(e){var t={params:{CheckMonth:e}};return n.Z.fetchData({url:"/callstoreprocedure/USP_DealDashboardDoughnut",data:t,method:"post"})}async function v(e,t){var a={params:{BookingNumber:t,deallineitemno:0}};return n.Z.fetchData({url:"/callstoreprocedure/"+e,data:a,method:"post"})}async function D(e){return n.Z.fetchData({url:"currencyexchangerate/?basecurrency=".concat(e),method:"post"})}},80939:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var n=a(1413),o=a(72791),s=a(2803),c=a(96361),r=a(87537),l=a(54652),i=a(81721),d=a(81320),m=a(60488),u=a(31362),h=a(60364),g=a(93673),p=a(47475),y=a(9494),x=a(67207),f=a(22900),v=a(45682),D=a(25579),b=a(54748),j=a(80184);const C=()=>{var e;const t=(0,h.useSelector)((e=>e.locale.selectedChannel)),a=(0,h.useSelector)((e=>e.auth.session.token)),[C,S]=(0,o.useState)(""),[N,Z]=(0,o.useState)([]),[w,T]=(0,o.useState)([""]),[P,k]=(0,o.useState)({}),[R,I]=(0,o.useState)([]),[A,F]=(0,o.useState)([]),[L,_]=(0,o.useState)([]),[z,E]=(0,o.useState)([]),[B,M]=(0,o.useState)([]),[O,U]=(0,o.useState)([]),[q,J]=(0,o.useState)({pageIndex:0,pageSize:10}),[V,$]=(0,o.useState)({}),[K,Y]=(0,o.useState)(!0),[G,Q]=(0,o.useState)(!1),[H,W]=(0,o.useState)(!1);(0,o.useEffect)((()=>{(0,m.Dh)();try{K&&((async e=>{W(!0);const a=await(0,D.gg)("USP_DropDown_List_Billing",{par_LocationCode:t.LocationCode,par_ChannelCode:t.ChannelCode,par_FromDate:"2024-08-01",par_ToDate:"2024-08-31",FieldTable:"AGENCYMASTER"});if(204==a.status)return void T({});console.log(a.data);const n=a.data.map((e=>({label:e.DisplayLabel,value:e.DisplayValue})));T(n)})(),W(!1))}catch(e){console.error(e),W(!1)}}),[K,t]),(0,o.useEffect)((()=>{(async()=>{var e;if(2===(null===P||void 0===P||null===(e=P.datesrange)||void 0===e?void 0:e.length)&&P.datesrange[0]&&P.datesrange[1]){var a;W(!0);const e={LocationCode:t.LocationCode,ChannelCode:t.ChannelCode,FromDate:(0,b.Tk)(P.datesrange[0]),ToDate:(0,b.Tk)(P.datesrange[1]),AgencyCode:N.value},o=await(0,y.apiCallstoreprocedure)("usp_Bill_Payment_Adjustment",e);if((null===o||void 0===o||null===(a=o.data)||void 0===a?void 0:a.length)>0){const e=o.data.map((e=>(0,n.Z)((0,n.Z)({},e),{},{PaymentReceiveDateTime:"-",PaymentReceiveDate:"-"}))),t=Object.keys(e[0]).map((e=>({accessorKey:e,header:e})));F(t),I(e)}else I([]);W(!1)}})()}),[P.datesrange,t]),(0,o.useEffect)((()=>{try{X(z),ee()}catch(e){console.error(e)}}),[z]),(0,o.useEffect)((()=>{te()}),[t]);const X=e=>{try{const t=e.reduce(((e,t)=>(t&&(e.totalPayableAmount+=t.PayableAmount),e)),{totalPayableAmount:0});M(t)}catch(t){throw t}},ee=()=>{try{let e=Object.assign([],R);if(L.length<z.length)z.forEach((t=>{e[t.rowIndex].PaymentReceiveDateTime=P.paymentReceivedDateTime,e[t.rowIndex].PaymentReceiveDate=P.formattedPaymentReceivedDate}));else{(0,d.getMissingObjectsInSubJSONArray)(L,z,"rowIndex").forEach((t=>{e[t.rowIndex].PaymentReceiveDateTime="-",e[t.rowIndex].PaymentReceiveDate="-"}))}_(z),I(e)}catch(e){throw e}},te=()=>{try{S(""),Z([]),T([""]),k({}),I([]),F([]),_([]),E([]),M([]),U([]),J({pageIndex:0,pageSize:10}),$({}),Y(!0),Q(!1)}catch(e){throw e}},ae=new Date;return ae.setMonth(ae.getMonth()-1),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(s.Zb,{header:(0,j.jsx)(c.Z,{}),children:[(0,j.jsx)("div",{className:"mb-6",children:(0,j.jsxs)("div",{className:"grid grid-cols-4 gap-x-5 items-center",children:[(0,j.jsxs)("div",{className:"col-span-4",children:[(0,j.jsx)("p",{className:"text-white mb-1 font-semibold",children:"Search Agency"}),w&&(0,j.jsx)(l.Z,{className:"block",SelectedItem:N,setSelectedItem:Z,data:w,placeholder:"Search Agency...",setInputValue:S,InputValue:C,ResetData:te})]}),(0,j.jsx)("div",{className:"col-span-1",children:0!=(null===N||void 0===N?void 0:N.length)&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("p",{className:"text-white mb-1",children:"Select Date Range"}),(0,j.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,j.jsx)(r.Z,{placeholder:"Select date range",style:{fontSize:"15px",marginRight:"10px"},onChange:e=>{k((t=>(0,n.Z)((0,n.Z)({},t),{},{datesrange:e})))},size:"sm"})})]})}),(0,j.jsx)("div",{className:"col-span-1",children:0!=(null===N||void 0===N?void 0:N.length)&&2===(null===P||void 0===P||null===(e=P.datesrange)||void 0===e?void 0:e.length)&&(null===P||void 0===P?void 0:P.datesrange[0])&&(null===P||void 0===P?void 0:P.datesrange[1])&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("p",{className:"text-white mb-1",children:"Payment Received Date"}),(0,j.jsx)(u.ZP,{minDate:ae,placeholder:"Pick a date",onChange:e=>{(e=>{try{const t=e.getFullYear(),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),c="".concat(t,"-").concat(o,"-").concat(s,"T00:00:00"),r="".concat(e.getDate(),"-").concat(a,"-").concat(t);k((e=>(0,n.Z)((0,n.Z)({},e),{},{paymentReceivedDateTime:c,formattedPaymentReceivedDate:r})))}catch(t){console.error(t)}})(e)},clearable:!1,size:"sm"})]})}),(0,j.jsx)("div",{}),z.length>0&&B&&(0,j.jsxs)("div",{className:"col-span-1 flex flex-col items-end mr-2",children:[(0,j.jsx)("span",{className:"mb-1 font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Total Amount"}),(0,j.jsx)("span",{className:"font-semibold text-xl text-teal-500",children:(0,d.numberToINRFormat)(B.totalPayableAmount)})]})]})}),R.length>0&&(0,j.jsx)(j.Fragment,{children:P.paymentReceivedDateTime?(0,j.jsx)(g.Z,{tableData:R,tableName:"invoiceAdjustment",originalColumns:A,managedColumns:O,setManagedColumns:U,exportFile:!1,columnsToFormatInINR:[],tableType:p.$.tableTypes.SELECTABLE,setSelectedRows:E,paginationState:q,setPaginationState:J,rowSelection:V,setRowSelection:$}):(0,j.jsx)(g.Z,{tableData:R,tableName:"invoiceAdjustment",originalColumns:A,managedColumns:O,setManagedColumns:U,exportFile:!1,columnsToFormatInINR:[]})})]}),z.length>0&&(0,j.jsxs)(i.gi,{className:"-mx-8 px-8 flex items-center justify-between py-4 pt-2 pb-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[(0,j.jsxs)("div",{className:"md:flex items-center",children:[(0,j.jsx)(s.zx,{onClick:()=>Q(!0),variant:"solid",type:"submit",size:"sm",children:"Proceed to Save"}),"\xa0",(0,j.jsx)(s.zx,{onClick:()=>te(),type:"button",size:"sm",children:"Discard"})]}),(0,j.jsxs)("div",{id:"myblock",className:"grid grid-cols-2 gap-6 p-4 pt-0 pb-1 bg-gray-100 dark:bg-gray-800",children:[(0,j.jsxs)("div",{className:"flex flex-col lbl",children:[(0,j.jsx)("span",{className:"font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Total Invoices"}),(0,j.jsx)("span",{className:"font-medium text-lg text-teal-500",children:R.length})]}),(0,j.jsxs)("div",{className:"flex flex-col lbl",children:[(0,j.jsx)("span",{className:"font-medium text-gray-600 dark:text-gray-300 text-sm",children:"Selected Invoices"}),(0,j.jsx)("span",{className:"font-medium text-lg text-teal-500",children:z.length})]})]})]}),(0,j.jsx)(x.Z,{isDialogOpen:G,title:"Save",description:"Are you sure you want to save?",submitButtonTitle:"Save",handleDialogSubmit:async()=>{const e=R.filter((e=>"-"!==e.PaymentReceiveDateTime)).map((e=>({InvoiceNumber:e.InvoiceNumber,PaymentReceiveDate:(0,d.getDateFromDateTime)(e.PaymentReceiveDateTime)})));try{W(!0);const t=await(0,f.fp)(e,a);if(W(!1),200===t.status)return Q(!1),te(),void(0,d.openNotification)("success","Invoice adjusted successfully");W(!1)}catch(t){500===t.response.status&&(0,d.openNotification)("danger","Server Error."),W(!1)}},handleDialogClose:()=>Q(!1)}),(0,j.jsx)(v.default,{showLoader:H})]})}},45682:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});var n=a(2803),o=(a(72791),a(80184));const s=function(e){let{showLoader:t}=e;return(0,o.jsx)(o.Fragment,{children:t?(0,o.jsx)("div",{className:"dialog-overlay flex justify-center items-center z-50",children:(0,o.jsx)(n.$j,{size:"3.25rem"})}):(0,o.jsx)(o.Fragment,{})})}},67207:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(2803),o=(a(72791),a(80184));const s=function(e){let{isDialogOpen:t,title:a,description:s,descClassName:c,submitButtonTitle:r,submitButtonColor:l,handleDialogSubmit:i,handleDialogClose:d,overlayClassName:m,secondaryDescription:u}=e;return(0,o.jsxs)(n.Vq,{isOpen:t,onClose:d,onRequestClose:d,overlayClassName:m,children:[(0,o.jsx)("h5",{className:"mb-4",children:a}),(0,o.jsx)("p",{className:c,children:s}),(0,o.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,o.jsx)("p",{children:u}),(0,o.jsx)(n.zx,{variant:"solid",color:l,onMouseDown:i,children:r})]})]})}}}]);
//# sourceMappingURL=9861.0daee77b.chunk.js.map