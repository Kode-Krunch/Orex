import React, { lazy, Suspense, useContext, useState } from 'react';
import { Button, Tooltip } from 'components/ui';
import { FaRegSquarePlus } from 'react-icons/fa6';
import { LuCopyPlus } from 'react-icons/lu';
import { getClassNames, isFeatureDisabled } from './utils';
import { HiMiniArrowsRightLeft } from 'react-icons/hi2';
import { PiSwap } from 'react-icons/pi';
import {
  operationTypesEnum,
  rowDataTypesEnum,
  secTableBottomToolbarFeaturesEnum,
} from 'views/Scheduling/Scheduler/enum';
import Loader from 'views/Controls/Loader';
import { openNotification } from 'views/Controls/GLOBALFUNACTION';
import SchedulerContext from 'views/Scheduling/SchedulerOld/context/SchedulerContext';
// import SchedulerContext from 'views/Scheduling/Scheduler/context/SchedulerContext';

/* CODE SPLITTING */
const ReplaceAllDialog = lazy(() => import('./components/ReplaceAllDialog'));
const BulkInsertDialog = lazy(() =>
  import('./components/BulkInsertDialog/BulkInsertDialog'),
);

function SecondaryTableToolbar({ insertType }) {
  /* CONTEXT */
  const {
    schedulingTableSelectedRows,
    secondaryTableSelectedRows,
    executeOperation,
  } = useContext(SchedulerContext);

  /* STATES */
  const [isReplaceAllDialogOpen, setIsReplaceAllDialogOpen] = useState(false);
  const [isBulkInsertDialogOpen, setIsBulkInsertDialogOpen] = useState(false);

  /* EVENT HANDLERS */
  const handleInsert = () => {
    try {
      executeOperation({
        operation: operationTypesEnum.INSERT_ROW,
      });
    } catch (error) {
      console.error(error);
      openNotification('danger', 'Something went wrong while inserting events');
    }
  };

  const handleReplace = () => {
    try {
      executeOperation({
        operation: operationTypesEnum.REPLACE_ROW,
      });
      openNotification('success', 'Events replaced successfully');
    } catch (error) {
      console.error(error);
      openNotification('danger', 'Something went wrong while replacing events');
    }
  };

  return (
    <Suspense fallback={<Loader showLoader={true} />}>
      <div className="bg-gray-700 bg-opacity-50 flex gap-0.5 p-0.5 rounded-lg border border-gray-600">
        <Tooltip title="Insert">
          <Button
            className={getClassNames()}
            variant="plain"
            size="sm"
            icon={<FaRegSquarePlus className="text-base" />}
            disabled={isFeatureDisabled(
              schedulingTableSelectedRows,
              secondaryTableSelectedRows,
              secTableBottomToolbarFeaturesEnum.INSERT,
            )}
            onClick={handleInsert}
          />
        </Tooltip>
        {insertType !== rowDataTypesEnum.COMMERCIAL && (
          <>
            <Tooltip title="Bulk Insert" wrapperClass="relative">
              <Button
                className={getClassNames()}
                variant="plain"
                size="sm"
                icon={<LuCopyPlus className="text-lg" />}
                disabled={isFeatureDisabled(
                  schedulingTableSelectedRows,
                  secondaryTableSelectedRows,
                  secTableBottomToolbarFeaturesEnum.BULK_INSERT,
                )}
                onClick={() => setIsBulkInsertDialogOpen(true)}
              />
              {isBulkInsertDialogOpen && (
                <BulkInsertDialog
                  isDialogOpen={isBulkInsertDialogOpen}
                  setIsDialogOpen={setIsBulkInsertDialogOpen}
                  insertType={insertType}
                />
              )}
            </Tooltip>
            <Tooltip title="Replace">
              <Button
                className={getClassNames()}
                variant="plain"
                size="sm"
                icon={<HiMiniArrowsRightLeft className="text-[1.12rem]" />}
                disabled={isFeatureDisabled(
                  schedulingTableSelectedRows,
                  secondaryTableSelectedRows,
                  secTableBottomToolbarFeaturesEnum.REPLACE,
                )}
                onClick={handleReplace}
              />
            </Tooltip>
            <Tooltip title="Replace All">
              <Button
                className={getClassNames()}
                variant="plain"
                size="sm"
                icon={<PiSwap className="text-xl" />}
                disabled={isFeatureDisabled(
                  schedulingTableSelectedRows,
                  secondaryTableSelectedRows,
                  secTableBottomToolbarFeaturesEnum.REPLACE_ALL,
                )}
                onClick={() => setIsReplaceAllDialogOpen(true)}
              />
              {isReplaceAllDialogOpen && (
                <ReplaceAllDialog
                  isDialogOpen={isReplaceAllDialogOpen}
                  setIsDialogOpen={setIsReplaceAllDialogOpen}
                />
              )}
            </Tooltip>
          </>
        )}
      </div>
    </Suspense>
  );
}

export default SecondaryTableToolbar;
