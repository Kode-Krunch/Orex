"use strict";(self.webpackChunkelstar=self.webpackChunkelstar||[]).push([[6446],{46446:(e,a,s)=>{s.r(a),s.d(a,{default:()=>P});var l=s(1413),n=s(72791),r=s(28536),i=s(81721),t=s(2803),o=s(58617),c=s(17425),d=s(41578),h=s(97261),u=s(87350),m=s(60364),x=s(81320),p=s(54748),j=s(45682),g=s(63821),v=s(34927),b=s(67388),f=s(9494),S=s(91615),C=s(21260),k=s(34786),N=s(80184);const{Tr:y,Th:Z,Td:w,THead:B,TBody:T}=t.iA,q=(e,a)=>(0,l.Z)({userSelect:"none",margin:"0 0 5px 0",background:"transparent",display:e?"flex":null},a),P=e=>{let{verticalOpen:a,onDrawerClose:s}=e;const{date:P,showLoader:R,setShowLoader:A,executeOperation:I}=(0,n.useContext)(S.Z),L=(0,m.useSelector)((e=>e.auth.session.ChannelSetting)),M=(0,m.useSelector)((e=>e.locale.selectedChannel)),[D,z]=(0,n.useState)("0"),[G,Y]=(0,n.useState)({}),[E,_]=(0,n.useState)(!1),[H,O]=(0,n.useState)({SpotSequence:2,SpotRate:0,Timeband:0}),[F,K]=(0,n.useState)([]),[W,Q]=(0,n.useState)([]),U=(0,n.useCallback)((e=>e.map(((e,a)=>({Code:e.Code,Name:e.Name,colorClass:(0,h.H)(),back2back:1===(null===e||void 0===e?void 0:e.back2back),multi:1===(null===e||void 0===e?void 0:e.multi),sequence:(null===e||void 0===e?void 0:e.sequence)||a+1})))),[]);(0,n.useEffect)((()=>{(async()=>{try{A(!0);const e={LocationCode:M.LocationCode,ChannelCode:M.ChannelCode},a=await(0,u.Fb)(e);if(a.data[0]){const e=a.data[0];Y(e),O({SmartshufflesettingCode:e.SmartshufflesettingCode,MultiSpots:1===e.MultiSpots,MakeGoodPriority:1===e.MakeGoodPriority,BreakDuration:e.BreakDuration,BonusRatio:e.BonusRatio,SpotRate:e.SpotRate,Timeband:e.Timeband,SpotSequence:e.SpotSequence,Isbarkrating:1===e.Isbarkrating,hour_allocation:"1"==e.hour_allocation}),2===e.SpotSequence?(X([]),J(e.details)):1===e.SpotSequence?(J([]),X(e.details)):$()}}catch(e){console.error("Failed to fetch Smart Shuffle Setting:",e)}finally{A(!1)}})()}),[M]);const V=(e,a,s,n)=>{const r=new Set(e.map((e=>e.Code))),i=e.map((e=>(0,l.Z)((0,l.Z)({},e),{},{colorClass:e.colorClass||(0,h.H)()})));return[...i,...a.filter((e=>!r.has(e[s]))).map(((e,a)=>({Code:e[s],Name:e[n],back2back:0,colorClass:(0,h.H)(),multi:0,sequence:i.length+a+1})))]},J=async e=>{try{const a=await(0,b.apiGetbrandmaster)(),s=e.length>0?V(e,a.data,"BrandCode","BrandName"):U(a.data.map((e=>{let{BrandName:a,BrandCode:s}=e;return{Name:a,Code:s}})));K(s)}catch(a){console.error("Error fetching brand list:",a)}},X=async e=>{try{const a=await(0,k.oy)(),s=e.length>0?V(e,a.data,"AgencyCode","AgencyName"):U(a.data.map((e=>{let{AgencyName:a,AgencyCode:s}=e;return{Name:a,Code:s}})));Q(s)}catch(a){console.error("Error fetching agency list:",a)}},$=async()=>{try{const[e,a]=await Promise.all([(0,b.apiGetbrandmaster)(),(0,k.oy)()]);K(U(e.data.map((e=>{let{BrandName:a,BrandCode:s}=e;return{Name:a,Code:s}})))),Q(U(a.data.map((e=>{let{AgencyName:a,AgencyCode:s}=e;return{Name:a,Code:s}}))))}catch(e){console.error("Error fetching brands or agencies:",e)}},ee=(e,a)=>{O((s=>(0,l.Z)((0,l.Z)({},s),{},{[e]:a})))},ae=e=>{O((a=>(0,l.Z)((0,l.Z)({},a),{},{[e]:!a[e]})))},se=(e,a)=>{K((s=>s.map(((s,n)=>n===e?(0,l.Z)((0,l.Z)({},s),{},{[a]:!s[a]},"back2back"!==a||s[a]?{}:{multi:!0}):s))))},le=(e,a)=>{Q((s=>s.map(((s,n)=>n===e?(0,l.Z)((0,l.Z)({},s),{},{[a]:!s[a]},"back2back"!==a||s[a]?{}:{multi:!0}):s))))},ne=(0,N.jsxs)("div",{className:"text-right w-full",children:[(0,N.jsx)(t.zx,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),(0,N.jsx)(t.zx,{size:"sm",variant:"twoTone",onClick:async()=>{A(!0);const e={request:(0,l.Z)((0,l.Z)({},H),{},{Isbarkrating:H.Isbarkrating?1:0,MultiSpots:H.MultiSpots?1:0,MakeGoodPriority:H.MakeGoodPriority?1:0,LocationCode:M.LocationCode,ChannelCode:M.ChannelCode,IsActive:1,BreakDuration:H.BreakDuration,BonusRatio:H.BonusRatio,SpotRate:H.SpotRate,Timeband:H.Timeband,SpotSequence:H.SpotSequence,hour_allocation:H.hour_allocation?"1":"0"}),details:0==H.SpotSequence?[]:1==H.SpotSequence?W.map(((e,a)=>(0,l.Z)((0,l.Z)({},e),{},{back2back:e.back2back?1:0,multi:e.multi?1:0,sequence:a+1}))):F.map(((e,a)=>(0,l.Z)((0,l.Z)({},e),{},{back2back:e.back2back?1:0,multi:e.multi?1:0,sequence:a+1})))};try{200===(H.SmartshufflesettingCode?await(0,u.hE)(e,H.SmartshufflesettingCode):await(0,u.je)(e)).status&&s()}catch(a){console.error("Failed to save data:",a)}finally{A(!1)}},className:"mr-2",children:"Save"}),(0,N.jsx)(t.zx,{size:"sm",variant:"solid",onClick:()=>_(!0),children:"Smart Shuffle"})]});return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(j.default,{showLoader:R}),(0,N.jsx)(t.dy,{title:"Auto Smart Shuffle",isOpen:a,placement:"right",footer:ne,width:800,onClose:s,children:(0,N.jsxs)(i.W2,{className:"h-full",children:[(0,N.jsx)("div",{className:"grid grid-cols-6 gap-4 ",children:(0,N.jsx)("div",{className:"col-span-6",children:(0,N.jsx)(t.mQ,{value:D,onChange:e=>z(e),children:(0,N.jsxs)(g.Z,{children:[(0,N.jsx)(v.Z,{value:"0",icon:(0,N.jsx)(d.sDK,{}),children:"Settings"}),(0,N.jsx)(v.Z,{value:"1",icon:(0,N.jsx)(d.sDK,{}),children:"Spot Sequence"})]})})})}),"0"===D&&(0,N.jsxs)(t.Zb,{className:"col-span-6 mt-4",children:[(0,N.jsxs)("div",{className:"flex justify-between grid grid-cols-6 gap-3 pb-2 ",children:[(0,N.jsx)("div",{className:" col-span-2",children:(0,N.jsxs)("div",{children:[(0,N.jsx)("label",{children:"Per Break"}),(0,N.jsx)(t.II,{className:"w-50 ",size:"sm",name:"BreakDuration",maxLength:"12",value:H.BreakDuration,disabled:H.hour_allocation,onChange:e=>{var a;return(0,x.handleChangeWithFrameNew)(e,O,Number((null===(a=L[0])||void 0===a?void 0:a.FramePerSec)||24))},onBlur:e=>{var a;const{name:s,value:n}=e.target,r=Number((null===(a=L[0])||void 0===a?void 0:a.FramePerSec)||24);O((e=>(0,l.Z)((0,l.Z)({},e),{},{[s]:r})))}})]})}),(0,N.jsxs)("div",{className:" col-span-1",children:[(0,N.jsx)("label",{children:"Bonus Ratio"}),(0,N.jsx)(t.II,{className:"w-28",size:"sm",prefix:"%",maxLength:"3",suffix:(0,N.jsx)(t.u,{title:"Between 100%",children:(0,N.jsx)(o.baL,{className:"text-lg cursor-pointer ml-1"})}),value:H.BonusRatio,onChange:e=>{(0,p.n1)(e.target.value)&&ee("BonusRatio",e.target.value)}})]}),(0,N.jsxs)("div",{className:"col-span-3",children:[(0,N.jsx)(t.T5,{checked:H.hour_allocation,className:"mt-1 mr-2",onChange:e=>{ae("hour_allocation"),H.hour_allocation||O((e=>(0,l.Z)((0,l.Z)({},e),{},{BreakDuration:""})))}}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h6",{className:"!font-medium !text-sm",children:"Hourly Allocation"}),(0,N.jsx)("p",{children:"Multiple One program for better reach and revenue."})]})]})]}),(0,N.jsxs)("div",{className:"grid grid-cols-3 gap-2 pb-4 pt-2",children:[(0,N.jsxs)(i.lG,{bodyClass:"p-3",className:"w-[200px]  col-1",children:[(0,N.jsx)("h6",{children:"Timeband"}),(0,N.jsxs)(t.Y8.Group,{vertical:!0,value:H.Timeband,onChange:e=>ee("Timeband",e),children:[(0,N.jsx)(t.Y8,{value:0,children:"No Preference"}),(0,N.jsx)(t.Y8,{value:1,children:"Short Timeband"}),(0,N.jsx)(t.Y8,{value:2,children:"Long Timeband"})]})]}),(0,N.jsx)("div",{children:(0,N.jsxs)(t.Zb,{bodyClass:"p-3",children:[(0,N.jsx)("h6",{children:"SpotRate"}),(0,N.jsxs)(t.Y8.Group,{vertical:!0,value:H.SpotRate,onChange:e=>ee("SpotRate",e),children:[(0,N.jsx)(t.Y8,{value:0,children:"No Preference"}),(0,N.jsx)(t.Y8,{value:1,children:"Low To High"}),(0,N.jsx)(t.Y8,{value:2,children:"High To Low"})]})]})})]}),(0,N.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{className:"flex mb-3",children:[(0,N.jsx)(t.T5,{checked:H.MultiSpots,className:"mt-1 mr-2",onChange:()=>ae("MultiSpots")}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h6",{className:"!font-medium !text-sm",children:"Multi Spots"}),(0,N.jsx)("p",{children:"Multiple One program for better reach and revenue."})]})]}),(0,N.jsxs)("div",{className:"flex mb-3",children:[(0,N.jsx)(t.T5,{checked:H.MakeGoodPriority,className:"mt-1 mr-2",onChange:()=>ae("MakeGoodPriority")}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h6",{className:"!font-medium !text-sm",children:"MakeGood Priority"}),(0,N.jsx)("p",{children:"Set Priority spots if their original spots fail to air."})]})]}),(0,N.jsxs)("div",{className:"flex mb-3",children:[(0,N.jsx)(t.T5,{checked:H.Isbarkrating,className:"mt-1 mr-2",onChange:()=>ae("Isbarkrating")}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h6",{className:"!font-medium !text-sm",children:"As Per BARC Rating"}),(0,N.jsx)("p",{children:"Multiple One program for better reach and revenue."})]})]})]})," "]})]}),"1"===D&&(0,N.jsxs)(i.lG,{className:"h-full col-span-6 grow overflow-y-auto mt-4",bodyClass:"h-full grow overflow-y-auto",children:[(0,N.jsxs)(t.Zb,{bodyClass:"p-2 ",className:"mb-2",children:[(0,N.jsx)("h6",{className:"mb-2",children:"Spot Sequence"}),(0,N.jsxs)(t.Y8.Group,{value:H.SpotSequence,onChange:e=>ee("SpotSequence",e),children:[(0,N.jsx)(t.Y8,{value:0,children:"No Preference"}),(0,N.jsx)(t.Y8,{value:1,children:"Agency Wise"}),(0,N.jsx)(t.Y8,{value:2,children:"Brand Wise"})]})]}),2==H.SpotSequence&&(0,N.jsx)(r.Z5,{onDragEnd:e=>{if(!e.destination)return;const a=Array.from(F),[s]=a.splice(e.source.index,1);a.splice(e.destination.index,0,s),K(a)},children:(0,N.jsx)(r.bK,{droppableId:"brandsList",children:(e,a)=>(0,N.jsx)("div",(0,l.Z)((0,l.Z)({},e.droppableProps),{},{ref:e.innerRef,style:(a.isDraggingOver,{background:"transparent"}),children:(0,N.jsxs)(t.iA,{compact:!0,borderlessRow:!1,children:[(0,N.jsx)(B,{children:(0,N.jsxs)(y,{children:[(0,N.jsx)(Z,{children:"Brand"}),(0,N.jsx)(Z,{children:"Is Back 2 Back"}),(0,N.jsx)(Z,{children:"Is MultiBrand"})]})}),(0,N.jsxs)(T,{children:[F.map(((e,a)=>(0,N.jsx)(r._l,{draggableId:"".concat(null===e||void 0===e?void 0:e.Code),index:a,children:(s,n)=>(0,N.jsxs)(y,(0,l.Z)((0,l.Z)((0,l.Z)({ref:s.innerRef},s.draggableProps),s.dragHandleProps),{},{style:q(n.isDragging,s.draggableProps.style),children:[(0,N.jsxs)(w,{className:"flex items-center",children:[(0,N.jsx)(c.vKY,{size:20,className:"mr-1"}),(0,N.jsx)(t.qE,{size:"sm",shape:"circle",className:"mr-3 dark:".concat(e.colorClass," ").concat(e.colorClass),children:(0,N.jsx)("p",{className:"text-base dark:text-gray-200 text-gray-800",children:(null===e||void 0===e?void 0:e.Name)&&(null===e||void 0===e?void 0:e.Name.slice(0,1))})}),(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"text-base font-semibold dark:text-gray-200 text-gray-800 capitalize",children:null===e||void 0===e?void 0:e.Name})," ",(0,N.jsx)("p",{className:"text-xs dark:text-gray-400 text-gray-400",children:null===e||void 0===e?void 0:e.Name})]})]}),(0,N.jsx)(w,{children:(0,N.jsx)(t.T5,{checked:null===e||void 0===e?void 0:e.back2back,onChange:()=>se(a,"back2back")})}),(0,N.jsx)(w,{children:(0,N.jsx)(t.T5,{checked:null===e||void 0===e?void 0:e.multi,onChange:()=>se(a,"multi")})})]}))},"".concat(null===e||void 0===e?void 0:e.Code)))),e.placeholder]})]})}))})}),1==H.SpotSequence&&(0,N.jsx)(r.Z5,{onDragEnd:e=>{if(!e.destination)return;const a=Array.from(W),[s]=a.splice(e.source.index,1);a.splice(e.destination.index,0,s),Q(a)},children:(0,N.jsx)(r.bK,{droppableId:"agencyList",children:(e,a)=>(0,N.jsx)("div",(0,l.Z)((0,l.Z)({},e.droppableProps),{},{ref:e.innerRef,style:(a.isDraggingOver,{background:"transparent"}),children:(0,N.jsxs)(t.iA,{compact:!0,borderlessRow:!1,children:[(0,N.jsx)(B,{children:(0,N.jsxs)(y,{children:[(0,N.jsx)(Z,{children:"Agency"}),(0,N.jsx)(Z,{children:"Is Back 2 Back"}),(0,N.jsx)(Z,{children:"Is Multi Agency"})]})}),(0,N.jsxs)(T,{children:[W.map(((e,a)=>(0,N.jsx)(r._l,{draggableId:"".concat(null===e||void 0===e?void 0:e.Code),index:a,children:(s,n)=>{var r;return(0,N.jsxs)(y,(0,l.Z)((0,l.Z)((0,l.Z)({ref:s.innerRef},s.draggableProps),s.dragHandleProps),{},{style:q(n.isDragging,s.draggableProps.style),children:[(0,N.jsxs)(w,{className:"flex items-center",children:[(0,N.jsx)(c.vKY,{size:20,className:"mr-1"}),(0,N.jsx)(t.qE,{size:"sm",shape:"circle",className:"mr-3 dark:".concat(e.colorClass," ").concat(e.colorClass),children:(0,N.jsx)("p",{className:"text-base dark:text-gray-200 text-gray-800",children:null===e||void 0===e||null===(r=e.Name)||void 0===r?void 0:r.slice(0,1)})}),(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"text-base font-semibold dark:text-gray-200 text-gray-800 capitalize",children:null===e||void 0===e?void 0:e.Name})," ",(0,N.jsx)("p",{className:"text-xs dark:text-gray-400 text-gray-400",children:null===e||void 0===e?void 0:e.Name})]})]}),(0,N.jsx)(w,{children:(0,N.jsx)(t.T5,{checked:e.back2back,onChange:()=>le(a,"back2back")})}),(0,N.jsx)(w,{children:(0,N.jsx)(t.T5,{checked:null===e||void 0===e?void 0:e.multi,onChange:()=>le(a,"multi")})})]}))}},"".concat(null===e||void 0===e?void 0:e.Code)))),e.placeholder]})]})}))})})]})]})}),(0,N.jsxs)(t.Vq,{isOpen:E,onClose:()=>_(!1),onRequestClose:()=>_(!1),children:[(0,N.jsx)("h5",{className:"mb-4",children:"Confirm Smart Shuffle"}),(0,N.jsx)("p",{children:"Are you sure you want to do Smart Shuffle"}),(0,N.jsxs)("div",{className:"text-right mt-6",children:[(0,N.jsx)(t.zx,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:()=>_(!1),children:"Cancel"}),(0,N.jsx)(t.zx,{variant:"solid",onClick:async()=>{try{A(!0);if(200===(await(0,f.apiCallstoreprocedure)("CloudBATS_AutoShuffle",{LocationCode:M.LocationCode,ChannelCode:M.ChannelCode,ScheduleDate:(0,p.Tk)(P)})).status)try{await I({operation:C.operationTypesEnum.INITIALIZE_SCHEDULER,isFirstLoad:!0}),(0,x.openNotification)("success","Smart Shuffle has been successfully completed")}catch(e){(0,x.openNotification)("danger","Smart Shuffle is failed to refresh the schedule")}}catch(e){(0,x.openNotification)("danger","Please Save Settings before Smart Shuffle.!")}finally{A(!1),_(!1)}},children:"Okay"})]})]})]})}}}]);
//# sourceMappingURL=6446.cbd14809.chunk.js.map