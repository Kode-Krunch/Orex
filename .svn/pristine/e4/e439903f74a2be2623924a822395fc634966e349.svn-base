import { Button, Card, Tabs } from 'components/ui';
import { Column } from 'primereact/column';
import { TreeTable } from 'primereact/treetable';
import React, { useState, useEffect } from 'react';
import { dailyfpcAprovel, Postdailyfpc } from 'services/ProgrammingService';
import Table from 'components/ui/Table';
import { FaPlusCircle } from 'react-icons/fa';
import { useDispatch, useSelector } from 'react-redux';
import ContentEdit from '../ContentsegMaster/ContentsegEdit';
import { setContent, setContentSeg } from 'store/base/commonSlice';
import { useLocation, useNavigate } from 'react-router-dom';
import {
  HiDotsHorizontal,
} from 'react-icons/hi';
import { openNotification } from 'views/Controls/GLOBALFUNACTION';
import { MdLiveTv, } from 'react-icons/md';
import { BiCameraMovie, } from 'react-icons/bi';
import { theme } from 'twin.macro';
import { RiMovieLine } from 'react-icons/ri';
import { GrDocumentMissing, GrDocumentVideo } from 'react-icons/gr';
import { isScheduleAllowedToEditFn } from 'views/Scheduling/Scheduler/components/SchedulingArea/utils/utils';
import { setdateForm } from 'store/locale/localeSlice';
import { addMinutes, format } from 'date-fns';
import { ExportxlswithColor } from 'views/Controls/ExportxlswithColor';
import { PiExportDuotone } from 'react-icons/pi';
import { IoSaveOutline } from 'react-icons/io5';
import { IoIosArrowRoundBack } from 'react-icons/io';
const { TabNav, TabList, TabContent } = Tabs;
const { Tr, Th, Td, THead, TBody } = Table;
const DailyFPCApp = ({ }) => {
  const twColor = theme`colors`;
  const COLOR_3 = twColor.emerald['300'];
  const COLOR_2 = twColor.blue['500'];
  const COLOR_4 = twColor.amber['500'];
  const COLOR_5 = twColor.red['500'];
  const COLOR_yellow = twColor.yellow['500'];

  const dispatch = useDispatch();
  const navigate = useNavigate();
  const [data, setdata] = useState(['']);
  const Channel = useSelector((state) => state.locale.selectedChannel);
  const token = useSelector((state) => state.auth.session.token);
  const mode = useSelector((state) => state.theme.mode);
  const location = useLocation();
  const queryParams = new URLSearchParams(location.search);
  let SelTelecastDate = queryParams.get('dt');
  const [emptySegmentData, setemptySegmentData] = useState([]);
  const [dialogIsOpen, setIsOpen] = useState(false);
  const [TotalOrg, setTotalOrg] = useState(0);
  const [TotalRep, setTotalRep] = useState(0);
  const [TotalLive, setTotalLive] = useState(0);
  const [curTab, setCurTab] = useState('tab1');
  const [isFPCAllowedToEdit, setIsFPCAllowedToEdit] = useState(null);

  const COLUMNS = [
    { header: 'Start Time', accessorKey: 'StartTime', align: 'right' },
    { header: 'End Time', accessorKey: 'EndTime', align: 'right' },
    { header: 'Content', accessorKey: 'ContentName', align: 'right' },
    { header: 'Dur', accessorKey: 'SlotDuration', align: 'right' },
    { header: 'ORG/REP', accessorKey: 'status', align: 'right' },
    { header: 'Season', accessorKey: 'SeasonNo', align: 'right' },
    { header: 'Episode', accessorKey: 'EpisodeNo', align: 'right' },

  ];
  const SaveDailyFPC = async () => {
    if (emptySegmentData.length == 0) {
      let transformedArray = data.map((data) => ({
        RowNumber: data.data.RowNumber,
        ContentCode:
          data.data.GroupName == 1
            ? data.children[0].data.ContentCode
            : data.data.ContentCode,
        StartTime: data.data.StartTime,
        EndTime: data.data.EndTime,
        SlotDuration: data.data.SlotDuration,
        OriginalRepeatCode: data.data.OriginalRepeatCode,
        EpisodeNo: data.data.EpisodeNo,
        ContentName:
          data.data.GroupName == 1
            ? data.children[0].data.ContentName
            : data.data.ContentName,
        ActualDuration: data.data.ActualDuration,
        SeasonNo: data.data.SeasonNo,
        BreakPatternCode: data.data.BreakPatternCode,
        BreakPattern: data.data.BreakPattern,
        HouseID: data.data.HouseID,
        ChannelTimeDescription: data.data.ChannelTimeDescription,
        Id: data.data.Id,
        TimeCategoryStartTime: data.data.TimeCategoryStartTime,
        TimeCategoryEndTime: data.data.TimeCategoryEndTime,
        MinDiff: data.data.MinDiff,
        Consumption: data.data.Consumption,
        LocationCode: data.data.LocationCode,
        ChannelCode: data.data.ChannelCode,
        TelecastDate: data.data.TelecastDate,
      }));
      try {
        transformedArray = addNewTelecastDate(transformedArray);
        const resp = await Postdailyfpc(transformedArray, token);
        if (resp.data.code === '200') {
          openNotification('success', 'Added Succesfully');
          return;
        }
      } catch (errors) {
        if (errors.response.status == 500) {
          openNotification('success', 'Added Succesfully');
          return;
        }
      }
    } else {
      openNotification('danger', 'Please Create Missing Segment First..');
    }
  };

  useEffect(() => {
    if (dialogIsOpen === false) {
      (async () => {
        try {
          const respfpc = await dailyfpcAprovel(
            Channel.LocationCode,
            Channel.ChannelCode,
            SelTelecastDate,
          );

          const transformedData = [];
          const emptySegmentData2 = [];
          let srNoCounterFIrst = 1;
          let srNoCounterSecond = 1;
          let srNoCounterThird = 1;
          console.log('respfpc', respfpc);
          respfpc.data.forEach((item, indexd) => {
            const transformedObject = {
              key: `${indexd}`,
              data: {
                ...item,
                Sr_NO: srNoCounterFIrst++, // Sequential Sr_NO
                segment: undefined,
                ContentTypeCode: item.ContentTypeCode,
                OriginalRepeatCode: item.OriginalRepeatCode,
              },
            };

            if (item.segment && item.segment.length > 0) {
              transformedObject.children = item.segment.map(
                (segment, index) => ({
                  key: `${indexd}-${index}`,

                  data: {
                    ...item,
                    Sr_NO: srNoCounterSecond++, // Sequential Sr_NO for segments
                    ContentName: segment.SegmentCaption,
                    StartTime: segment.TCIN,
                    EndTime: segment.TCOUT,
                    ContentCode: segment.ContentCode,
                    EpisodeNo: item.EpisodeNo,
                    SeasonNo: item.SeasonNo,
                    ContentTypeCode: item.ContentTypeCode,
                    open: 'dailyfpc',
                    OriginalRepeatCode: item.OriginalRepeatCode,
                  },
                }),
              );
            } else {
              emptySegmentData2.push({
                ...item,
                Sr_NO: srNoCounterThird++, // Sequential Sr_NO for empty segments
                ContentCode: item.ContentCode,
                ContentName: item.ContentName,
                ContentTypeCode: item.ContentTypeCode,
                StartTime: item.StartTime,
                EndTime: item.EndTime,
                EpisodeNo: item.EpisodeNo,
                SeasonNo: item.SeasonNo,
                open: 'dailyfpc',
                OriginalRepeatCode: item.OriginalRepeatCode,

                // Add other properties if needed
              });
            }
            transformedData.push(transformedObject);
          });

          const totalOrg = transformedData.filter(
            (item) => item.data?.status == 'ORG',
          ).length;
          const totalRep = transformedData.filter(
            (item) => item.data?.status == 'REP',
          ).length;
          const totalLive = transformedData.filter(
            (item) => item.data?.IsRecorded == 1,
          ).length;
          console.log(transformedData);

          setTotalOrg(totalOrg);
          setTotalRep(totalRep);
          setTotalLive(totalLive);
          setemptySegmentData(emptySegmentData2);
          setdata(transformedData);
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      })();
    }
  }, [Channel, SelTelecastDate, dialogIsOpen]);

  useEffect(() => {
    (async () => {
      if (!SelTelecastDate || !Channel || !token) return;
      setIsFPCAllowedToEdit(
        await isScheduleAllowedToEditFn(
          new Date(SelTelecastDate),
          Channel,
          token,
        ),
      );
    })();
  }, [SelTelecastDate, Channel, token]);

  const opendui = (item) => {
    setIsOpen(true);
    console.log(item);
    dispatch(setContent([]));
    dispatch(setContentSeg(item));
  };
  const rowClassName = (rowData) => {
    return {
      'bg-teal-500 text-black': rowData.data?.status === 'ORG',
      'bg-orange-500 text-black': rowData.data?.status === 'REP',
    };
  };

  useEffect(() => {
    const gboxElement = document.getElementsByClassName('Gbox2')[0];
    const gboxElementchild =
      document.getElementsByClassName('Gbox2')[0].children[1];
    dispatch(setdateForm([new Date(SelTelecastDate), 'Daily FPC Approval']));
    if (gboxElement) {
      gboxElement.style.display = 'block';
      gboxElementchild.style.display = 'block';
    } // Optionally, you might want to revert the change when the component unmounts
    return () => {
      if (gboxElement) {
        gboxElement.style.display = 'none';
        gboxElementchild.style.display = 'none';
      }
    };
  }, []);

  const addNewTelecastDate = (data) => {
    let previousNewTelecastDate = null;
    let previousSlotDuration = null;
    return data.map((item, key) => {
      let newTelecastDate;

      if (key === 0) {
        if (item.TelecastDate)
          newTelecastDate = new Date(`${item.TelecastDate}T${item.StartTime}`);
        else newTelecastDate = new Date(item.NewTelecastDate);
      } else {
        newTelecastDate = addMinutes(
          previousNewTelecastDate,
          parseInt(previousSlotDuration),
        );
      }
      previousNewTelecastDate = newTelecastDate;
      previousSlotDuration = item.SlotDuration;
      return {
        ...item,
        RowNumber: key + 1,
        NewTelecastDate: format(
          new Date(newTelecastDate),
          'yyyy-MM-dd HH:mm:ss',
        ),
      };
    });
  };
  return (
    <Card>
      <div className="">
        {dialogIsOpen && <ContentEdit setIsOpen={setIsOpen} />}

        {!dialogIsOpen && (
          <div>
            <div className={`grid grid-cols-1 gap-4 mb-4 mt-2 lg:grid-cols-5`}>
              <div
                className={`web-card animate__animated onlythis flex justify-center col-span-1 cursor-pointer  dark:!bg-[#1f2639]
          !bg-[#fff] dark:!border-[#374558]
           dark:!border`}
                style={{ height: 200 }}
                onClick={() => setCurTab('tab2')}
              >
                <div className="card-bodyR">
                  <div className="flex justify-between">
                    <div className="flex ">
                      {mode === 'dark' ? (
                        <div
                          className={` animate__animated onlythis2 order order1`}
                          style={{}}
                        >
                          <span>
                            <GrDocumentMissing
                              style={{ fontSize: 32, color: COLOR_5 }}
                            />
                          </span>
                        </div>
                      ) : (
                        <Button
                          size="lg"
                          icon={
                            <GrDocumentMissing
                              style={{ fontSize: 32, color: COLOR_5 }}
                            />
                          }
                          className={`!bg-red-500 !bg-opacity-25 !border-transparent`}
                        />
                      )}
                    </div>
                    <div>
                      <HiDotsHorizontal />
                    </div>
                  </div>
                  <div className="flex-grow-1 mt-1">
                    <span className="text-lg font-extrabold dark:!text-gray-400 text-black">
                      Missing Segments
                    </span>
                    <h3 className="text-2xl">{emptySegmentData.length}</h3>
                  </div>
                  <div>
                    <p className="text-xs dark:!text-gray-400 text-black">
                      Missing Segments are portions of a program or broadcast
                      that were not aired or were incomplete
                    </p>
                  </div>
                </div>
              </div>
              <div
                className={`web-card animate__animated onlythis flex justify-center col-span-1 cursor-pointer  dark:!bg-[#1f2639]
          !bg-[#fff] dark:!border-[#374558]
           dark:!border`}
                style={{ height: 200 }}
                onClick={() => setCurTab('tab1')}
              >
                <div className="card-bodyR">
                  <div className="flex justify-between">
                    <div className="flex ">
                      {mode === 'dark' ? (
                        <div
                          className={` animate__animated onlythis2 order`}
                          style={{}}
                        >
                          <span>
                            <GrDocumentVideo
                              style={{ fontSize: 32, color: COLOR_2 }}
                            />
                          </span>
                        </div>
                      ) : (
                        <Button
                          size="lg"
                          icon={
                            <GrDocumentVideo
                              style={{ fontSize: 32, color: COLOR_2 }}
                            />
                          }
                          className={`!bg-blue-500 !bg-opacity-25 !border-transparent`}
                        />
                      )}
                    </div>
                    <div>
                      <HiDotsHorizontal />
                    </div>
                  </div>
                  <div className="flex-grow-1 mt-2">
                    <span className="text-lg font-extrabold dark:!text-gray-400 text-black">
                      Programs
                    </span>
                    <h3 className="text-2xl">{data.length}</h3>
                  </div>
                  <div className="mt-2">
                    <p className="text-xs dark:!text-gray-400 text-black">
                      Program scheduled in FPC defines the broadcast times for
                      shows.
                    </p>
                  </div>
                </div>
              </div>

              <div
                className={`web-card animate__animated onlythis flex justify-center col-span-1 cursor-pointer  dark:!bg-[#1f2639]
          !bg-[#fff] dark:!border-[#374558]
           dark:!border`}
                style={{ height: 200 }}
              >
                <div className="card-bodyR">
                  <div className="flex justify-between">
                    <div className="flex ">
                      {mode === 'dark' ? (
                        <div
                          className={` animate__animated onlythis2 order order3`}
                          style={{}}
                        >
                          <span>
                            <RiMovieLine
                              style={{ fontSize: 32, color: COLOR_3 }}
                            />
                          </span>
                        </div>
                      ) : (
                        <Button
                          size="lg"
                          icon={
                            <RiMovieLine
                              style={{ fontSize: 32, color: COLOR_3 }}
                            />
                          }
                          className={`!bg-emerald-500 !bg-opacity-25 !border-transparent`}
                        />
                      )}
                    </div>
                    <div>
                      <HiDotsHorizontal />
                    </div>
                  </div>
                  <div className="flex-grow-1 mt-2">
                    <span className="text-lg font-extrabold dark:!text-gray-400 text-black">
                      Original Programs
                    </span>
                    <h3 className="text-2xl">{TotalOrg}</h3>
                  </div>
                  <div className="mt-2">
                    <p className="text-xs dark:!text-gray-400 text-black">
                      Original Programs refer to shows that are aired for the
                      first time.
                    </p>
                  </div>
                </div>
              </div>
              <div
                className={`web-card animate__animated onlythis flex justify-center col-span-1 cursor-pointer  dark:!bg-[#1f2639]
          !bg-[#fff] dark:!border-[#374558]
           dark:!border`}
                style={{ height: 200 }}
              >
                <div className="card-bodyR">
                  <div className="flex justify-between">
                    <div className="flex ">
                      {mode === 'dark' ? (
                        <div
                          className={` animate__animated onlythis2 order order2`}
                          style={{}}
                        >
                          <span>
                            <BiCameraMovie
                              style={{ fontSize: 32, color: COLOR_4 }}
                            />
                          </span>
                        </div>
                      ) : (
                        <Button
                          size="lg"
                          icon={
                            <BiCameraMovie
                              style={{ fontSize: 32, color: COLOR_4 }}
                            />
                          }
                          className={`!bg-amber-500 !bg-opacity-25 !border-transparent`}
                        />
                      )}
                    </div>
                    <div>
                      <HiDotsHorizontal />
                    </div>
                  </div>
                  <div className="flex-grow-1 mt-2">
                    <span className="text-lg font-extrabold dark:!text-gray-400 text-black">
                      Repeat Programs
                    </span>
                    <h3 className="text-2xl">{TotalRep}</h3>
                  </div>
                  <div className="mt-2">
                    <p className="text-xs dark:!text-gray-400 text-black">
                      Repeat Programs are previously aired shows broadcast
                      again.
                    </p>
                  </div>
                </div>
              </div>
              <div
                className={`web-card animate__animated onlythis flex justify-center col-span-1 cursor-pointer  dark:!bg-[#1f2639]
          !bg-[#fff] dark:!border-[#374558]
           dark:!border`}
                style={{ height: 200 }}
              >
                <div className="card-bodyR">
                  <div className="flex justify-between">
                    <div className="flex ">
                      {mode === 'dark' ? (
                        <div
                          className={` animate__animated onlythis2 order order7`}
                          style={{}}
                        >
                          <span>
                            <MdLiveTv
                              style={{ fontSize: 32, color: COLOR_yellow }}
                            />
                          </span>
                        </div>
                      ) : (
                        <Button
                          size="lg"
                          icon={
                            <MdLiveTv
                              style={{ fontSize: 32, color: COLOR_yellow }}
                            />
                          }
                          className={`!bg-yellow-500 !bg-opacity-25 !border-transparent`}
                        />
                      )}
                    </div>
                    <div>
                      <HiDotsHorizontal />
                    </div>
                  </div>
                  <div className="flex-grow-1 mt-2">
                    <span className="text-lg font-extrabold dark:!text-gray-400 text-black">
                      Live Program
                    </span>
                    <h3 className="text-2xl">{TotalLive}</h3>
                  </div>
                  <div className="mt-2">
                    <p className="text-xs dark:!text-gray-400 text-black">
                      Live Program refers to a show that is broadcast in
                      real-time.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <Tabs value={curTab} onChange={(event) => setCurTab(event)}>
              <div className="flex justify-between items-center border-b-2 border-b-gray-700 mb-3">
                <TabList className="border-b-[0px]">
                  <TabNav value="tab1">FPC</TabNav>
                  <TabNav value="tab2">Missing Segment</TabNav>
                </TabList>
              </div>
              <TabContent value="tab1">
                {' '}
                <div className="mt-2">
                  <TreeTable
                    resizableColumns
                    value={data}
                    tableStyle={{ minWidth: '50rem' }}
                    rowClassName={rowClassName}
                    scrollable
                    scrollHeight="400px"
                  >
                    <Column
                      field="Sr_NO"
                      header="Sr NO"
                      expander
                      style={{
                        width: 100,
                      }}
                      body={(rowData) => {
                        return (
                          <span
                            style={{
                              color: 'black',
                              fontSize: 12,
                              fontWeight: 600,
                              width: 70,
                            }}
                          >
                            {rowData.data?.Sr_NO}
                          </span>
                        );
                      }}
                    ></Column>
                    <Column
                      field="StartTime"
                      header="Start Time"
                      style={{
                        width: 100,
                      }}
                      body={(rowData) => {
                        return (
                          <p
                            style={{
                              color: 'black',
                              fontSize: 12,
                              fontWeight: 600,
                              width: 120,
                            }}
                          >
                            {rowData.data?.StartTime}
                          </p>
                        );
                      }}
                    ></Column>
                    <Column
                      field="EndTime"
                      header="End Time"
                      style={{
                        width: 100,
                      }}
                      body={(rowData) => {
                        return (
                          <p
                            style={{
                              color: 'black',
                              fontSize: 12,
                              fontWeight: 600,
                              width: 120,
                            }}
                          >
                            {rowData.data?.EndTime}
                          </p>
                        );
                      }}
                    ></Column>
                    <Column
                      field="ContentName"
                      header="Content"
                      style={{
                        width: 320,
                      }}
                      body={(rowData) => {
                        return (
                          <p
                            style={{
                              color: 'black',
                              overflow: 'hidden',
                              textOverflow: 'ellipsis',
                              whiteSpace: 'nowrap',
                              fontSize: 12,
                              fontWeight: 600,
                              padding: 2,
                              margin: 2,
                            }}
                          >
                            {rowData.data?.ContentName}
                          </p>
                        );
                      }}
                    ></Column>
                    <Column
                      field="SlotDuration"
                      header="Dur"
                      style={{ width: 50 }}
                      body={(rowData) => {
                        return (
                          <p
                            style={{
                              color: 'black',
                              fontSize: 12,
                              fontWeight: 600,
                              width: 70,
                            }}
                          >
                            {rowData.data?.SlotDuration}
                          </p>
                        );
                      }}
                    ></Column>
                    <Column
                      field="status"
                      header="ORG/REP"
                      style={{ width: 100 }}
                      body={(rowData) => {
                        return (
                          <p
                            style={{
                              color: 'black',
                              fontSize: 12,
                              fontWeight: 600,
                              width: 120,
                            }}
                          >
                            {rowData.data?.status}
                          </p>
                        );
                      }}
                    ></Column>
                    <Column
                      field="SeasonNo"
                      header="Season & Episode "
                      style={{ width: 200 }}
                      body={(rowData) => {
                        return (
                          <p
                            style={{
                              color: 'black',
                              fontSize: 12,
                              fontWeight: 600,
                            }}
                          >
                            {rowData.data?.IsRecorded === 1
                              ? 'LIVE'
                              : rowData.data?.EpisodeSpecific === 0
                                ? rowData.data?.ContentTypeName
                                : `S${rowData.data?.SeasonNo} & E${rowData.data?.EpisodeNo}`}
                          </p>
                        );
                      }}
                    ></Column>
                  </TreeTable>
                </div>
              </TabContent>{' '}
              <TabContent value="tab2">
                <Table borderlessRow={false} overflow={true} className="mt-2">
                  <THead>
                    <Tr>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        Sr No
                      </Th>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        Start Time
                      </Th>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        End Time
                      </Th>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        Content
                      </Th>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        SE & EP
                      </Th>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        ORG / REP
                      </Th>
                      <Th
                        style={{
                          width: 70,
                          fontSize: 14,
                          fontWeight: 700,
                        }}
                      >
                        Action
                      </Th>
                    </Tr>
                  </THead>
                  <TBody>
                    {emptySegmentData.map((item, index) => (
                      <Tr
                        key={index}
                        className={
                          item.status === 'REP'
                            ? 'bg-orange-500 '
                            : 'bg-teal-500 '
                        }
                      >
                        <Td className="dark:text-black border border-current  ">
                          {item.Sr_NO}
                        </Td>
                        <Td
                          style={{
                            width: 70,
                            fontSize: 14,
                            fontWeight: 700,
                          }}
                          className="dark:text-black border border-current "
                        >
                          {item.StartTime}
                        </Td>
                        <Td
                          style={{
                            width: 70,
                            fontSize: 14,
                            fontWeight: 700,
                          }}
                          className="dark:text-black border border-current "
                        >
                          {item.EndTime}
                        </Td>
                        <Td
                          className="dark:text-black border border-current "
                          style={{
                            width: 70,
                            fontSize: 14,
                            fontWeight: 700,
                          }}
                        >
                          {item.ContentName}
                        </Td>
                        <Td
                          className="dark:text-black border border-current "
                          style={{
                            width: 70,
                            fontSize: 14,
                            fontWeight: 700,
                          }}
                        >
                          S{item.SeasonNo} & E{item.EpisodeNo}
                        </Td>
                        <Td
                          className="dark:text-black border border-current "
                          style={{
                            width: 70,
                            fontSize: 14,
                            fontWeight: 700,
                          }}
                        >
                          {item.OriginalRepeatCode === 1 ? 'ORG' : 'REP'}
                        </Td>
                        <Td
                          className="dark:text-black border border-current "
                          style={{
                            width: 70,
                            fontWeight: 700,
                          }}
                        >
                          {item.OriginalRepeatCode === 1 ? (
                            // <FaPlusCircle
                            //   onClick={() => opendui(item)}
                            //   className="cursor-pointer"
                            //   style={{ fontSize: 15 }}
                            // />
                            <Button size="xs" variant="twoTone" onClick={() => opendui(item)} icon={<FaPlusCircle />} />
                          ) : (
                            <></>
                          )}
                        </Td>
                      </Tr>
                    ))}
                  </TBody>
                </Table>
              </TabContent>
            </Tabs>
          </div>
        )}
        <Button
          label="Save"
          size="sm"
          icon={<IoIosArrowRoundBack />}
          className="mt-6 mr-2"
          onClick={() => {
            navigate('/DailyFpcApproval');
          }}
        >
          Discard
        </Button>
        <Button
          label="Save"
          variant="solid"
          icon={<IoSaveOutline />}
          size="sm"
          className="mt-6 mr-2"
          onClick={() => {
            SaveDailyFPC();
          }}
          disabled={!isFPCAllowedToEdit}
        >
          Save
        </Button>
        <Button
          icon={<PiExportDuotone />}
          size='sm'
          variant='solid'
          className="mt-6"
          onClick={() => {
            function flattenData(input) {
              let result = [];

              input.forEach(item => {
                // Push parent data
                result.push(item.data);

                // Check if children exist and push their data
                if (item.children) {
                  item.children.forEach(child => {
                    result.push(child.data);
                  });
                }
              });

              return result;
            }
            const Expordata = flattenData(data)
            console.log(Expordata)
            ExportxlswithColor(
              false,
              false,
              0,
              0,
              true,
              Expordata,
              'Daily FPC Approval',
              COLUMNS,
              false,
            )
          }}>Export</Button>
      </div>
    </Card>
  );
};

export default DailyFPCApp;
